{"version":3,"file":"AnimatedNumber-DMAocXSA.js","sources":["../../src/components/common/AnimatedNumber.vue"],"sourcesContent":["<template>\r\n  <span>\r\n    <span class=\"integer-part\">{{ formatNumber(integerPart, 0) }}</span>\r\n    <span class=\"decimal-part\" v-if=\"decimalPart\">{{ decimalPart }}</span>\r\n  </span>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, watch, onMounted, onUnmounted, computed } from 'vue'\r\nimport { formatNumber } from '@/utils/format'\r\n\r\ninterface Props {\r\n  value: number | string\r\n  duration?: number\r\n  decimals?: number\r\n  increment?: number\r\n  autoIncrement?: boolean\r\n  incrementInterval?: number\r\n  incrementAmount?: number\r\n  cacheKey?: string // 添加缓存键名属性\r\n  useCache?: boolean // 是否使用缓存\r\n}\r\n\r\nconst props = withDefaults(defineProps<Props>(), {\r\n  duration: 1000,\r\n  decimals: 8,\r\n  increment: 0.00000001,\r\n  autoIncrement: false,\r\n  incrementInterval: 100,\r\n  incrementAmount: 0.00000001,\r\n  cacheKey: '', // 默认空字符串表示不使用缓存\r\n  useCache: false // 默认不使用缓存\r\n})\r\n\r\nconst displayValue = ref('0')\r\nconst currentValue = ref(0)\r\nconst targetValue = ref(0)\r\nconst animationId = ref<number | null>(null)\r\nconst incrementTimer = ref<number | null>(null)\r\n\r\n// 计算整数和小数部分\r\nconst integerPart = computed(() => {\r\n  const parts = displayValue.value.split('.')\r\n  return parts[0]\r\n})\r\n\r\nconst decimalPart = computed(() => {\r\n  const parts = displayValue.value.split('.')\r\n  return parts.length > 1 ? '.' + parts[1] : ''\r\n})\r\n\r\nconst curFormatNumber = (num: number): string => {\r\n  return num.toFixed(props.decimals)\r\n}\r\n\r\n// 保存数据到缓存\r\nconst saveToCache = (value: number) => {\r\n  if (props.useCache && props.cacheKey) {\r\n    try {\r\n      value += props.incrementAmount;\r\n      localStorage.setItem(`animated-number-${props.cacheKey}`, value.toString())\r\n    } catch (error) {\r\n      console.error('Failed to save to cache:', error)\r\n    }\r\n  }\r\n}\r\n\r\n// 从缓存加载数据\r\nconst loadFromCache = (): number | null => {\r\n  if (props.useCache && props.cacheKey) {\r\n    try {\r\n      const cachedValue = localStorage.getItem(`animated-number-${props.cacheKey}`)\r\n      if (cachedValue) {\r\n        return parseFloat(cachedValue)\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load from cache:', error)\r\n    }\r\n  }\r\n  return null\r\n}\r\n\r\nconst animateToTarget = () => {\r\n  const startValue = currentValue.value\r\n  const endValue = targetValue.value\r\n  const startTime = Date.now()\r\n  \r\n  const animate = () => {\r\n    const elapsed = Date.now() - startTime\r\n    const progress = Math.min(elapsed / props.duration, 1)\r\n    \r\n    // 使用缓动函数，让动画更自然\r\n    const easeOutQuart = 1 - Math.pow(1 - progress, 4)\r\n    \r\n    currentValue.value = startValue + (endValue - startValue) * easeOutQuart\r\n    displayValue.value = curFormatNumber(currentValue.value)\r\n    \r\n    if (progress < 1) {\r\n      animationId.value = requestAnimationFrame(animate)\r\n    } else {\r\n      currentValue.value = endValue\r\n      displayValue.value = curFormatNumber(endValue)\r\n      // 动画完成后保存到缓存\r\n      saveToCache(endValue)\r\n    }\r\n  }\r\n  \r\n  animate()\r\n}\r\n\r\nconst startAutoIncrement = () => {\r\n  if (!props.autoIncrement) return\r\n  \r\n  incrementTimer.value = window.setInterval(() => {\r\n    targetValue.value += props.incrementAmount\r\n    animateToTarget()\r\n  }, props.incrementInterval)\r\n}\r\n\r\nconst stopAutoIncrement = () => {\r\n  if (incrementTimer.value) {\r\n    clearInterval(incrementTimer.value)\r\n    incrementTimer.value = null\r\n  }\r\n}\r\n\r\nwatch(\r\n  () => props.value,\r\n  (newValue) => {\r\n    const numValue = typeof newValue === 'string' ? parseFloat(newValue) : newValue\r\n    if (!isNaN(numValue) && numValue !== targetValue.value) {\r\n      // 从缓存加载数据进行比较\r\n      const cachedValue = loadFromCache()\r\n      \r\n      // 如果有缓存值，且当前值小于缓存值，则使用缓存值\r\n      if (cachedValue !== null && numValue < cachedValue) {\r\n        // 保持使用缓存中的较大值\r\n        targetValue.value = cachedValue\r\n      } else {\r\n        // 否则使用新值\r\n        targetValue.value = numValue\r\n      }\r\n      \r\n      animateToTarget()\r\n    }\r\n  },\r\n  { immediate: true }\r\n)\r\n\r\nwatch(\r\n  () => props.autoIncrement,\r\n  (newValue) => {\r\n    if (newValue) {\r\n      startAutoIncrement()\r\n    } else {\r\n      stopAutoIncrement()\r\n    }\r\n  },\r\n  { immediate: true }\r\n)\r\n\r\nonMounted(() => {\r\n  // 尝试从缓存加载初始值\r\n  const cachedValue = loadFromCache()\r\n  const propValue = typeof props.value === 'string' ? parseFloat(props.value) : props.value\r\n  \r\n  // 如果有缓存值，且当前值小于缓存值，则使用缓存值\r\n  let initialValue = propValue\r\n  if (cachedValue !== null) {\r\n    initialValue = propValue < cachedValue ? cachedValue : propValue\r\n  }\r\n  \r\n  if (!isNaN(initialValue)) {\r\n    currentValue.value = initialValue\r\n    targetValue.value = initialValue\r\n    displayValue.value = curFormatNumber(initialValue)\r\n  }\r\n  \r\n  if (props.autoIncrement) {\r\n    startAutoIncrement()\r\n  }\r\n})\r\n\r\nonUnmounted(() => {\r\n  if (animationId.value) {\r\n    cancelAnimationFrame(animationId.value)\r\n  }\r\n  stopAutoIncrement()\r\n  \r\n  // 组件卸载时保存当前值到缓存\r\n  if (props.useCache && props.cacheKey) {\r\n    saveToCache(currentValue.value)\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.decimal-part {\r\n  font-size: 0.8em;\r\n}\r\n</style>"],"names":["props","__props","displayValue","ref","currentValue","targetValue","animationId","incrementTimer","integerPart","computed","decimalPart","parts","curFormatNumber","num","saveToCache","value","error","loadFromCache","cachedValue","animateToTarget","startValue","endValue","startTime","animate","elapsed","progress","easeOutQuart","startAutoIncrement","stopAutoIncrement","watch","newValue","numValue","onMounted","propValue","initialValue","onUnmounted","_createElementBlock","_createElementVNode","_hoisted_1","_toDisplayString","_unref","formatNumber","_hoisted_2"],"mappings":"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"}