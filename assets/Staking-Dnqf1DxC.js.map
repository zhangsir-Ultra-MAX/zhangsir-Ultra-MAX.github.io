{"version":3,"file":"Staking-Dnqf1DxC.js","sources":["../../src/stores/staking.ts","../../src/views/Staking.vue"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref } from 'vue'\r\nimport { formatUnits, parseUnits } from 'ethers'\r\nimport { useWalletStore } from './wallet'\r\nimport { contractService } from '../services/contracts'\r\n\r\nexport const useStakingStore = defineStore('staking', () => {\r\n  // State\r\n  const yourStaked = ref('0') // Your staked amount (maxWithdraw)\r\n  const totalSupply = ref('0') // Total stCINA supply\r\n  const cinaBalance = ref('0') // User's CINA balance\r\n  const stCINABalance = ref('0') // User's stCINA balance\r\n  const stakedAmount = ref('0') // User's staked CINA amount (stCINA balance)\r\n  const currentAPY = ref('0') // Current staking APY\r\n  const minStakeAmount = ref('0.01') // Minimum stake amount\r\n  const navCina = ref('1.0') // NAV per CINA\r\n  const incrementAmount = ref('0') // Current increment amount\r\n  const userIncrementAmount = ref('0') // User's increment amount\r\n  const isLoading = ref(false)\r\n  const lastUpdateTime = ref(0)\r\n\r\n  // Actions\r\n  const fetchStakingData = async () => {\r\n    const walletStore = useWalletStore()\r\n\r\n    if (!walletStore.isConnected) return\r\n\r\n    try {\r\n      isLoading.value = true\r\n\r\n      // Get staking contract\r\n      const stakingContract = contractService.getStakingVaultContract()\r\n      if (!stakingContract) {\r\n        console.warn('Staking contract not available, using mock data')\r\n        // Fallback to mock data\r\n        yourStaked.value = '1250000.5678'\r\n        totalSupply.value = '1200000.0000'\r\n        currentAPY.value = '12.5'\r\n        navCina.value = '1.025'\r\n        minStakeAmount.value = '1.0'\r\n        incrementAmount.value = '0.0005'\r\n        \r\n        if (walletStore.address) {\r\n          await fetchUserStakingData()\r\n        }\r\n        return\r\n      }\r\n\r\n      // Fetch contract data using correct method calls\r\n      const [\r\n        totalSupplyResult,\r\n        navCinaResult,\r\n        minStakeAmountResult,\r\n        incrementAmountResult,\r\n        yourStakedResult,\r\n        lastDayRewardAmountResult\r\n      ] = await Promise.all([\r\n        stakingContract.totalSupply().catch(() => '0'),\r\n        stakingContract.getNAV_CINA().catch(() => '1000000000000000000'), // 1.0 in wei\r\n        stakingContract.minStakeAmount().catch(() => '1000000000000000000'), // 1 CINA\r\n        stakingContract.getUserIncrementAmount(walletStore.address).catch(() => '0'),\r\n        stakingContract.maxWithdraw(walletStore.address).catch(() => '0'),\r\n        stakingContract.lastDayRewardAmount().catch(() => '0'),\r\n      ])\r\n\r\n      // Convert from wei to readable format\r\n      totalSupply.value = formatUnits(totalSupplyResult, 18)\r\n      navCina.value = formatUnits(navCinaResult, 18)\r\n      minStakeAmount.value = formatUnits(minStakeAmountResult, 18)\r\n      incrementAmount.value = formatUnits(incrementAmountResult, 18)\r\n      yourStaked.value = formatUnits(yourStakedResult, 18)\r\n      \r\n      // Calculate APY based on increment amount\r\n      const rewardFloat = parseFloat(formatUnits(lastDayRewardAmountResult, 18))\r\n      const totalSupplyFloat = parseFloat(totalSupply.value) > 0 ? parseFloat(totalSupply.value) : 1\r\n\r\n      if (rewardFloat > 0) {\r\n        // Simple APY calculation based on increment\r\n        currentAPY.value = (rewardFloat/totalSupplyFloat * 365 * 100).toFixed(2)\r\n      } else {\r\n        currentAPY.value = '0'\r\n      }\r\n\r\n      // Fetch user-specific data if connected\r\n      if (walletStore.address) {\r\n        await fetchUserStakingData()\r\n      }\r\n\r\n      lastUpdateTime.value = Date.now()\r\n    } catch (error: any) {\r\n      console.error('Failed to fetch staking data:', error)\r\n      // appStore.addNotification({\r\n      //   type: 'error',\r\n      //   title: 'Data Fetch Failed',\r\n      //   message: error.message || 'Failed to fetch staking data'\r\n      // })\r\n    } finally {\r\n      isLoading.value = false\r\n    }\r\n  }\r\n\r\n  const fetchUserStakingData = async () => {\r\n    const walletStore = useWalletStore()\r\n    if (!walletStore.address) return\r\n\r\n    try {\r\n      // Get contracts\r\n      const stakingContract = contractService.getStakingVaultContract()\r\n      const cinaContract = contractService.getCINAContract()\r\n      \r\n      if (!stakingContract || !cinaContract) {\r\n        console.warn('Contracts not available, using mock user data')\r\n        // Fallback to mock data\r\n        cinaBalance.value = '500.123456'\r\n        stakedAmount.value = '250.789012'\r\n\r\n        return\r\n      }\r\n\r\n      // Fetch user data from contracts\r\n      const [\r\n        cinaBalanceResult,\r\n        stCINABalanceResult,\r\n        userStakedAmountResult\r\n      ] = await Promise.all([\r\n        cinaContract.balanceOf(walletStore.address).catch(() => '0'),\r\n        stakingContract.balanceOf(walletStore.address).catch(() => '0'), // User's stCINA balance\r\n        stakingContract.maxWithdraw(walletStore.address).catch(() => '0'), // User's stCINA balance\r\n      ])\r\n\r\n      // Convert from wei to readable format\r\n      cinaBalance.value = formatUnits(cinaBalanceResult, 18)\r\n      stakedAmount.value = formatUnits(userStakedAmountResult, 18)\r\n      stCINABalance.value = formatUnits(stCINABalanceResult, 18)\r\n    } catch (error) {\r\n      console.error('Failed to fetch user staking data:', error)\r\n    }\r\n  }\r\n\r\n    const previewDeposit = async (amount: string) => {\r\n    if (!amount || amount === '0') return { shares: '0', fee: '0' }\r\n\r\n    try {\r\n      const contract = await contractService.getStakingVaultContract()\r\n      if (!contract) throw new Error('Contract not available')\r\n\r\n      const amountWei = parseUnits(amount, 18)\r\n      const shares = await contract.previewDeposit(amountWei)\r\n\r\n      return {\r\n        shares: formatUnits(shares, 18),\r\n        fee: '0' // No fee for deposits in this implementation\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to preview deposit:', error)\r\n      return { shares: '0', fee: '0' }\r\n    }\r\n  }\r\n\r\n  const previewWithdraw = async (amount: string) => {\r\n    if (!amount || amount === '0') return { shares: '0', assets: '0', fee: '0' }\r\n\r\n    try {\r\n      const contract = await contractService.getStakingVaultContract()\r\n      if (!contract) throw new Error('Contract not available')\r\n\r\n      const assetsWei = parseUnits(amount, 18)\r\n      const shares = await contract.previewWithdraw(assetsWei)\r\n\r\n      return {\r\n        shares: formatUnits(shares, 18)\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to preview withdraw:', error)\r\n      return { shares: '0', assets: '0', fee: '0' }\r\n    }\r\n  }\r\n\r\n  // Auto-refresh data\r\n  let refreshInterval: NodeJS.Timeout | null = null\r\n\r\n  const startAutoRefresh = () => {\r\n    if (refreshInterval) {\r\n      clearInterval(refreshInterval)\r\n    }\r\n\r\n    refreshInterval = setInterval(() => {\r\n      if (Date.now() - lastUpdateTime.value > 15000) { // 15 seconds\r\n        fetchStakingData()\r\n      }\r\n    }, 15000)\r\n  }\r\n\r\n  const stopAutoRefresh = () => {\r\n    if (refreshInterval) {\r\n      clearInterval(refreshInterval)\r\n      refreshInterval = null\r\n    }\r\n  }\r\n\r\n  return {\r\n    // State\r\n    yourStaked,\r\n    totalSupply,\r\n    cinaBalance,\r\n    stCINABalance,\r\n    stakedAmount,\r\n    currentAPY,\r\n    navCina,\r\n    minStakeAmount,\r\n    incrementAmount,\r\n    userIncrementAmount,\r\n    isLoading,\r\n\r\n    // Actions\r\n    fetchStakingData,\r\n    fetchUserStakingData,\r\n    startAutoRefresh,\r\n    stopAutoRefresh,\r\n    previewDeposit,\r\n    previewWithdraw,\r\n\r\n    // Computed getters for reactive access\r\n    get loading() { return isLoading.value }\r\n  }\r\n})","<template>\r\n  <PullToRefresh :is-pulling=\"isPulling\" :is-refreshing=\"isRefreshing\" :pull-distance=\"pullDistance\"\r\n    :can-refresh=\"canRefresh\">\r\n    <div class=\"staking\">\r\n      <div class=\"staking-content\">\r\n        <!-- Staking Overview -->\r\n        <div class=\"staking-overview\">\r\n          <h2 class=\"section-title\">\r\n            {{ $t('staking.overview') }}\r\n          </h2>\r\n\r\n          <div class=\"overview-grid\">\r\n            <!-- Your Staked -->\r\n            <div class=\"overview-card\">\r\n              <div class=\"card-header\">\r\n                <h3 class=\"card-title\">{{ $t('staking.yourStaked') }}</h3>\r\n                <div class=\"card-subtitle\">\r\n                  {{ $t('staking.apy') }} {{ formatNumber(stakingStore.currentAPY) }}%\r\n                </div>\r\n              </div>\r\n              <div class=\"card-value\">\r\n                <img src=\"../assets/logo.png\" alt=\"\" class=\"token-icon\">\r\n                <AnimatedNumber class=\"animated-number\" :value=\"stakingStore.yourStaked\" :decimals=\"8\"\r\n                  :auto-increment=\"walletStore.isConnected && parseFloat(stakingStore.yourStaked) > 0\"\r\n                  :increment-amount=\"parseFloat(stakingStore.incrementAmount)\" :increment-interval=\"1000\"\r\n                  :cache-key=\"`yourStaked_${walletStore.address}`\" :use-cache=\"false\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Staking Actions -->\r\n        <div class=\"action-section\">\r\n          <el-tabs v-model=\"activeTab\" class=\"staking-tabs\">\r\n            <!-- Stake CINA Tab -->\r\n            <el-tab-pane :label=\"$t('staking.stakeCINA')\" name=\"stake\">\r\n              <div class=\"tab-content\">\r\n                <div class=\"action-form\">\r\n                  <div class=\"input-section\">\r\n                    <div class=\"input-group\">\r\n                      <FormattedInput v-model=\"stakeAmount\"\r\n                        :placeholder=\"formatNumberK(stakingStore.cinaBalance, 6) + '  available'\" size=\"large\"\r\n                        class=\"amount-input\" :decimals=\"6\" :use-abbreviation=\"true\" :max-decimals=\"18\"\r\n                        @input-change=\"handleStakeAmountChange\">\r\n                        <template #suffix>\r\n                          <span class=\"input-suffix\">CINA</span>\r\n                        </template>\r\n                      </FormattedInput>\r\n                    </div>\r\n\r\n                    <!-- Quick Amount Buttons -->\r\n                    <div class=\"quick-amounts\">\r\n                      <el-button v-for=\"percentage in [25, 50, 75]\" :key=\"percentage\" size=\"small\"\r\n                        @click=\"setStakePercentage(percentage)\">\r\n                        {{ percentage }}%\r\n                      </el-button>\r\n                      <el-button @click=\"setMaxStake\" class=\"max-button\" size=\"small\">\r\n                        {{ $t('common.max') }}\r\n                      </el-button>\r\n                    </div>\r\n\r\n                    <!-- Minimum Stake Warning -->\r\n                    <div v-if=\"showMinStakeWarning\" class=\"warning-info\">\r\n                      <el-icon>\r\n                        <Warning />\r\n                      </el-icon>\r\n                      <span>{{ $t('staking.minStakeWarning', { amount: formatNumber(stakingStore.minStakeAmount) })\r\n                      }}</span>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <!-- Staking Preview -->\r\n                  <div v-if=\"stakePreviewData\" class=\"preview-section\">\r\n                    <h4 class=\"preview-title\">{{ $t('staking.preview') }}</h4>\r\n                    <div class=\"preview-details\">\r\n                      <div class=\"preview-row\">\r\n                        <span>{{ $t('staking.youWillReceive') }}</span>\r\n                        <span class=\"preview-value\">{{ formatNumber(stakePreviewData.shares, 2) }} stCINA</span>\r\n                      </div>\r\n                      <div class=\"preview-row exchange-rate\">\r\n                        <span>{{ $t('staking.exchangeRate') }}</span>\r\n                        <span class=\"preview-value\">1 CINA ≈ {{ formatNumber((1 / parseFloat(stakingStore.navCina)),\r\n                          6)\r\n                        }} stCINA</span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <el-button type=\"primary\" size=\"large\"\r\n                    :loading=\"transactionStatus === 'loading' && activeTab === 'stake'\" :disabled=\"!isStakeValid\"\r\n                    @click=\"handleStake\" class=\"action-button\">\r\n                    {{ $t('staking.stakeCINA') }}\r\n                  </el-button>\r\n                </div>\r\n              </div>\r\n            </el-tab-pane>\r\n\r\n            <!-- Unstake CINA Tab -->\r\n            <el-tab-pane :label=\"$t('staking.unstakeCINA')\" name=\"unstake\">\r\n              <div class=\"tab-content\">\r\n                <div class=\"action-form\">\r\n                  <div class=\"input-section\">\r\n                    <div class=\"input-group\">\r\n                      <FormattedInput v-model=\"unstakeAmount\"\r\n                        :placeholder=\"formatNumberK(stakingStore.stakedAmount, 6) + '  available'\" size=\"large\"\r\n                        class=\"amount-input\" :decimals=\"6\" :use-abbreviation=\"true\" :max-decimals=\"18\"\r\n                        @input-change=\"handleUnstakeAmountChange\">\r\n                        <template #suffix>\r\n                          <span class=\"input-suffix\">CINA</span>\r\n                        </template>\r\n                      </FormattedInput>\r\n                    </div>\r\n\r\n                    <!-- Quick Amount Buttons -->\r\n                    <div class=\"quick-amounts\">\r\n                      <el-button v-for=\"percentage in [25, 50, 75]\" :key=\"percentage\" size=\"small\"\r\n                        @click=\"setUnstakePercentage(percentage)\">\r\n                        {{ percentage }}%\r\n                      </el-button>\r\n                      <el-button @click=\"setMaxUnstake\" class=\"max-button\" size=\"small\">\r\n                        {{ $t('common.max') }}\r\n                      </el-button>\r\n                    </div>\r\n\r\n                    <!-- Note: Early unstake penalty not available in current contract -->\r\n                    <div v-if=\"false\" class=\"warning-info early-unstake\">\r\n                      <el-icon>\r\n                        <Warning />\r\n                      </el-icon>\r\n                      <span>{{ $t('staking.earlyUnstakeWarning', { penalty: 0 }) }}</span>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <!-- Unstaking Preview -->\r\n                  <div v-if=\"unstakePreviewData\" class=\"preview-section\">\r\n                    <h4 class=\"preview-title\">{{ $t('staking.preview') }}</h4>\r\n                    <div class=\"preview-details\">\r\n                      <div class=\"preview-row\">\r\n                        <span>{{ $t('staking.required') }}</span>\r\n                        <span class=\"preview-value\">{{ formatNumber(unstakePreviewData.shares, 2) }} stCINA</span>\r\n                      </div>\r\n                      <div class=\"preview-row exchange-rate\">\r\n                        <span>{{ $t('staking.exchangeRate') }}</span>\r\n                        <span class=\"preview-value\">1 stCINA ≈ {{ formatNumber(stakingStore.navCina, 6) }} CINA</span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <el-button type=\"primary\" size=\"large\"\r\n                    :loading=\"transactionStatus === 'loading' && activeTab === 'unstake'\" :disabled=\"!isUnstakeValid\"\r\n                    @click=\"handleUnstake\" class=\"action-button\">\r\n                    {{ $t('staking.unstakeCINA') }}\r\n                  </el-button>\r\n                </div>\r\n              </div>\r\n            </el-tab-pane>\r\n\r\n          </el-tabs>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Transaction Modal -->\r\n      <TransactionModal v-model:visible=\"showTransactionModal\" :title=\"transactionModalTitle\" :steps=\"transactionSteps\"\r\n        :current-step=\"currentTransactionStep\" :status=\"transactionStatus\" :transaction-details=\"transactionDetails\"\r\n        :transaction-hash=\"transactionHash\" :error-message=\"transactionError\" @close=\"handleTransactionModalClose\"\r\n        @retry=\"handleTransactionRetry\" />\r\n    </div>\r\n  </PullToRefresh>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted, watch } from 'vue'\r\nimport { useI18n } from 'vue-i18n'\r\nimport { ElMessage } from 'element-plus'\r\nimport {\r\n  Warning\r\n} from '@element-plus/icons-vue'\r\nimport { parseUnits } from 'ethers'\r\n\r\nimport TransactionModal from '@/components/common/TransactionModal.vue'\r\nimport AnimatedNumber from '@/components/common/AnimatedNumber.vue'\r\nimport PullToRefresh from '@/components/common/PullToRefresh.vue'\r\nimport FormattedInput from '@/components/common/FormattedInput.vue'\r\nimport { useWalletStore } from '@/stores/wallet'\r\nimport { useStakingStore } from '@/stores/staking'\r\nimport { contractService } from '@/services/contracts'\r\nimport { formatNumber, formatNumberK, calculatePercentageAmount } from '@/utils/format'\r\nimport { debounce } from '@/utils/debounce'\r\nimport { usePullToRefresh } from '@/composables/usePullToRefresh'\r\n\r\nconst { t } = useI18n()\r\nconst walletStore = useWalletStore()\r\nconst stakingStore = useStakingStore()\r\n\r\nconst activeTab = ref('stake')\r\nconst stakeAmount = ref('')\r\nconst unstakeAmount = ref('')\r\nconst stakePreviewData = ref({\r\n  shares: '',\r\n  fee: '0'\r\n})\r\nconst unstakePreviewData = ref({\r\n  shares: ''\r\n})\r\n\r\n// Transaction Modal\r\nconst showTransactionModal = ref(false)\r\nconst transactionModalTitle = ref('')\r\nconst currentTransactionStep = ref(0)\r\nconst transactionStatus = ref<'pending' | 'loading' | 'success' | 'error'>('pending')\r\nconst transactionHash = ref('')\r\nconst transactionError = ref('')\r\n\r\nconst transactionSteps = ref([\r\n  { label: t('transaction.approve'), description: t('transaction.approveDescription') },\r\n  { label: t('transaction.confirm'), description: t('transaction.confirmDescription') },\r\n  { label: t('transaction.complete'), description: t('transaction.completeDescription') }\r\n])\r\n\r\nconst transactionDetails = computed(() => {\r\n  const details: {\r\n    label: string\r\n    value: string\r\n    highlight?: boolean\r\n    type?: 'debit' | 'credit'\r\n  }[] = []\r\n\r\n  if (activeTab.value === 'stake' && stakeAmount.value) {\r\n    details.push(\r\n      { label: t('pay'), value: `-${formatNumber(stakeAmount.value, 6)} CINA`, highlight: true, type: 'debit' },\r\n      { label: t('receive'), value: `+${formatNumber(stakePreviewData.value?.shares || '0', 6)} stCINA`, type: 'credit' }\r\n    )\r\n  } else if (activeTab.value === 'unstake' && unstakeAmount.value) {\r\n    details.push(\r\n      { label: t('pay'), value: `-${formatNumber(unstakePreviewData.value?.shares || '0', 6)} stCINA`, type: 'debit' },\r\n      { label: t('receive'), value: `+${formatNumber(unstakeAmount.value, 6)} CINA`, highlight: true, type: 'credit' },\r\n    )\r\n  }\r\n\r\n  return details\r\n})\r\n\r\n// Computed properties\r\nconst isStakeValid = computed(() => {\r\n  const amount = parseFloat(stakeAmount.value)\r\n  return amount > 0 &&\r\n    amount <= parseFloat(stakingStore.cinaBalance) &&\r\n    amount >= parseFloat(stakingStore.minStakeAmount)\r\n})\r\n\r\nconst isUnstakeValid = computed(() => {\r\n  const amount = parseFloat(unstakeAmount.value)\r\n  return amount > 0 && amount <= parseFloat(stakingStore.stakedAmount)\r\n})\r\n\r\nconst showMinStakeWarning = computed(() => {\r\n  const amount = parseFloat(stakeAmount.value)\r\n  return amount > 0 && amount < parseFloat(stakingStore.minStakeAmount)\r\n})\r\n\r\n// Debounced preview functions\r\nconst debouncedStakePreview = debounce(async (amount: string) => {\r\n  if (amount && parseFloat(amount) > 0) {\r\n    try {\r\n      stakePreviewData.value = await stakingStore.previewDeposit(amount)\r\n      console.log(stakePreviewData.value);\r\n    } catch (error) {\r\n      console.error('Failed to preview stake:', error)\r\n    }\r\n  } else {\r\n    stakePreviewData.value = { shares: '', fee: '0' }\r\n  }\r\n}, 500)\r\n\r\nconst debouncedUnstakePreview = debounce(async (amount: string) => {\r\n  if (amount && parseFloat(amount) > 0) {\r\n    try {\r\n      unstakePreviewData.value = await stakingStore.previewWithdraw(amount)\r\n    } catch (error) {\r\n      console.error('Failed to preview unstake:', error)\r\n    }\r\n  } else {\r\n    unstakePreviewData.value = { shares: '' }\r\n  }\r\n}, 500)\r\n\r\n// Methods\r\nconst handleStakeAmountChange = (value: string) => {\r\n  const cleanValue = value.replace(/[^0-9.]/g, '')\r\n  stakeAmount.value = cleanValue\r\n  debouncedStakePreview(cleanValue)\r\n}\r\n\r\nconst handleUnstakeAmountChange = (value: string) => {\r\n  const cleanValue = value.replace(/[^0-9.]/g, '')\r\n  unstakeAmount.value = cleanValue\r\n  debouncedUnstakePreview(cleanValue)\r\n}\r\n\r\nconst setStakePercentage = (percentage: number) => {\r\n  const amount = calculatePercentageAmount(stakingStore.cinaBalance, percentage)\r\n  stakeAmount.value = amount\r\n  debouncedStakePreview(amount)\r\n}\r\n\r\nconst setMaxStake = () => {\r\n  stakeAmount.value = stakingStore.cinaBalance\r\n  debouncedStakePreview(stakingStore.cinaBalance)\r\n}\r\n\r\nconst setUnstakePercentage = (percentage: number) => {\r\n  const amount = calculatePercentageAmount(stakingStore.stakedAmount, percentage)\r\n  unstakeAmount.value = amount\r\n  debouncedUnstakePreview(amount)\r\n}\r\n\r\nconst setMaxUnstake = () => {\r\n  unstakeAmount.value = stakingStore.stakedAmount\r\n  debouncedUnstakePreview(stakingStore.stakedAmount)\r\n}\r\n\r\nconst handleStake = async () => {\r\n  if (!isStakeValid.value || !walletStore.isConnected) return\r\n\r\n  transactionModalTitle.value = t('staking.stakeTransaction')\r\n  showTransactionModal.value = true\r\n  currentTransactionStep.value = 0\r\n  transactionStatus.value = 'pending'\r\n\r\n  try {\r\n    const amountWei = parseUnits(stakeAmount.value, 18)\r\n\r\n    // Step 1: Check and approve CINA if needed\r\n    const stakingContract = contractService.getStakingVaultContract(true)\r\n    const cinaContract = contractService.getCINAContract(true)\r\n\r\n    if (!stakingContract || !cinaContract) {\r\n      throw new Error('Contract not available')\r\n    }\r\n\r\n    const stakingAddress = await stakingContract.getAddress()\r\n    const allowance = await cinaContract.allowance(walletStore.address, stakingAddress)\r\n\r\n    if (allowance < amountWei) {\r\n      transactionStatus.value = 'loading'\r\n      const approveTx = await cinaContract.approve(stakingAddress, amountWei)\r\n      await approveTx.wait()\r\n    }\r\n\r\n    currentTransactionStep.value = 1\r\n\r\n    // Step 2: Execute staking\r\n    transactionStatus.value = 'loading'\r\n    const depositTx = await stakingContract.deposit(amountWei, walletStore.address)\r\n    const receipt = await depositTx.wait()\r\n\r\n    transactionHash.value = receipt.hash\r\n    currentTransactionStep.value = 2\r\n    transactionStatus.value = 'success'\r\n\r\n    // Reset form and refresh data\r\n    stakeAmount.value = ''\r\n    await stakingStore.fetchStakingData()\r\n    currentTransactionStep.value = 3\r\n    ElMessage.success(t('staking.stakeSuccess'))\r\n  } catch (error: any) {\r\n    transactionStatus.value = 'error'\r\n    transactionError.value = error.message || t('staking.stakeFailed')\r\n    console.error('Stake failed:', error)\r\n  }\r\n}\r\n\r\nconst handleUnstake = async () => {\r\n  if (!isUnstakeValid.value || !walletStore.isConnected) return\r\n\r\n  transactionModalTitle.value = t('staking.unstakeTransaction')\r\n  showTransactionModal.value = true\r\n  currentTransactionStep.value = 1\r\n  transactionStatus.value = 'loading'\r\n\r\n  try {\r\n    const amountWei = parseUnits(unstakeAmount.value, 18)\r\n\r\n    // Execute unstaking\r\n    const stakingContract = contractService.getStakingVaultContract(true)\r\n    if (!stakingContract) {\r\n      throw new Error('Contract not available')\r\n    }\r\n\r\n    if (unstakeAmount.value == stakingStore.stakedAmount) {\r\n      const withdrawTx = await stakingContract.redeem(\r\n        parseUnits(stakingStore.stCINABalance, 18),\r\n        walletStore.address,\r\n        walletStore.address\r\n      )\r\n      const receipt = await withdrawTx.wait()\r\n      transactionHash.value = receipt.hash\r\n    } else {\r\n      const withdrawTx = await stakingContract.withdraw(amountWei, walletStore.address, walletStore.address)\r\n      const receipt = await withdrawTx.wait()\r\n      transactionHash.value = receipt.hash\r\n    }\r\n\r\n    currentTransactionStep.value = 2\r\n    transactionStatus.value = 'success'\r\n\r\n    // Reset form and refresh data\r\n    unstakeAmount.value = ''\r\n    await stakingStore.fetchStakingData()\r\n    currentTransactionStep.value = 3\r\n    ElMessage.success(t('staking.unstakeSuccess'))\r\n  } catch (error: any) {\r\n    transactionStatus.value = 'error'\r\n    transactionError.value = error.message || t('staking.unstakeFailed')\r\n    console.error('Unstake failed:', error)\r\n  }\r\n}\r\n\r\n// Pull to refresh functionality\r\nconst refreshData = async () => {\r\n  if (walletStore.isConnected) {\r\n    await stakingStore.fetchStakingData()\r\n  }\r\n}\r\n\r\nconst { isRefreshing, pullDistance, isPulling, canRefresh } = usePullToRefresh({\r\n  onRefresh: refreshData,\r\n  enabled: true\r\n})\r\n\r\n// Lifecycle\r\nonMounted(async () => {\r\n  if (walletStore.isConnected) {\r\n    await stakingStore.fetchStakingData()\r\n    await stakingStore.startAutoRefresh()\r\n  }\r\n})\r\n\r\n// Watch for wallet connection changes\r\nwatch(\r\n  () => walletStore.isConnected,\r\n  async (connected) => {\r\n    if (connected) {\r\n      await stakingStore.fetchStakingData()\r\n    }\r\n  }\r\n)\r\n\r\n// Watch for tab changes and reset input fields\r\nwatch(activeTab, (newTab) => {\r\n  // Reset input amounts when switching tabs\r\n  stakeAmount.value = ''\r\n  unstakeAmount.value = ''\r\n})\r\n\r\nconst handleTransactionModalClose = () => {\r\n  showTransactionModal.value = false\r\n  transactionHash.value = ''\r\n  transactionError.value = ''\r\n}\r\n\r\nconst handleTransactionRetry = () => {\r\n  if (activeTab.value === 'stake') {\r\n    handleStake()\r\n  } else {\r\n    handleUnstake()\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.staking {\r\n  @apply min-h-screen bg-gray-50 dark:bg-gray-900;\r\n}\r\n\r\n.staking-content {\r\n  @apply max-w-xl mx-auto px-6 py-8;\r\n}\r\n\r\n.section-title {\r\n  @apply text-2xl font-bold text-gray-900 dark:text-white mb-6;\r\n}\r\n\r\n.overview-grid {\r\n  @apply grid grid-cols-1 gap-6 mb-8;\r\n}\r\n\r\n.overview-card {\r\n  @apply bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700;\r\n}\r\n\r\n.card-header {\r\n  @apply flex items-center justify-between mb-4;\r\n}\r\n\r\n.card-title {\r\n  @apply text-sm font-medium text-gray-600 dark:text-gray-400;\r\n}\r\n\r\n.card-icon {\r\n  @apply text-xl text-primary-500;\r\n}\r\n\r\n.card-value {\r\n  @apply text-2xl font-bold text-gray-700 dark:text-white mb-2 flex items-center gap-2;\r\n}\r\n\r\n.token-icon {\r\n  @apply w-8 h-8 rounded-full object-cover;\r\n}\r\n\r\n.animated-number {\r\n  @apply flex items-center;\r\n}\r\n\r\n.token-symbol {\r\n  @apply text-lg font-medium text-gray-600 dark:text-gray-400;\r\n}\r\n\r\n.card-subtitle {\r\n  @apply text-sm font-medium text-gray-500 dark:text-gray-400;\r\n}\r\n\r\n.action-section {\r\n  @apply bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 mb-8;\r\n}\r\n\r\n.staking-tabs {\r\n  @apply p-6;\r\n}\r\n\r\n.tab-content {\r\n  @apply mt-6;\r\n}\r\n\r\n.action-form {\r\n  @apply space-y-6;\r\n}\r\n\r\n.input-section {\r\n  @apply space-y-4;\r\n}\r\n\r\n.input-group {\r\n  @apply space-y-2;\r\n}\r\n\r\n.amount-input {\r\n  @apply w-full;\r\n}\r\n\r\n.input-suffix {\r\n  @apply text-gray-500 dark:text-gray-400 font-medium;\r\n}\r\n\r\n.quick-amounts {\r\n  @apply flex space-x-2;\r\n}\r\n\r\n.max-button {\r\n  @apply text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300;\r\n}\r\n\r\n.balance-info {\r\n  @apply flex justify-between items-center text-sm;\r\n}\r\n\r\n.balance-label {\r\n  @apply text-gray-600 dark:text-gray-400;\r\n}\r\n\r\n.balance-value {\r\n  @apply font-medium text-gray-900 dark:text-white;\r\n}\r\n\r\n.warning-info {\r\n  @apply flex items-center gap-2 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg text-sm text-yellow-800 dark:text-yellow-200;\r\n}\r\n\r\n.warning-info.early-unstake {\r\n  @apply bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 text-red-800 dark:text-red-200;\r\n}\r\n\r\n.preview-section {\r\n  @apply bg-gray-50 dark:bg-gray-700 rounded-lg p-4;\r\n}\r\n\r\n.preview-title {\r\n  @apply text-sm font-medium text-gray-700 dark:text-gray-300 mb-3;\r\n}\r\n\r\n.preview-details {\r\n  @apply space-y-2;\r\n}\r\n\r\n.preview-row {\r\n  @apply flex justify-between items-center text-sm;\r\n}\r\n\r\n.preview-row span:first-child {\r\n  @apply text-gray-600 dark:text-gray-400;\r\n}\r\n\r\n.preview-value {\r\n  @apply font-medium text-gray-700 dark:text-white;\r\n}\r\n\r\n.preview-row.penalty .preview-value {\r\n  @apply text-red-600 dark:text-red-400;\r\n}\r\n\r\n.exchange-rate {\r\n  @apply pt-2 border-t border-gray-200 dark:border-gray-600;\r\n}\r\n\r\n.preview-row.exchange-rate .preview-value {\r\n  @apply text-primary-400 dark:text-primary-300 font-semibold;\r\n}\r\n\r\n.action-button {\r\n  @apply w-full h-12 text-base font-medium;\r\n}\r\n\r\n\r\n\r\n:deep(.el-tabs__header) {\r\n  @apply mb-0;\r\n}\r\n\r\n:deep(.el-tabs__nav-wrap::after) {\r\n  @apply bg-gray-200 dark:bg-gray-700;\r\n}\r\n\r\n:deep(.el-tabs__active-bar) {\r\n  @apply bg-primary-500;\r\n}\r\n\r\n:deep(.el-tabs__item) {\r\n  @apply text-gray-600 dark:text-gray-400;\r\n}\r\n\r\n:deep(.el-tabs__item.is-active) {\r\n  @apply text-primary-600 dark:text-primary-400;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .staking-content {\r\n    @apply px-4 py-6;\r\n  }\r\n\r\n  .overview-grid {\r\n    @apply grid-cols-1 gap-4;\r\n  }\r\n}\r\n</style>"],"names":["useStakingStore","defineStore","yourStaked","ref","totalSupply","cinaBalance","stCINABalance","stakedAmount","currentAPY","minStakeAmount","navCina","incrementAmount","userIncrementAmount","isLoading","lastUpdateTime","fetchStakingData","walletStore","useWalletStore","stakingContract","contractService","fetchUserStakingData","totalSupplyResult","navCinaResult","minStakeAmountResult","incrementAmountResult","yourStakedResult","lastDayRewardAmountResult","formatUnits","rewardFloat","totalSupplyFloat","error","cinaContract","cinaBalanceResult","stCINABalanceResult","userStakedAmountResult","previewDeposit","amount","contract","amountWei","parseUnits","shares","previewWithdraw","assetsWei","refreshInterval","t","useI18n","stakingStore","activeTab","stakeAmount","unstakeAmount","stakePreviewData","unstakePreviewData","showTransactionModal","transactionModalTitle","currentTransactionStep","transactionStatus","transactionHash","transactionError","transactionSteps","transactionDetails","computed","details","formatNumber","isStakeValid","isUnstakeValid","showMinStakeWarning","debouncedStakePreview","debounce","debouncedUnstakePreview","handleStakeAmountChange","value","cleanValue","handleUnstakeAmountChange","setStakePercentage","percentage","calculatePercentageAmount","setMaxStake","setUnstakePercentage","setMaxUnstake","handleStake","stakingAddress","receipt","ElMessage","handleUnstake","refreshData","isRefreshing","pullDistance","isPulling","canRefresh","usePullToRefresh","onMounted","watch","connected","newTab","handleTransactionModalClose","handleTransactionRetry","_createBlock","PullToRefresh","_unref","_createElementVNode","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_toDisplayString","$t","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_imports_0","_createVNode","AnimatedNumber","_hoisted_11","_component_el_tabs","$event","_component_el_tab_pane","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","FormattedInput","formatNumberK","_cache","_hoisted_16","_createElementBlock","_Fragment","_renderList","_component_el_button","_createTextVNode","_openBlock","_hoisted_17","_component_el_icon","Warning","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","TransactionModal"],"mappings":"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"}