{"version":3,"file":"Farm-CBZcT6l5.js","sources":["../../src/stores/farm.ts","../../src/views/Farm.vue"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\nimport { formatUnits } from 'ethers'\r\nimport { useWalletStore } from './wallet'\r\nimport { contractService } from '../services/contracts'\r\nimport BigNumber from 'bignumber.js'\r\n\r\nexport const useFarmStore = defineStore('farm', () => {\r\n  // State\r\n  const liquidityAmount = ref('0') // Total USDT deposited in AMO\r\n  const incrementAmount = ref('0') // Increment amount\r\n  const usdtBalance = ref('0') // User's USDT balance\r\n  const depositedAmount = ref('0') // User's deposited USDT amount\r\n  const pendingCINA = ref('0') // User's pending CINA rewards\r\n  const farmAPY = ref('0') // Current farm APY\r\n  const farmRate = ref('0') // CINA farm rate per USDT per second\r\n  const exchangeRate = ref('1.0') // USDT to CINA exchange rate\r\n  const minDepositAmount = ref('10.0') // Minimum deposit amount\r\n  const depositFee = ref('0.001') // Deposit fee (0.1%)\r\n  const withdrawalFee = ref('0.002') // Withdrawal fee (0.2%)\r\n  const lastClaimTime = ref(0) // Last claim timestamp\r\n  const depositTime = ref(0) // User's deposit timestamp\r\n  const isLoading = ref(false)\r\n  const lastUpdateTime = ref(0)\r\n\r\n\r\n  // Form state\r\n  const depositInProgress = ref(false)\r\n  const claimInProgress = ref(false)\r\n  const withdrawInProgress = ref(false)\r\n\r\n  // Getters\r\n  const usdtBalanceFormatted = computed(() => {\r\n    return new BigNumber(formatUnits(usdtBalance.value, 6)).toFixed(2) // USDT has 6 decimals\r\n  })\r\n\r\n  const depositedAmountFormatted = computed(() => {\r\n    return new BigNumber(formatUnits(depositedAmount.value, 6)).toFixed(2)\r\n  })\r\n\r\n  // Actions\r\n  const fetchFarmData = async () => {\r\n    const walletStore = useWalletStore()\r\n\r\n    if (!walletStore.isConnected) return\r\n\r\n    try {\r\n      isLoading.value = true\r\n\r\n      // Get Farm Vault contract\r\n      const farmVaultContract = contractService.getFarmVaultContract()\r\n      if (!farmVaultContract) throw new Error('Farm Vault contract not available')\r\n\r\n      // Fetch farm data from contract\r\n      const [totalSupply, rewardRate, rewardForDuration, remainingTime, earnedAmount, userBalance] = await Promise.all([\r\n        farmVaultContract.totalSupply(),\r\n        farmVaultContract.rewardRate(),\r\n        farmVaultContract.getRewardForDuration(),\r\n        farmVaultContract.getRemainingTime(),\r\n        farmVaultContract.earned(walletStore.address),\r\n        farmVaultContract.balanceOf(walletStore.address)\r\n      ])\r\n\r\n      // Update farm data\r\n      liquidityAmount.value = formatUnits(totalSupply, 6) // Assuming USDT (6 decimals)\r\n      farmRate.value = formatUnits(rewardRate, 18) // CINA rewards per second\r\n      pendingCINA.value = formatUnits(earnedAmount, 18)\r\n      incrementAmount.value = new BigNumber(farmRate.value).multipliedBy(userBalance).dividedBy(totalSupply).toFixed(18)\r\n\r\n      // Calculate APY based on reward rate and total supply\r\n      if (totalSupply > 0) {\r\n        const annualRewards = parseFloat(farmRate.value) * 365 * 24 * 60 * 60\r\n        const totalSupplyFormatted = parseFloat(formatUnits(totalSupply, 6))\r\n        farmAPY.value = ((annualRewards / totalSupplyFormatted) * 100).toFixed(2)\r\n      } else {\r\n        farmAPY.value = '0'\r\n      }\r\n\r\n      // Fetch user-specific data if connected\r\n      if (walletStore.address) {\r\n        await fetchUserFarmData()\r\n      }\r\n\r\n      lastUpdateTime.value = Date.now()\r\n    } catch (error: any) {\r\n      console.error('Failed to fetch farm data:', error)\r\n      // appStore.addNotification({\r\n      //   type: 'error',\r\n      //   title: 'Data Fetch Failed',\r\n      //   message: error.message || 'Failed to fetch farm data'\r\n      // })\r\n    } finally {\r\n      isLoading.value = false\r\n    }\r\n  }\r\n\r\n  const fetchUserFarmData = async () => {\r\n    const walletStore = useWalletStore()\r\n    if (!walletStore.address) return\r\n\r\n    try {\r\n      const usdtCantoContract = contractService.getUSDTContract()\r\n      if (!usdtCantoContract) throw new Error('USDT contract not available')\r\n\r\n      const [userBalance, userDeposit] = await Promise.all([\r\n        usdtCantoContract.balanceOf(walletStore.address),\r\n        contractService.getFarmVaultContract()?.balanceOf(walletStore.address)\r\n      ])\r\n\r\n      usdtBalance.value = formatUnits(userBalance, 6)\r\n      depositedAmount.value = formatUnits(userDeposit, 6)\r\n    } catch (error) {\r\n      console.error('Failed to fetch user farm data:', error)\r\n    }\r\n  }\r\n\r\n  // Auto-refresh data\r\n  let refreshInterval: NodeJS.Timeout | null = null\r\n\r\n  const startAutoRefresh = () => {\r\n    if (refreshInterval) {\r\n      clearInterval(refreshInterval)\r\n    }\r\n\r\n    refreshInterval = setInterval(() => {\r\n      if (Date.now() - lastUpdateTime.value > 15000) { // 15 seconds\r\n        fetchFarmData()\r\n      }\r\n    }, 15000)\r\n  }\r\n\r\n  const stopAutoRefresh = () => {\r\n    if (refreshInterval) {\r\n      clearInterval(refreshInterval)\r\n      refreshInterval = null\r\n    }\r\n  }\r\n\r\n  return {\r\n    // State\r\n    liquidityAmount,\r\n    incrementAmount,\r\n    usdtBalance,\r\n    depositedAmount,\r\n    pendingCINA,\r\n    farmAPY,\r\n    farmRate,\r\n    exchangeRate,\r\n    minDepositAmount,\r\n    depositFee,\r\n    withdrawalFee,\r\n    lastClaimTime,\r\n    depositTime,\r\n    isLoading,\r\n\r\n    depositInProgress,\r\n    claimInProgress,\r\n    withdrawInProgress,\r\n\r\n    // Getters\r\n    usdtBalanceFormatted,\r\n    depositedAmountFormatted,\r\n\r\n    // Actions\r\n    fetchFarmData,\r\n    fetchUserFarmData,\r\n    startAutoRefresh,\r\n    stopAutoRefresh,\r\n\r\n    // Computed getters for reactive access\r\n    get loading() { return isLoading.value }\r\n  }\r\n})","<template>\r\n  <div class=\"farm\">\r\n    <PullToRefresh :is-pulling=\"isPulling\" :is-refreshing=\"isRefreshing\" :pull-distance=\"pullDistance\"\r\n      :can-refresh=\"canRefresh\">\r\n      <div class=\"farm-content\">\r\n        <!-- Farm Overview -->\r\n        <div class=\"farm-overview\">\r\n          <h2 class=\"section-title\">\r\n            {{ $t('farm.overview') }}\r\n          </h2>\r\n\r\n          <div class=\"overview-grid\">\r\n            <!-- Your CINA Mined -->\r\n            <div class=\"overview-card\">\r\n              <div class=\"card-header\">\r\n                <h3 class=\"card-title\">{{ $t('farm.yourMined') }}</h3>\r\n                <div class=\"card-subtitle\">\r\n                  {{ $t('farm.apy') }} {{ formatNumber(farmStore.farmAPY) }}%\r\n                </div>\r\n              </div>\r\n              <div class=\"card-value\">\r\n                <img src=\"../assets/logo.png\" alt=\"\" class=\"token-icon\">\r\n                <AnimatedNumber class=\"animated-number\" :value=\"farmStore.pendingCINA\" :decimals=\"8\"\r\n                  :auto-increment=\"walletStore.isConnected\" :increment-amount=\"parseFloat(farmStore.incrementAmount)\"\r\n                  :increment-interval=\"1000\" :cache-key=\"`totalCINAMined_${walletStore.address}`\" :use-cache=\"false\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Farm Actions -->\r\n        <div class=\"action-section\">\r\n          <el-tabs v-model=\"activeTab\" class=\"farm-tabs\">\r\n            <!-- Deposit Token Tab -->\r\n            <el-tab-pane :label=\"$t('farm.deposit')\" name=\"deposit\">\r\n              <div class=\"tab-content\">\r\n                <div class=\"action-form\">\r\n                  <div class=\"input-section\">\r\n                    <div class=\"input-group\">\r\n                      <div class=\"input-with-select\">\r\n                        <FormattedInput v-model=\"depositAmount\"\r\n                          :placeholder=\"formatNumberK(farmStore.usdtBalance) + '  ' + $t('available')\" size=\"large\"\r\n                          class=\"amount-input\" :decimals=\"6\" :use-abbreviation=\"true\" />\r\n                        <TokenSelect v-model=\"depositToken\" :tokens=\"availableTokens\" placeholder=\"Select token\" />\r\n                      </div>\r\n                    </div>\r\n\r\n                    <!-- Quick Amount Buttons -->\r\n                    <div class=\"quick-amounts\">\r\n                      <el-button v-for=\"percentage in [25, 50, 75]\" :key=\"percentage\" size=\"small\"\r\n                        @click=\"setDepositPercentage(percentage)\">\r\n                        {{ percentage }}%\r\n                      </el-button>\r\n                      <el-button @click=\"setMaxDeposit\" class=\"max-button\" size=\"small\">\r\n                        {{ $t('common.max') }}\r\n                      </el-button>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <!-- Farm Preview -->\r\n                  <div v-if=\"depositPreview\" class=\"preview-section\">\r\n                    <h4 class=\"preview-title\">{{ $t('farm.preview') }}</h4>\r\n                    <div class=\"preview-details\">\r\n                      <div class=\"preview-row\">\r\n                        <span>{{ $t('farm.dailyReward') }}</span>\r\n                        <span class=\"preview-value\">{{ formatNumber(depositPreview.dailyReward, 2) }} CINA</span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <el-button type=\"primary\" size=\"large\" :loading=\"farmStore.depositInProgress\"\r\n                    :disabled=\"!isDepositValid\" @click=\"handleDeposit\" class=\"action-button\">\r\n                    {{ $t('farm.deposit') }}\r\n                  </el-button>\r\n                </div>\r\n              </div>\r\n            </el-tab-pane>\r\n\r\n            <!-- Withdraw Token Tab -->\r\n            <el-tab-pane :label=\"$t('farm.withdraw')\" name=\"withdraw\">\r\n              <div class=\"tab-content\">\r\n                <div class=\"action-form\">\r\n                  <div class=\"input-section\">\r\n                    <div class=\"input-group\">\r\n                      <div class=\"input-with-select\">\r\n                        <FormattedInput v-model=\"withdrawAmount\"\r\n                          :placeholder=\"formatNumberK(farmStore.depositedAmount) + '  ' + $t('available')\" size=\"large\"\r\n                          class=\"amount-input\" :decimals=\"6\" :use-abbreviation=\"true\" />\r\n                        <TokenSelect v-model=\"withdrawToken\" :tokens=\"availableTokens\" placeholder=\"Select token\" />\r\n                      </div>\r\n                    </div>\r\n\r\n                    <!-- Quick Amount Buttons -->\r\n                    <div class=\"quick-amounts\">\r\n                      <el-button v-for=\"percentage in [25, 50, 75]\" :key=\"percentage\" size=\"small\"\r\n                        @click=\"setWithdrawPercentage(percentage)\">\r\n                        {{ percentage }}%\r\n                      </el-button>\r\n                      <el-button @click=\"setMaxWithdraw\" class=\"max-button\" size=\"small\">\r\n                        {{ $t('common.max') }}\r\n                      </el-button>\r\n                    </div>\r\n\r\n                    <!-- Claim CINA -->\r\n                    <div class=\"input-group\">\r\n                      <el-checkbox v-model=\"withdrawCINA\" class=\"withdraw-cina-checkbox\" @change=\"handleWithdrawCINAChange\">\r\n                        {{ $t('farm.withdrawCINA') }}\r\n                      </el-checkbox>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <!-- Withdraw Preview -->\r\n                  <div v-if=\"withdrawPreview || withdrawCINA\" class=\"preview-section\">\r\n                    <h4 class=\"preview-title\">{{ $t('farm.preview') }}</h4>\r\n                    <div class=\"preview-details\">\r\n                      <div v-if=\"withdrawPreview\" class=\"preview-row\">\r\n                        <span>Liquidity</span>\r\n                        <span class=\"preview-value liquidity-value\">{{ formatNumber(withdrawPreview.liquidityAmount, 2)\r\n                        }} {{\r\n                            withdrawToken?.symbol }}</span>\r\n                      </div>\r\n                      <div v-if=\"withdrawCINA\" class=\"preview-row\">\r\n                        <span>Farm Reward</span>\r\n                        <span class=\"preview-value\">{{ formatNumber(farmStore.pendingCINA, 2) }} CINA</span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <el-button type=\"primary\" size=\"large\"\r\n                    :loading=\"farmStore.withdrawInProgress || farmStore.claimInProgress\" :disabled=\"!isWithdrawValid\"\r\n                    @click=\"handleWithdraw\" class=\"action-button\">\r\n                    {{ withdrawCINA && (!withdrawAmount || parseFloat(withdrawAmount) === 0) ? $t('farm.claim') :\r\n                      $t('farm.withdraw') }}\r\n                  </el-button>\r\n                </div>\r\n              </div>\r\n            </el-tab-pane>\r\n          </el-tabs>\r\n        </div>\r\n      </div>\r\n    </PullToRefresh>\r\n\r\n    <!-- Transaction Modal -->\r\n    <TransactionModal v-model:visible=\"showTransactionModal\" :title=\"transactionModalTitle\" :steps=\"transactionSteps\"\r\n      :current-step=\"currentTransactionStep\" :status=\"transactionStatus\" :transaction-details=\"transactionDetails\"\r\n      :transaction-hash=\"transactionHash\" :error-message=\"transactionError\" @close=\"handleTransactionModalClose\"\r\n      @retry=\"handleTransactionRetry\" />\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted, watch } from 'vue'\r\nimport { useI18n } from 'vue-i18n'\r\nimport { ElMessage } from 'element-plus'\r\nimport { parseUnits } from 'ethers'\r\n\r\nimport AnimatedNumber from '@/components/common/AnimatedNumber.vue'\r\nimport TokenSelect from '@/components/TokenSelect.vue'\r\nimport TransactionModal from '@/components/common/TransactionModal.vue'\r\nimport PullToRefresh from '@/components/common/PullToRefresh.vue'\r\nimport FormattedInput from '@/components/common/FormattedInput.vue'\r\nimport { usePullToRefresh } from '@/composables/usePullToRefresh'\r\nimport { useWalletStore } from '@/stores/wallet'\r\nimport { useFarmStore } from '@/stores/farm'\r\nimport { contractService } from '@/services/contracts'\r\nimport { formatNumber, formatNumberK } from '@/utils/format'\r\nimport { TOKENS } from '@/constants'\r\n\r\n// Define types\r\ninterface Token {\r\n  symbol: string\r\n  name: string\r\n  address: string\r\n  decimals: number\r\n}\r\n\r\nconst { t } = useI18n()\r\nconst walletStore = useWalletStore()\r\nconst farmStore = useFarmStore()\r\n\r\n// Pull to refresh functionality\r\nconst { isRefreshing, pullDistance, isPulling, canRefresh, ...touchHandlers } = usePullToRefresh({\r\n  onRefresh: async (): Promise<void> => {\r\n    if (walletStore.isConnected) {\r\n      await farmStore.fetchFarmData()\r\n      await farmStore.fetchUserFarmData()\r\n    }\r\n  }\r\n})\r\n\r\n// Available tokens for farm\r\nconst availableTokens = computed<Token[]>(() => {\r\n  const chainId = walletStore.chainId || 11155111\r\n\r\n  return [\r\n    {\r\n      symbol: TOKENS.USDT.symbol,\r\n      name: TOKENS.USDT.name,\r\n      address: TOKENS.USDT.addresses[chainId as keyof typeof TOKENS.USDT.addresses] || TOKENS.USDT.addresses[11155111] || '0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238',\r\n      decimals: TOKENS.USDT.decimals\r\n    },\r\n    // {\r\n    //   symbol: TOKENS.USDC.symbol,\r\n    //   name: TOKENS.USDC.name,\r\n    //   address: TOKENS.USDC.addresses[chainId as keyof typeof TOKENS.USDC.addresses] || TOKENS.USDC.addresses[11155111] || '0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238',\r\n    //   decimals: TOKENS.USDC.decimals\r\n    // }\r\n  ]\r\n})\r\n\r\nconst activeTab = ref('deposit')\r\nconst depositAmount = ref('')\r\nconst withdrawAmount = ref('')\r\nconst withdrawCINA = ref(false) // 是否同时提取CINA的开关\r\nconst depositToken = ref<Token>()\r\nconst withdrawToken = ref<Token>()\r\n\r\n// Transaction Modal\r\nconst showTransactionModal = ref(false)\r\nconst transactionModalTitle = ref('')\r\nconst currentTransactionStep = ref(0)\r\nconst transactionStatus = ref<'pending' | 'loading' | 'success' | 'error'>('pending')\r\nconst transactionHash = ref('')\r\nconst transactionError = ref('')\r\n\r\nconst transactionSteps = ref([\r\n  { label: t('transaction.approve'), description: t('transaction.approveDescription') },\r\n  { label: t('transaction.confirm'), description: t('transaction.confirmDescription') },\r\n  { label: t('transaction.complete'), description: t('transaction.completeDescription') }\r\n])\r\n\r\nconst transactionDetails = computed(() => {\r\n  const details: {\r\n    label: string\r\n    value: string\r\n    highlight?: boolean\r\n    type?: 'debit' | 'credit'\r\n  }[] = []\r\n\r\n  if (activeTab.value === 'deposit' && depositAmount.value) {\r\n    details.push(\r\n      { label: t('pay'), value: `-${formatNumber(depositAmount.value, 2)} USDT`, highlight: true, type: 'debit' }\r\n    )\r\n  } else if (activeTab.value === 'withdraw') {\r\n    if (withdrawAmount.value) {\r\n      details.push(\r\n        { label: t('receive'), value: `+${formatNumber(withdrawAmount.value, 2)} USDT`, highlight: true, type: 'credit' }\r\n      )\r\n    }\r\n    if (withdrawCINA.value && parseFloat(farmStore.pendingCINA) > 0) {\r\n      details.push(\r\n        { label: t('receive'), value: `+${formatNumber(farmStore.pendingCINA, 6)} CINA`, type: 'credit' }\r\n      )\r\n    }\r\n  }\r\n\r\n  return details\r\n})\r\n\r\n// Initialize tokens\r\nwatch(availableTokens, (tokens) => {\r\n  if (tokens.length >= 1) {\r\n    if (!depositToken.value || depositToken.value.symbol !== tokens[0].symbol) {\r\n      depositToken.value = tokens[0]\r\n    }\r\n    if (!withdrawToken.value || withdrawToken.value.symbol !== tokens[0].symbol) {\r\n      withdrawToken.value = tokens[0]\r\n    }\r\n  }\r\n}, { immediate: true })\r\n\r\n// Computed properties\r\nconst isDepositValid = computed(() => {\r\n  const amount = parseFloat(depositAmount.value)\r\n  return amount > 0 && amount <= parseFloat(farmStore.usdtBalance)\r\n})\r\n\r\nconst isClaimValid = computed(() => {\r\n  return parseFloat(farmStore.pendingCINA) > 0\r\n})\r\n\r\nconst isWithdrawValid = computed(() => {\r\n  const amount = parseFloat(withdrawAmount.value)\r\n  // 如果勾选了withdrawCINA但没有输入金额，只要有可claim的CINA就有效\r\n  if (withdrawCINA.value && (!withdrawAmount.value || amount === 0)) {\r\n    return parseFloat(farmStore.pendingCINA) > 0\r\n  }\r\n  // 如果有输入金额，检查金额是否有效\r\n  return amount > 0 && amount <= parseFloat(farmStore.depositedAmount)\r\n})\r\n\r\nconst depositPreview = computed(() => {\r\n  const amount = parseFloat(depositAmount.value)\r\n  if (!amount || amount <= 0) return null\r\n\r\n  const exchangeRate = parseFloat(farmStore.exchangeRate)\r\n  const estimatedCINA = amount * exchangeRate\r\n  const dailyReward = estimatedCINA * parseFloat(farmStore.farmAPY) / 365 / 100\r\n\r\n  return {\r\n    estimatedCINA,\r\n    dailyReward\r\n  }\r\n})\r\n\r\nconst withdrawPreview = computed(() => {\r\n  const amount = parseFloat(withdrawAmount.value)\r\n  if (!amount || amount <= 0) return null\r\n\r\n  return {\r\n    rewardAmount: farmStore.pendingCINA,\r\n    liquidityAmount: farmStore.liquidityAmount\r\n  }\r\n})\r\n\r\nconst setDepositPercentage = (percentage: number) => {\r\n  const balance = parseFloat(farmStore.usdtBalance)\r\n  const amount = (balance * percentage / 100).toFixed(6)\r\n  depositAmount.value = amount\r\n}\r\n\r\nconst setMaxDeposit = () => {\r\n  depositAmount.value = farmStore.usdtBalance\r\n}\r\n\r\nconst handleDeposit = async () => {\r\n  if (!isDepositValid.value || !walletStore.isConnected) return\r\n\r\n  transactionModalTitle.value = t('savings.depositTransaction')\r\n  showTransactionModal.value = true\r\n  currentTransactionStep.value = 0\r\n  transactionStatus.value = 'pending'\r\n\r\n  try {\r\n    const amount = parseFloat(depositAmount.value)\r\n    const amountWei = parseUnits(amount.toString(), 6) // USDT has 6 decimals\r\n\r\n    // Step 1: Check and approve USDT if needed\r\n    transactionStatus.value = 'loading'\r\n\r\n    const usdtContract = contractService.getUSDTContract(true)\r\n    const farmContract = contractService.getFarmVaultContract(true)\r\n\r\n    if (!usdtContract || !farmContract) {\r\n      throw new Error('Contract not available')\r\n    }\r\n\r\n    const farmAddress = await farmContract.getAddress()\r\n    const allowance = await usdtContract.allowance(walletStore.address, farmAddress)\r\n\r\n    // Check and approve USDT if needed\r\n    if (allowance < amountWei) {\r\n      const approveTx = await usdtContract.approve(farmAddress, amountWei)\r\n      await approveTx.wait()\r\n    }\r\n\r\n    currentTransactionStep.value = 1\r\n\r\n    // Step 2: Execute deposit\r\n    const depositTx = await farmContract.deposit(amountWei)\r\n    currentTransactionStep.value = 2\r\n    const receipt = await depositTx.wait()\r\n\r\n    transactionHash.value = receipt.hash\r\n    currentTransactionStep.value = 3\r\n    transactionStatus.value = 'success'\r\n\r\n    // Reset form and refresh data\r\n    depositAmount.value = ''\r\n    await farmStore.fetchFarmData()\r\n    await farmStore.fetchUserFarmData()\r\n    ElMessage.success(t('farm.depositSuccess'))\r\n  } catch (error: any) {\r\n    transactionStatus.value = 'error'\r\n    transactionError.value = error.message || t('farm.depositFailed')\r\n    console.error('Deposit failed:', error)\r\n  }\r\n}\r\n\r\nconst setWithdrawPercentage = (percentage: number) => {\r\n  const balance = parseFloat(farmStore.depositedAmount)\r\n  const amount = (balance * percentage / 100).toFixed(6)\r\n  withdrawAmount.value = amount\r\n}\r\n\r\nconst setMaxWithdraw = () => {\r\n  withdrawAmount.value = farmStore.depositedAmount\r\n}\r\n\r\nconst handleWithdraw = async () => {\r\n  if (!walletStore.isConnected) return\r\n\r\n  transactionModalTitle.value = t('savings.withdrawTransaction')\r\n  showTransactionModal.value = true\r\n  currentTransactionStep.value = 1\r\n  transactionStatus.value = 'pending'\r\n\r\n  try {\r\n    const amount = parseFloat(withdrawAmount.value)\r\n    transactionStatus.value = 'loading'\r\n\r\n    const farmContract = contractService.getFarmVaultContract(true)\r\n    if (!farmContract) {\r\n      throw new Error('Farm contract not available')\r\n    }\r\n\r\n    // 如果勾选了withdrawCINA但没有输入金额，只执行claim\r\n    if (withdrawCINA.value && (!withdrawAmount.value || amount === 0)) {\r\n      if (parseFloat(farmStore.pendingCINA) > 0) {\r\n        // Execute getReward to claim CINA rewards\r\n        const claimTx = await farmContract.getReward()\r\n        currentTransactionStep.value = 2\r\n        const receipt = await claimTx.wait()\r\n\r\n        transactionHash.value = receipt.hash\r\n        transactionStatus.value = 'success'\r\n        ElMessage.success(t('farm.claimSuccess'))\r\n      }\r\n    } else {\r\n      // 执行USDT提现\r\n      const amountWei = parseUnits(amount.toString(), 6) // USDT has 6 decimals\r\n      // Execute withdraw with isClaim=false (only withdraw, don't claim rewards)\r\n      const withdrawTx = await farmContract.withdraw(amountWei, withdrawCINA.value ? 1 : 0)\r\n      currentTransactionStep.value = 2\r\n      const receipt = await withdrawTx.wait()\r\n\r\n      transactionHash.value = receipt.hash\r\n      transactionStatus.value = 'success'\r\n      ElMessage.success(t('farm.withdrawSuccess'))\r\n    }\r\n\r\n    currentTransactionStep.value = 3\r\n    withdrawAmount.value = ''\r\n    withdrawCINA.value = false // 重置开关状态\r\n\r\n    // Refresh data\r\n    await farmStore.fetchFarmData()\r\n    await farmStore.fetchUserFarmData()\r\n  } catch (error: any) {\r\n    transactionStatus.value = 'error'\r\n    transactionError.value = error.message || t('farm.withdrawFailed')\r\n    console.error('Withdraw failed:', error)\r\n  }\r\n}\r\n\r\nconst handleTransactionModalClose = () => {\r\n  showTransactionModal.value = false\r\n  transactionHash.value = ''\r\n  transactionError.value = ''\r\n}\r\n\r\nconst handleTransactionRetry = () => {\r\n  if (activeTab.value === 'deposit') {\r\n    handleDeposit()\r\n  } else {\r\n    handleWithdraw()\r\n  }\r\n}\r\n\r\nconst handleWithdrawCINAChange = async () => {\r\n  if (walletStore.isConnected){\r\n    await farmStore.fetchFarmData()\r\n  }\r\n}\r\n\r\n// Lifecycle\r\nonMounted(async () => {\r\n  if (walletStore.isConnected) {\r\n    await farmStore.fetchFarmData()\r\n  }\r\n})\r\n\r\n// Watch for wallet connection changes\r\nwatch(\r\n  () => walletStore.isConnected,\r\n  async (connected) => {\r\n    if (connected) {\r\n      await farmStore.fetchFarmData()\r\n    }\r\n  }\r\n)\r\n\r\n// Watch for tab changes and reset input fields\r\nwatch(activeTab, (newTab) => {\r\n  // Reset input amounts when switching tabs\r\n  depositAmount.value = ''\r\n  withdrawAmount.value = ''\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.farm {\r\n  @apply min-h-screen bg-gray-50 dark:bg-gray-900;\r\n}\r\n\r\n.farm-content {\r\n  @apply max-w-xl mx-auto px-6 py-8;\r\n}\r\n\r\n.section-title {\r\n  @apply text-2xl font-bold text-gray-900 dark:text-white mb-6;\r\n}\r\n\r\n.overview-grid {\r\n  @apply grid grid-cols-1 gap-6 mb-8;\r\n}\r\n\r\n.overview-card {\r\n  @apply bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700;\r\n}\r\n\r\n.card-header {\r\n  @apply flex items-center justify-between mb-4;\r\n}\r\n\r\n.card-title {\r\n  @apply text-sm font-medium text-gray-600 dark:text-gray-400;\r\n}\r\n\r\n.card-icon {\r\n  @apply text-xl text-primary-500;\r\n}\r\n\r\n.card-value {\r\n  @apply text-2xl font-bold text-gray-700 dark:text-white mb-2 flex items-center justify-between gap-2;\r\n}\r\n\r\n.token-icon {\r\n  @apply w-8 h-8 rounded-full object-cover;\r\n}\r\n\r\n.animated-number {\r\n  @apply flex items-center;\r\n}\r\n\r\n.card-value .animated-number {\r\n  @apply flex-1;\r\n}\r\n\r\n.card-actions {\r\n  @apply mt-4;\r\n}\r\n\r\n.token-symbol {\r\n  @apply text-lg font-medium text-gray-600 dark:text-gray-400;\r\n}\r\n\r\n.card-subtitle {\r\n  @apply text-sm font-medium text-gray-500 dark:text-gray-400;\r\n}\r\n\r\n.action-section {\r\n  @apply bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 mb-8;\r\n}\r\n\r\n.farm-tabs {\r\n  @apply p-6;\r\n}\r\n\r\n.tab-content {\r\n  @apply mt-6;\r\n}\r\n\r\n.action-form {\r\n  @apply space-y-6;\r\n}\r\n\r\n.input-section {\r\n  @apply space-y-4;\r\n}\r\n\r\n.input-group {\r\n  @apply space-y-2;\r\n}\r\n\r\n.amount-input {\r\n  @apply w-full;\r\n}\r\n\r\n.input-suffix {\r\n  @apply text-gray-500 dark:text-gray-400 font-medium;\r\n}\r\n\r\n.max-button {\r\n  @apply text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300;\r\n}\r\n\r\n.quick-amounts {\r\n  @apply flex space-x-2;\r\n}\r\n\r\n.balance-info {\r\n  @apply flex justify-between items-center text-sm;\r\n}\r\n\r\n.balance-label {\r\n  @apply text-gray-600 dark:text-gray-400;\r\n}\r\n\r\n.balance-value {\r\n  @apply font-medium text-gray-900 dark:text-white;\r\n}\r\n\r\n.preview-section {\r\n  @apply bg-gray-50 dark:bg-gray-700 rounded-lg p-4;\r\n}\r\n\r\n.preview-title {\r\n  @apply text-sm font-medium text-gray-700 dark:text-gray-300 mb-3;\r\n}\r\n\r\n.preview-details {\r\n  @apply space-y-2;\r\n}\r\n\r\n.preview-row {\r\n  @apply flex justify-between items-center text-sm;\r\n}\r\n\r\n.preview-row span:first-child {\r\n  @apply text-gray-600 dark:text-gray-400;\r\n}\r\n\r\n.preview-value {\r\n  @apply font-medium text-gray-600 dark:text-white;\r\n}\r\n\r\n.preview-row.fee .preview-value {\r\n  @apply text-red-600 dark:text-red-400;\r\n}\r\n\r\n.liquidity-value {\r\n  @apply text-yellow-600 dark:text-yellow-400 font-medium;\r\n}\r\n\r\n.fee-amount {\r\n  @apply text-red-600 dark:text-red-400;\r\n}\r\n\r\n.action-button {\r\n  @apply w-full h-12 text-base font-medium;\r\n}\r\n\r\n.claim-section {\r\n  @apply space-y-6;\r\n}\r\n\r\n.claim-info {\r\n  @apply bg-gradient-to-r from-primary-50 to-blue-50 dark:from-primary-900/20 dark:to-blue-900/20 rounded-lg p-6;\r\n}\r\n\r\n.claim-amount {\r\n  @apply text-center mb-4;\r\n}\r\n\r\n.claim-amount h3 {\r\n  @apply text-lg font-medium text-gray-700 dark:text-gray-300 mb-2;\r\n}\r\n\r\n.amount-display {\r\n  @apply text-3xl font-bold text-primary-600 dark:text-primary-400 flex items-center justify-center gap-2;\r\n}\r\n\r\n.claim-details {\r\n  @apply space-y-2;\r\n}\r\n\r\n.input-with-select {\r\n  @apply flex w-full;\r\n}\r\n\r\n.input-with-select .el-input {\r\n  @apply flex-1;\r\n}\r\n\r\n.token-select {\r\n  @apply ml-2 w-32;\r\n}\r\n\r\n.token-option {\r\n  @apply flex items-center gap-2;\r\n}\r\n\r\n.detail-row {\r\n  @apply flex justify-between items-center text-sm;\r\n}\r\n\r\n.detail-row span:first-child {\r\n  @apply text-gray-600 dark:text-gray-400;\r\n}\r\n\r\n.detail-row span:last-child {\r\n  @apply font-medium text-gray-900 dark:text-white;\r\n}\r\n\r\n.claim-button {\r\n  @apply bg-gradient-to-r from-primary-500 to-blue-500 hover:from-primary-600 hover:to-blue-600;\r\n}\r\n\r\n.card-value {\r\n  @apply relative flex items-start justify-between;\r\n}\r\n\r\n.value-content {\r\n  @apply flex items-baseline gap-2;\r\n}\r\n\r\n.claim-button-corner {\r\n  @apply absolute bottom-0 right-0 text-xs px-2 py-1;\r\n  @apply bg-gradient-to-r from-primary-500 to-blue-500 hover:from-primary-600 hover:to-blue-600;\r\n  @apply border-0 rounded-md shadow-sm;\r\n}\r\n\r\n\r\n\r\n:deep(.el-tabs__header) {\r\n  @apply mb-0;\r\n}\r\n\r\n:deep(.el-tabs__nav-wrap::after) {\r\n  @apply bg-gray-200 dark:bg-gray-700;\r\n}\r\n\r\n:deep(.el-tabs__active-bar) {\r\n  @apply bg-primary-500;\r\n}\r\n\r\n:deep(.el-tabs__item) {\r\n  @apply text-gray-600 dark:text-gray-400;\r\n}\r\n\r\n:deep(.el-tabs__item.is-active) {\r\n  @apply text-primary-600 dark:text-primary-400;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .farm-content {\r\n    @apply px-4 py-6;\r\n  }\r\n\r\n  .overview-grid {\r\n    @apply grid-cols-1 gap-4;\r\n  }\r\n}\r\n</style>"],"names":["useFarmStore","defineStore","liquidityAmount","ref","incrementAmount","usdtBalance","depositedAmount","pendingCINA","farmAPY","farmRate","exchangeRate","minDepositAmount","depositFee","withdrawalFee","lastClaimTime","depositTime","isLoading","lastUpdateTime","depositInProgress","claimInProgress","withdrawInProgress","usdtBalanceFormatted","computed","BigNumber","formatUnits","depositedAmountFormatted","fetchFarmData","walletStore","useWalletStore","farmVaultContract","contractService","totalSupply","rewardRate","rewardForDuration","remainingTime","earnedAmount","userBalance","annualRewards","totalSupplyFormatted","fetchUserFarmData","error","usdtCantoContract","userDeposit","refreshInterval","t","useI18n","farmStore","isRefreshing","pullDistance","isPulling","canRefresh","usePullToRefresh","availableTokens","chainId","TOKENS","activeTab","depositAmount","withdrawAmount","withdrawCINA","depositToken","withdrawToken","showTransactionModal","transactionModalTitle","currentTransactionStep","transactionStatus","transactionHash","transactionError","transactionSteps","transactionDetails","details","formatNumber","watch","tokens","isDepositValid","amount","isWithdrawValid","depositPreview","estimatedCINA","dailyReward","withdrawPreview","setDepositPercentage","percentage","setMaxDeposit","handleDeposit","amountWei","parseUnits","usdtContract","farmContract","farmAddress","depositTx","receipt","ElMessage","setWithdrawPercentage","setMaxWithdraw","handleWithdraw","claimTx","withdrawTx","handleTransactionModalClose","handleTransactionRetry","handleWithdrawCINAChange","onMounted","connected","newTab","_openBlock","_createElementBlock","_hoisted_1","_createVNode","PullToRefresh","_unref","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_toDisplayString","$t","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_imports_0","AnimatedNumber","_hoisted_11","_component_el_tabs","$event","_component_el_tab_pane","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","FormattedInput","formatNumberK","TokenSelect","_hoisted_17","_Fragment","_renderList","_component_el_button","_createTextVNode","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_component_el_checkbox","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_cache","_hoisted_34","_hoisted_35","_hoisted_36","TransactionModal"],"mappings":"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"}