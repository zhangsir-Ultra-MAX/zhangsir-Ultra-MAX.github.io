import{d as je,u as He,a as Je,r as c,c as y,S as Xe,w as Z,o as Ye,b as Ze,e as p,f as a,g as o,t as s,x as m,V as Qe,G as S,h as r,W as Q,E as ea,F as P,y as Ce,j as C,M as aa,K as Fe,X as $e,Y as ta,Z as sa,T as na,I as w,J as f,O as G,P as ce,_ as oa}from"./index-EBZBD7IP.js";import{u as ra,P as la}from"./usePullToRefresh-BJGuk06y.js";import{F as ee}from"./FormattedInput-DGcZDhfq.js";import{c as M}from"./contracts-LobIsjLE.js";import{f as _,b as D,c as ke}from"./format-DgO97vlP.js";import{d as Te}from"./debounce-CLGozXK5.js";/* empty css                 */const ia={class:"wrap"},ua={class:"wrap-content"},ca={class:"balance-overview"},da={class:"section-title"},pa={class:"wrap-interface"},va={class:"interface-card"},wa={class:"mode-toggle"},fa={key:0,class:"wrap-form"},ma={class:"form-section"},_a={class:"token-input"},ha={class:"input-header"},ga={class:"input-label"},ba={class:"balance-info"},Ma={class:"input-section"},Ra={class:"input-group"},Ba={key:0,class:"validation-error"},Wa={class:"error-text"},Aa={class:"quick-amounts"},ya={class:"swap-arrow"},Ca={class:"token-input"},Fa={class:"input-header"},$a={class:"input-label"},ka={class:"balance-info"},Ta={class:"input-group"},Ua={key:0,class:"preview-section"},xa={class:"preview-title"},Pa={class:"preview-details"},Va={class:"preview-row"},Sa={class:"fee-value"},Ea={class:"preview-row"},Na={class:"preview-value"},za={class:"preview-row exchange-rate"},Da={class:"preview-value"},Ia={key:1,class:"countdown-notice"},qa={class:"countdown-text"},Oa={key:1,class:"unwrap-form"},Ga={class:"form-section"},Ka={class:"token-input"},La={class:"input-header"},ja={class:"input-label"},Ha={class:"balance-info"},Ja={class:"input-section"},Xa={class:"input-group"},Ya={key:0,class:"validation-error"},Za={class:"error-text"},Qa={class:"quick-amounts"},et={class:"swap-arrow"},at={class:"token-input"},tt={class:"input-header"},st={class:"input-label"},nt={class:"balance-info"},ot={class:"input-group"},rt={key:0,class:"validation-error"},lt={class:"error-text"},it={key:0,class:"preview-section"},ut={class:"preview-title"},ct={class:"preview-details"},dt={class:"preview-row"},pt={class:"preview-value"},vt={class:"preview-row"},wt={class:"fee-value"},ft={class:"preview-row exchange-rate"},mt={class:"preview-value"},_t={key:1,class:"countdown-notice"},ht={class:"countdown-text"},gt={class:"info-section"},bt={class:"info-grid"},Mt={class:"info-card"},Rt={class:"info-header"},Bt={class:"info-title"},Wt={class:"info-content"},At={class:"info-card"},yt={class:"info-header"},Ct={class:"info-title"},Ft={class:"info-content"},$t={class:"info-card"},kt={class:"info-header"},Tt={class:"info-title"},Ut={class:"info-content"},xt=je({__name:"Wrap",setup(Pt){const{t:i}=He(),d=Je(),{isRefreshing:Ue,pullDistance:xe,isPulling:Pe,canRefresh:Ve}=ra({onRefresh:async()=>{try{d.isConnected&&await Promise.all([J(),ye(),H(),le()])}catch(e){console.error("Failed to refresh wrap data:",e)}}}),de=c(!1),W=c("wrap"),R=c(""),h=c(""),B=c(null),g=c(null),ae=c(!1),te=c(!1),E=c(0),N=c(0),F=c("0"),V=c("0"),b=c(null),z=c("0"),T=c("0"),K=c(null),se=c("0"),I=c(!1),ne=c(""),$=c(0),A=c("pending"),L=c(""),j=c("");c(null);const Se=y(()=>[{label:i("wrap.wrap"),value:"wrap"},{label:i("wrap.unwrap"),value:"unwrap"}]),Ee=c([{label:i("transaction.approve"),description:i("transaction.approveDescription")},{label:i("transaction.confirm"),description:i("transaction.confirmDescription")},{label:i("transaction.complete"),description:i("transaction.completeDescription")}]),Ne=y(()=>{const e=[];return W.value==="wrap"&&R.value?e.push({label:i("pay"),value:`-${_(R.value,2)} sRMB`,highlight:!0,type:"debit"},{label:i("receive"),value:`+${_(B.value?.outputAmount||"0",6)} sWRMB`,type:"credit"}):W.value==="unwrap"&&h.value&&e.push({label:i("pay"),value:`-${_(g.value?.sWRMBBurned||"0",6)} sWRMB`,highlight:!0,type:"debit"},{label:i("receive"),value:`+${_(g.value?.sRMBReceived||"0",2)} sRMB`,type:"credit"}),e}),ze=y(()=>new Xe(F.value).plus(z.value).toString()),pe=y(()=>{const e=parseFloat(R.value);if(!e||e<=0||e>parseFloat(F.value))return!1;if(b.value){const t=parseFloat(b.value.minWrapAmount),n=parseFloat(b.value.maxWrapAmount);if(t>0&&e<t||n>0&&e>n)return!1}return!0}),ve=y(()=>{if(!R.value)return"";const e=parseFloat(R.value);if(!e||e<=0)return i("wrap.invalidAmount");if(e>parseFloat(F.value))return i("wrap.insufficientBalance");if(b.value){const t=parseFloat(b.value.minWrapAmount),n=parseFloat(b.value.maxWrapAmount);if(t>0&&e<t)return i("wrap.belowMinAmount",{min:_(t)});if(n>0&&e>n)return i("wrap.aboveMaxAmount",{max:_(n)})}return""}),we=y(()=>{const e=parseFloat(h.value);if(!e||e<=0)return!1;const t=parseFloat(T.value);if(e>t)return!1;if(b.value){const n=parseFloat(b.value.minUnwrapAmount),l=parseFloat(b.value.maxUnwrapAmount);if(n>0&&e<n||l>0&&e>l)return!1}return!0}),oe=y(()=>{if(!h.value)return"";const e=parseFloat(h.value);if(!e||e<=0)return"";const t=parseFloat(z.value);if(e>t)return i("wrap.insufficientUnwrappableAmount");if(b.value){const n=parseFloat(b.value.minUnwrapAmount),l=parseFloat(b.value.maxUnwrapAmount);if(n>0&&e<n)return i("wrap.belowMinUnwrapAmount",{min:_(n)});if(l>0&&e>l)return i("wrap.aboveMaxUnwrapAmount",{max:_(l)})}return""}),re=y(()=>{if(!h.value)return"";const e=parseFloat(g.value?.sWRMBBurned||"0");if(!e||e<=0||parseFloat(z.value)<=0)return"";const t=parseFloat(V.value);return e>t&&parseFloat(h.value)<=parseFloat(z.value)?"sWRMB "+i("wrap.insufficientBalance"):""}),De=async e=>{try{const t=parseFloat(e);if(!t||t<=0)return null;const n=M.getWrapManagerContract();if(!n)return null;const l=G(e,18),[v,u,U,x,ie]=await n.previewWrap(d.address,l),k=w(v,18),q=w(U,18),Y=parseFloat(q)/t*100,ue=parseFloat(k)/t,O=Number(x);return E.value=O,{outputAmount:k,fee:q,feePercentage:Y.toFixed(2),exchangeRate:ue.toFixed(6),minimumReceived:(parseFloat(k)*.995).toFixed(6),waitTime:O}}catch(t){return console.error("Failed to generate wrap preview:",t),null}},Ie=async e=>{try{const t=parseFloat(e);if(!t||t<=0)return null;const n=M.getWrapManagerContract();if(!n)return null;const l=G(e,18),[v,u,U,x,ie]=await n.previewUnwrap(d.address,l);console.log(x);const k=w(u,18),q=w(v,18),Y=w(U,18),ue=parseFloat(Y)/t*100,O=Number(x);N.value=O;const Le=parseFloat(k)>0?t/parseFloat(k):0;return{sWRMBBurned:k,sRMBReceived:q,fee:Y,feePercentage:ue.toFixed(2),exchangeRate:Le.toFixed(6),waitTime:O}}catch(t){return console.error("Failed to generate unwrap preview:",t),null}},fe=e=>{if(e<=0)return"";const t=new Date;return new Date(t.getTime()+e*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})},me=y(()=>E.value===0),_e=y(()=>N.value===0),qe=Te(async e=>{B.value=await De(e)},500),Oe=Te(async e=>{g.value=await Ie(e)},500),he=e=>{qe(e)},ge=e=>{Oe(e)},be=e=>{W.value=e,R.value="",h.value="",B.value=null,g.value=null,E.value=0,N.value=0},Me=()=>{W.value=W.value==="wrap"?"unwrap":"wrap",be(W.value)},Re=e=>{const t=ke(F.value,e);R.value=t,he(t)},Be=e=>{const t=ke(T.value,e);h.value=t,ge(t)},We=async()=>{if(!(!pe.value||!d.isConnected)){ne.value=i("wrap.wrapTransaction"),I.value=!0,$.value=0,A.value="pending",ae.value=!0;try{const e=G(R.value,18),t=M.getSRMBContract(!0),n=M.getAddresses().WRAP_MANAGER;if(!t||!n)throw new Error("Contract not available");await t.allowance(d.address,n)<e&&(A.value="loading",await(await t.approve(n,e)).wait()),$.value=1;const v=M.getWrapManagerContract(!0);if(!v)throw new Error("Wrap manager contract not available");A.value="loading";const u=await v.wrap(e);$.value=2;const U=await u.wait();L.value=U.hash,$.value=3,A.value="success",R.value="",B.value=null,await Promise.all([J(),H()]),ce.success(i("wrap.wrapSuccess"))}catch(e){A.value="error",j.value=e.message||i("wrap.wrapFailed"),console.error("Wrap failed:",e)}finally{ae.value=!1}}},Ae=async()=>{if(!we.value||!d.isConnected)return;const e=parseFloat(h.value),t=parseFloat(T.value);if(e>t){ce.error(i("wrap.insufficientUnwrappableAmount"));return}ne.value=i("wrap.unwrapTransaction"),I.value=!0,$.value=0,A.value="pending",te.value=!0;try{const n=G(h.value,18);if(!g.value)throw new Error("Unable to calculate required sWRMB amount");const l=G(g.value.sWRMBBurned,18),v=M.getSavingsVaultContract(!0),u=M.getAddresses().WRAP_MANAGER;if(!v||!u)throw new Error("Contract not available");await v.allowance(d.address,u)<l&&(A.value="loading",await(await v.approve(u,l)).wait()),$.value=1;const x=M.getWrapManagerContract(!0);if(!x)throw new Error("Wrap manager contract not available");A.value="loading";const ie=await x.unwrap(n);$.value=2;const k=await ie.wait();L.value=k.hash,$.value=3,A.value="success",h.value="",g.value=null,await Promise.all([J(),H(),le()]),ce.success(i("wrap.unwrapSuccess"))}catch(n){A.value="error",j.value=n.message||i("wrap.unwrapFailed"),console.error("Unwrap failed:",n)}finally{te.value=!1}},Ge=()=>{I.value=!1,L.value="",j.value=""},Ke=()=>{W.value==="wrap"?We():Ae()},H=async()=>{if(!d.isConnected||!d.address){T.value="0",K.value=null;return}try{const e=M.getWrapManagerContract();if(!e)return;const[t,n,l]=await e.getUserWrapStats(d.address);z.value=w(n,18),T.value=w(l,18),K.value={totalWrapped:w(t,18),availableToUnwrap:w(n,18)}}catch(e){console.error("Failed to load user wrap stats:",e),T.value="0",K.value=null}},J=async()=>{if(!d.isConnected||!d.address){F.value="0",V.value="0";return}try{const[e,t]=await Promise.all([M.getSRMBContract(),M.getSavingsVaultContract()]);if(e&&t){const[n,l]=await Promise.all([e.balanceOf(d.address),t.balanceOf(d.address)]);F.value=w(n,18),V.value=w(l,18)}}catch(e){console.error("Failed to load balances:",e),F.value="0",V.value="0"}},ye=async()=>{try{const e=M.getWrapManagerContract();if(!e)return;const t=await e.getConfiguration();b.value={minWrapAmount:w(t[3],18),maxWrapAmount:w(t[4],18),wrapFee:w(t[5],18),minUnwrapAmount:w(t[6],18),maxUnwrapAmount:w(t[7],18),unwrapFee:w(t[8],18)}}catch(e){console.error("Failed to load wrap config:",e)}},le=async()=>{try{const e=M.getWrapManagerContract();if(!e)return;const t=await e.totalReserveTransferred();se.value=w(t,18)}catch(e){console.error("Failed to load total reserve transferred:",e),se.value="0"}},X=async()=>{de.value=!0;try{await Promise.all([J(),ye(),H(),le()])}catch(e){console.error("Failed to refresh data:",e)}finally{de.value=!1}};return Z(()=>d.isConnected,e=>{e?X():(F.value="0",V.value="0",b.value=null,T.value="0",K.value=null,se.value="0",B.value=null,g.value=null)}),Z(()=>d.address,()=>{d.isConnected&&X()}),Z(()=>d.chainId,e=>{e&&X()}),Z(W,()=>{R.value="",h.value="",B.value=null,g.value=null,E.value=0,N.value=0}),Ye(()=>{d.isConnected&&X()}),(e,t)=>{const n=Qe,l=ea,v=aa;return f(),Ze(la,{"is-pulling":r(Pe),"is-refreshing":r(Ue),"pull-distance":r(xe),"can-refresh":r(Ve)},{default:p(()=>[a("div",ia,[a("div",ua,[a("div",ca,[a("h2",da,s(e.$t("wrap.title")),1)]),a("div",pa,[a("div",va,[a("div",wa,[o(n,{modelValue:W.value,"onUpdate:modelValue":t[0]||(t[0]=u=>W.value=u),options:Se.value,size:"large",onChange:be},null,8,["modelValue","options"])]),W.value==="wrap"?(f(),m("div",fa,[a("div",ma,[a("div",_a,[a("div",ha,[a("span",ga,s(e.$t("wrap.from")),1),a("span",ba,s(e.$t("wrap.balance"))+": "+s(r(D)(ze.value))+" sRMB ",1)]),a("div",Ma,[a("div",Ra,[o(ee,{modelValue:R.value,"onUpdate:modelValue":t[1]||(t[1]=u=>R.value=u),placeholder:r(D)(F.value)+"  "+e.$t("available"),size:"large",class:"amount-input",decimals:6,"use-abbreviation":!0,"max-decimals":6,onInputChange:he},{suffix:p(()=>t[6]||(t[6]=[a("span",{class:"input-suffix"},"sRMB",-1)])),_:1},8,["modelValue","placeholder"])]),ve.value?(f(),m("div",Ba,[o(l,{class:"error-icon"},{default:p(()=>[o(r(Q))]),_:1}),a("span",Wa,s(ve.value),1)])):S("",!0),a("div",Aa,[(f(),m(P,null,Ce([25,50,75],u=>o(v,{key:u,size:"small",onClick:U=>Re(u)},{default:p(()=>[C(s(u)+"% ",1)]),_:2},1032,["onClick"])),64)),o(v,{class:"max-button",size:"small",onClick:t[2]||(t[2]=u=>Re(100))},{default:p(()=>t[7]||(t[7]=[C(" Max ")])),_:1,__:[7]})])])]),a("div",ya,[o(v,{circle:"",onClick:Me,class:"swap-button"},{default:p(()=>[o(l,{class:"swap-icon"},{default:p(()=>[o(r(Fe))]),_:1})]),_:1})]),a("div",Ca,[a("div",Fa,[a("span",$a,s(e.$t("wrap.to")),1),a("span",ka,s(e.$t("wrap.balance"))+": "+s(r(D)(V.value))+" sWRMB ",1)]),a("div",Ta,[o(ee,{"model-value":B.value?.outputAmount||"0",placeholder:e.$t("wrap.estimatedAmount"),size:"large",class:"amount-input",readonly:"",decimals:6,"use-abbreviation":!0,"max-decimals":18},{suffix:p(()=>t[8]||(t[8]=[a("span",{class:"input-suffix"},"sWRMB",-1)])),_:1},8,["model-value","placeholder"])])])]),B.value?(f(),m("div",Ua,[a("h4",xa,s(e.$t("wrap.preview")),1),a("div",Pa,[a("div",Va,[a("span",null,s(e.$t("wrap.fee"))+" ("+s(r(_)(B.value.feePercentage))+"%)",1),a("span",Sa,s(r(_)(B.value.fee))+" sRMB",1)]),a("div",Ea,[a("span",null,s(e.$t("wrap.minimumReceived")),1),a("span",Na,s(r(_)(B.value.minimumReceived))+" sWRMB",1)]),a("div",za,[a("span",null,s(e.$t("wrap.rate")),1),a("span",Da,"1 sRMB ≈ "+s(r(_)(B.value.exchangeRate,6))+" sWRMB",1)])])])):S("",!0),E.value>0?(f(),m("div",Ia,[o(l,{class:"countdown-icon"},{default:p(()=>[o(r($e))]),_:1}),a("span",qa,s(e.$t("wrap.availableAt"))+": "+s(fe(E.value)),1)])):S("",!0),o(v,{type:"primary",size:"large",loading:ae.value,disabled:!pe.value||!r(d).isConnected||!me.value,onClick:We,class:"action-button"},{default:p(()=>[r(d).isConnected?me.value?(f(),m(P,{key:2},[C(s(e.$t("wrap.wrapTokens")),1)],64)):(f(),m(P,{key:1},[C(s(e.$t("wrap.waitingForCooldown")),1)],64)):(f(),m(P,{key:0},[C(s(e.$t("wallet.connectWallet")),1)],64))]),_:1},8,["loading","disabled"])])):(f(),m("div",Oa,[a("div",Ga,[a("div",Ka,[a("div",La,[a("span",ja,s(e.$t("wrap.desiredAmount")),1),a("span",Ha,s(e.$t("wrap.balance"))+": "+s(r(D)(z.value))+" sRMB ",1)]),a("div",Ja,[a("div",Xa,[o(ee,{modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=u=>h.value=u),placeholder:r(D)(T.value)+"  "+e.$t("available"),size:"large",class:"amount-input",decimals:6,"use-abbreviation":!0,"max-decimals":6,onInputChange:ge},{suffix:p(()=>t[9]||(t[9]=[a("span",{class:"input-suffix"},"sRMB",-1)])),_:1},8,["modelValue","placeholder"])]),oe.value?(f(),m("div",Ya,[o(l,{class:"error-icon"},{default:p(()=>[o(r(Q))]),_:1}),a("span",Za,s(oe.value),1)])):S("",!0),a("div",Qa,[(f(),m(P,null,Ce([25,50,75],u=>o(v,{key:u,size:"small",onClick:U=>Be(u)},{default:p(()=>[C(s(u)+"% ",1)]),_:2},1032,["onClick"])),64)),o(v,{class:"max-button",size:"small",onClick:t[4]||(t[4]=u=>Be(100))},{default:p(()=>t[10]||(t[10]=[C(" Max ")])),_:1,__:[10]})])])]),a("div",et,[o(v,{circle:"",onClick:Me,class:"swap-button"},{default:p(()=>[o(l,{class:"swap-icon"},{default:p(()=>[o(r(Fe))]),_:1})]),_:1})]),a("div",at,[a("div",tt,[a("span",st,s(e.$t("wrap.requiredBurn")),1),a("span",nt,s(e.$t("wrap.balance"))+": "+s(r(D)(V.value))+" sWRMB ",1)]),a("div",ot,[o(ee,{"model-value":g.value?.sWRMBBurned||"0",placeholder:e.$t("wrap.estimatedBurn"),size:"large",class:"amount-input",readonly:"",decimals:6,"use-abbreviation":!0,"max-decimals":18},{suffix:p(()=>t[11]||(t[11]=[a("span",{class:"input-suffix"},"sWRMB",-1)])),_:1},8,["model-value","placeholder"])])]),re.value?(f(),m("div",rt,[o(l,{class:"error-icon"},{default:p(()=>[o(r(Q))]),_:1}),a("span",lt,s(re.value),1)])):S("",!0)]),g.value&&!oe.value&&!re.value?(f(),m("div",it,[a("h4",ut,s(e.$t("wrap.preview")),1),a("div",ct,[a("div",dt,[a("span",null,s(e.$t("savings.youWillReceive")),1),a("span",pt,s(r(_)(h.value))+" sRMB",1)]),a("div",vt,[a("span",null,s(e.$t("wrap.fee"))+" ("+s(r(_)(g.value.feePercentage))+"%)",1),a("span",wt,s(r(_)(g.value.fee))+" sRMB",1)]),a("div",ft,[a("span",null,s(e.$t("wrap.rate")),1),a("span",mt,"1 sWRMB ≈ "+s(r(_)(g.value.exchangeRate,6))+" sRMB",1)])])])):S("",!0),N.value>0?(f(),m("div",_t,[o(l,{class:"countdown-icon"},{default:p(()=>[o(r($e))]),_:1}),a("span",ht,s(e.$t("wrap.availableAt"))+": "+s(fe(N.value)),1)])):S("",!0),o(v,{type:"primary",size:"large",loading:te.value,disabled:!we.value||!r(d).isConnected||!_e.value,onClick:Ae,class:"action-button"},{default:p(()=>[r(d).isConnected?_e.value?(f(),m(P,{key:2},[C(s(e.$t("wrap.unwrapTokens")),1)],64)):(f(),m(P,{key:1},[C(s(e.$t("wrap.waitingForCooldown")),1)],64)):(f(),m(P,{key:0},[C(s(e.$t("wallet.connectWallet")),1)],64))]),_:1},8,["loading","disabled"])]))])]),a("div",gt,[a("div",bt,[a("div",Mt,[a("div",Rt,[o(l,{class:"info-icon"},{default:p(()=>[o(r(ta))]),_:1}),a("h3",Bt,s(e.$t("wrap.whatIsWrapping")),1)]),a("p",Wt,s(e.$t("wrap.wrappingDescription")),1)]),a("div",At,[a("div",yt,[o(l,{class:"info-icon"},{default:p(()=>[o(r(sa))]),_:1}),a("h3",Ct,s(e.$t("wrap.fees")),1)]),a("p",Ft,s(e.$t("wrap.feesDescription")),1)]),a("div",$t,[a("div",kt,[o(l,{class:"info-icon"},{default:p(()=>[o(r(Q))]),_:1}),a("h3",Tt,s(e.$t("wrap.risks")),1)]),a("p",Ut,s(e.$t("wrap.risksDescription")),1)])])])])]),o(na,{visible:I.value,"onUpdate:visible":t[5]||(t[5]=u=>I.value=u),title:ne.value,steps:Ee.value,"current-step":$.value,status:A.value,"transaction-details":Ne.value,"transaction-hash":L.value,"error-message":j.value,onClose:Ge,onRetry:Ke},null,8,["visible","title","steps","current-step","status","transaction-details","transaction-hash","error-message"])]),_:1},8,["is-pulling","is-refreshing","pull-distance","can-refresh"])}}}),qt=oa(xt,[["__scopeId","data-v-6bff71ba"]]);export{qt as default};
//# sourceMappingURL=Wrap-77J6zBMA.js.map
