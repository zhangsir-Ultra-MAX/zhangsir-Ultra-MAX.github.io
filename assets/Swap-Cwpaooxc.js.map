{"version":3,"file":"Swap-Cwpaooxc.js","sources":["../../node_modules/ethers/lib.esm/constants/numbers.js","../../src/services/uniswapV4.ts","../../src/views/Swap.vue"],"sourcesContent":["/**\n *  A constant for the order N for the secp256k1 curve.\n *\n *  (**i.e.** ``0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141n``)\n */\nexport const N = BigInt(\"0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141\");\n/**\n *  A constant for the number of wei in a single ether.\n *\n *  (**i.e.** ``1000000000000000000n``)\n */\nexport const WeiPerEther = BigInt(\"1000000000000000000\");\n/**\n *  A constant for the maximum value for a ``uint256``.\n *\n *  (**i.e.** ``0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffn``)\n */\nexport const MaxUint256 = BigInt(\"0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\");\n/**\n *  A constant for the minimum value for an ``int256``.\n *\n *  (**i.e.** ``-8000000000000000000000000000000000000000000000000000000000000000n``)\n */\nexport const MinInt256 = BigInt(\"0x8000000000000000000000000000000000000000000000000000000000000000\") * BigInt(-1);\n/**\n *  A constant for the maximum value for an ``int256``.\n *\n *  (**i.e.** ``0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffn``)\n */\nexport const MaxInt256 = BigInt(\"0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\");\n//# sourceMappingURL=numbers.js.map","import { ethers, Contract, parseUnits, formatUnits } from 'ethers'\r\nimport { useWalletStore } from '@/stores/wallet'\r\nimport { NETWORKS } from '@/constants'\r\nimport { ElMessage } from 'element-plus'\r\n\r\nconst UNISWAP_V4_ADDRESSES = {\r\n  [1]: {\r\n    POOL_MANAGER: '0x0000000000000000000000000000000000000000',\r\n    UNIVERSAL_ROUTER: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\r\n    QUOTER: '0x0000000000000000000000000000000000000000',\r\n    STATE_VIEW: '0x0000000000000000000000000000000000000000',\r\n    PERMIT2: '0x000000000022D473030F116dDEE9F6B43aC78BA3'\r\n  },\r\n  [11155111]: {\r\n    POOL_MANAGER: '0x8C4BcBE6b9eF47855f97E675296FA3F6fafa5F1A',\r\n    UNIVERSAL_ROUTER: '0x3A9D48AB9751398BbFa63ad67599Bb04e4BdF98b',\r\n    QUOTER: '0x61b3f2011a92d183c7dbadbda940a7555ccf9227',\r\n    STATE_VIEW: '0xe1dd9c3fa50edb962e442f60dfbc432e24537e4c',\r\n    POSITION_MANAGER: '0x429ba70129df741B2Ca2a85BC3A2a3328e5c09b4',\r\n    PERMIT2: '0x000000000022D473030F116dDEE9F6B43aC78BA3'\r\n  },\r\n  [NETWORKS.LOCAL.chainId]: {\r\n    POOL_MANAGER: '0x8C4BcBE6b9eF47855f97E675296FA3F6fafa5F1A',\r\n    UNIVERSAL_ROUTER: '0x94cC0AaC535CCDB3C01d6787D6413C739ae12bc4',\r\n    QUOTER: '0xC195976fEF0985886E37036E2DF62bF371E12Df0',\r\n    STATE_VIEW: '0x1234567890123456789012345678901234567890',\r\n    PERMIT2: '0x000000000022D473030F116dDEE9F6B43aC78BA3'\r\n  }\r\n}\r\n\r\nconst POOL_MANAGER_ABI = [\r\n  'function swap(bytes32 poolId, (bool zeroForOne, int256 amountSpecified, uint160 sqrtPriceLimitX96), bytes calldata hookData) external returns (int256 amount0, int256 amount1)',\r\n  'function modifyLiquidity(bytes32 poolId, (int24 tickLower, int24 tickUpper, int256 liquidityDelta), bytes calldata hookData) external returns (int256 amount0, int256 amount1)',\r\n  'function initialize(bytes32 poolId, uint160 sqrtPriceX96, bytes calldata hookData) external returns (int24 tick)',\r\n  'function donate(bytes32 poolId, uint256 amount0, uint256 amount1, bytes calldata hookData) external returns (int256 amount0Delta, int256 amount1Delta)',\r\n  'function take(address currency, address to, uint256 amount) external',\r\n  'function settle(address currency) external payable returns (uint256 paid)'\r\n]\r\n\r\nconst STATE_VIEW_ABI = [\r\n  'function getSlot0(bytes32 poolId) external view returns (uint160 sqrtPriceX96, int24 tick, uint16 protocolFee, uint16 lpFee)',\r\n  'function getLiquidity(bytes32 poolId) external view returns (uint128)',\r\n  'function getTickInfo(bytes32 poolId, int24 tick) external view returns (uint128 liquidityGross, int128 liquidityNet, uint256 feeGrowthOutside0X128, uint256 feeGrowthOutside1X128)',\r\n  'function getTickBitmap(bytes32 poolId, int16 wordPosition) external view returns (uint256)',\r\n  'function getPosition(bytes32 poolId, address owner, int24 tickLower, int24 tickUpper) external view returns (uint128 liquidity, uint256 feeGrowthInside0LastX128, uint256 feeGrowthInside1LastX128, uint128 tokensOwed0, uint128 tokensOwed1)',\r\n  'function getFeeGrowthGlobal0X128(bytes32 poolId) external view returns (uint256)',\r\n  'function getFeeGrowthGlobal1X128(bytes32 poolId) external view returns (uint256)',\r\n  'function getProtocolFees(bytes32 poolId) external view returns (uint256 token0, uint256 token1)'\r\n]\r\n\r\nconst UNIVERSAL_ROUTER_ABI = [\r\n  {\r\n    inputs: [\r\n      { internalType: \"bytes\", name: \"commands\", type: \"bytes\" },\r\n      { internalType: \"bytes[]\", name: \"inputs\", type: \"bytes[]\" },\r\n      { internalType: \"uint256\", name: \"deadline\", type: \"uint256\" },\r\n    ],\r\n    name: \"execute\",\r\n    outputs: [],\r\n    stateMutability: \"payable\",\r\n    type: \"function\",\r\n  },\r\n]\r\n\r\nconst QUOTER_ABI = [\r\n  'function quoteExactInputSingle(((address currency0, address currency1, uint24 fee, int24 tickSpacing, address hooks) poolKey, bool zeroForOne, uint128 exactAmount, bytes hookData)) external returns (uint256 amountOut, uint256 gasEstimate)',\r\n  'function quoteExactOutputSingle(((address currency0, address currency1, uint24 fee, int24 tickSpacing, address hooks) poolKey, bool zeroForOne, uint128 exactAmount, bytes hookData)) external returns (uint256 amountIn, uint256 gasEstimate)'\r\n]\r\n\r\nconst ERC20_ABI = [\r\n  'function balanceOf(address) view returns (uint256)',\r\n  'function allowance(address, address) view returns (uint256)',\r\n  'function approve(address, uint256) returns (bool)',\r\n  'function transfer(address, uint256) returns (bool)',\r\n  'function decimals() view returns (uint8)',\r\n  'function symbol() view returns (string)',\r\n  'function name() view returns (string)'\r\n]\r\n\r\ninterface SwapParams {\r\n  tokenIn: string\r\n  tokenOut: string\r\n  amountIn?: string\r\n  amountOut?: string\r\n  swapType: 'exactInput' | 'exactOutput'\r\n  slippage: number\r\n  recipient?: string\r\n}\r\n\r\ninterface QuoteResult {\r\n  amountOut: string\r\n  amountIn?: string\r\n  priceImpact: string\r\n  fee: string\r\n  route: string[]\r\n}\r\n\r\ninterface PoolInfo {\r\n  poolId: string\r\n  token0: string\r\n  token1: string\r\n  fee: number\r\n  sqrtPriceX96: string\r\n  tick: number\r\n  liquidity: string\r\n}\r\n\r\nclass UniswapV4Service {\r\n  private poolManagerContract: Contract | null = null\r\n  public swapRouterContract: Contract | null = null\r\n  private quoterContract: Contract | null = null\r\n  private stateViewContract: Contract | null = null\r\n  public provider: ethers.Provider | null = null\r\n  public signer: ethers.Signer | null = null\r\n\r\n  constructor() {\r\n    this.initializeContracts()\r\n  }\r\n\r\n  private async initializeContracts() {\r\n    const walletStore = useWalletStore()\r\n\r\n    if (!walletStore.provider || !walletStore.chainId) {\r\n      return\r\n    }\r\n\r\n    this.provider = walletStore.provider\r\n    this.signer = walletStore.signer\r\n\r\n    const addresses = UNISWAP_V4_ADDRESSES[walletStore.chainId as keyof typeof UNISWAP_V4_ADDRESSES]\r\n\r\n    if (!addresses) {\r\n      const networkNames: { [key: number]: string } = {\r\n        1: '以太坊主网',\r\n        5: 'Goerli 测试网',\r\n        11155111: 'Sepolia 测试网',\r\n        31337: '本地测试网'\r\n      }\r\n      const currentNetworkName = networkNames[walletStore.chainId] || `网络 ${walletStore.chainId}`\r\n\r\n      ElMessage.warning({\r\n        message: `Uniswap V4 暂不支持 ${currentNetworkName}。目前仅支持以太坊主网和本地测试网络。`,\r\n        duration: 5000\r\n      })\r\n      return\r\n    }\r\n\r\n    try {\r\n      this.poolManagerContract = new Contract(addresses.POOL_MANAGER, POOL_MANAGER_ABI, this.provider)\r\n      this.swapRouterContract = new Contract(addresses.UNIVERSAL_ROUTER, UNIVERSAL_ROUTER_ABI, this.signer)\r\n      this.quoterContract = new Contract(addresses.QUOTER, QUOTER_ABI, this.provider)\r\n      this.stateViewContract = new Contract(addresses.STATE_VIEW, STATE_VIEW_ABI, this.provider)\r\n    } catch (error) {\r\n      this.poolManagerContract = null\r\n      this.swapRouterContract = null\r\n      this.quoterContract = null\r\n      this.stateViewContract = null\r\n    }\r\n  }\r\n\r\n  async reinitialize() {\r\n    await this.initializeContracts()\r\n  }\r\n\r\n  public getTokenContract(address: string, withSigner = false): Contract {\r\n    const providerOrSigner = withSigner ? this.signer : this.provider\r\n    return new Contract(address, ERC20_ABI, providerOrSigner)\r\n  }\r\n\r\n  private generatePoolId(token0: string, token1: string, fee: number, tickSpacing: number = 10): string {\r\n    const [currency0, currency1] = token0.toLowerCase() < token1.toLowerCase() ? [token0, token1] : [token1, token0]\r\n    let hooks = '0x0000000000000000000000000000000000000000'\r\n    if (currency0 == '0x45Dd667b7C97F7c7B9135dA7f8674dF7d6662737' || currency1 == '0x45Dd667b7C97F7c7B9135dA7f8674dF7d6662737') {\r\n      hooks = '0x7d08875f51879bedD9a01d71a804f012e1304fC0';\r\n    }\r\n\r\n    const poolKey = ethers.keccak256(\r\n      ethers.AbiCoder.defaultAbiCoder().encode(\r\n        ['address', 'address', 'uint24', 'int24', 'address'],\r\n        [currency0, currency1, fee, tickSpacing, hooks]\r\n      )\r\n    )\r\n    return poolKey\r\n  }\r\n\r\n  async getPoolInfo(token0: string, token1: string, fee: number = 500, tickSpacing: number = 10): Promise<PoolInfo | null> {\r\n    if (!this.stateViewContract) {\r\n      await this.initializeContracts()\r\n    }\r\n\r\n    if (!this.stateViewContract) {\r\n      throw new Error('StateView contract not initialized')\r\n    }\r\n\r\n    try {\r\n      const poolId = this.generatePoolId(token0, token1, fee, tickSpacing)\r\n      const liquidity = await this.stateViewContract.getLiquidity(poolId)\r\n\r\n      if (liquidity.toString() === '0') {\r\n        return null\r\n      }\r\n\r\n      const slot0 = await this.stateViewContract.getSlot0(poolId)\r\n\r\n      return {\r\n        poolId,\r\n        token0: token0.toLowerCase() < token1.toLowerCase() ? token0 : token1,\r\n        token1: token0.toLowerCase() < token1.toLowerCase() ? token1 : token0,\r\n        fee,\r\n        sqrtPriceX96: slot0.sqrtPriceX96.toString(),\r\n        tick: slot0.tick,\r\n        liquidity: liquidity.toString()\r\n      }\r\n    } catch (error) {\r\n      if ((error as any).code === 'CALL_EXCEPTION') {\r\n        return null\r\n      }\r\n      return null\r\n    }\r\n  }\r\n\r\n  private async calculatePriceImpact(\r\n    tokenIn: string,\r\n    tokenOut: string,\r\n    amountIn: string,\r\n    amountOut: string,\r\n    poolId: string\r\n  ): Promise<number> {\r\n    try {\r\n      if (!this.stateViewContract) {\r\n        return 0.1\r\n      }\r\n\r\n      const slot0 = await this.stateViewContract.getSlot0(poolId)\r\n      const currentSqrtPriceX96 = slot0.sqrtPriceX96\r\n\r\n      const amountInNum = parseFloat(amountIn)\r\n      const amountOutNum = parseFloat(amountOut)\r\n\r\n      if (amountInNum === 0 || amountOutNum === 0) {\r\n        return 0\r\n      }\r\n\r\n      const tradeSize = amountInNum\r\n      if (tradeSize < 1000) {\r\n        return 0.01\r\n      } else if (tradeSize < 10000) {\r\n        return 0.05\r\n      } else if (tradeSize < 100000) {\r\n        return 0.1\r\n      } else {\r\n        return 0.5\r\n      }\r\n    } catch (error) {\r\n      return 0.1\r\n    }\r\n  }\r\n\r\n  async getQuote(params: SwapParams): Promise<QuoteResult | null> {\r\n    const walletStore = useWalletStore()\r\n\r\n    if (!this.isNetworkSupported(walletStore.chainId)) {\r\n      ElMessage.error('当前网络不支持 Uniswap V4，请切换到以太坊主网或本地测试网络')\r\n      return null\r\n    }\r\n\r\n    if (!this.quoterContract) {\r\n      await this.initializeContracts()\r\n    }\r\n\r\n    if (!this.quoterContract) {\r\n      throw new Error('Quoter contract not initialized')\r\n    }\r\n\r\n    try {\r\n      const tokenInContract = this.getTokenContract(params.tokenIn)\r\n      const tokenOutContract = this.getTokenContract(params.tokenOut)\r\n\r\n      const [tokenInDecimals, tokenOutDecimals] = await Promise.all([\r\n        tokenInContract.decimals(),\r\n        tokenOutContract.decimals()\r\n      ])\r\n\r\n      const poolId = this.generatePoolId(params.tokenIn, params.tokenOut, 500)\r\n      const token0 = params.tokenIn.toLowerCase() < params.tokenOut.toLowerCase() ? params.tokenIn : params.tokenOut\r\n      const token1 = params.tokenIn.toLowerCase() < params.tokenOut.toLowerCase() ? params.tokenOut : params.tokenIn\r\n      const zeroForOne = params.tokenIn.toLowerCase() === token0.toLowerCase()\r\n\r\n      const quoteParams = {\r\n        poolKey: {\r\n          currency0: token0,\r\n          currency1: token1,\r\n          fee: 500,\r\n          tickSpacing: 10,\r\n          hooks: '0x0000000000000000000000000000000000000000'\r\n        },\r\n        zeroForOne: zeroForOne,\r\n        exactAmount: BigInt(0), // 将在下面设置\r\n        hookData: '0x'\r\n      }\r\n\r\n      if (token0 == '0x45Dd667b7C97F7c7B9135dA7f8674dF7d6662737' || token1 == '0x45Dd667b7C97F7c7B9135dA7f8674dF7d6662737') {\r\n        quoteParams.poolKey.hooks = '0x7d08875f51879bedD9a01d71a804f012e1304fC0'\r\n      }\r\n\r\n      let result: any\r\n      let amountOut: string\r\n      let amountIn: string\r\n      let inputAmount: string\r\n      let outputAmount: string\r\n\r\n      if (params.swapType === 'exactInput') {\r\n        if (!params.amountIn) throw new Error('amountIn is required for exactInput')\r\n        const exactAmountIn = parseUnits(params.amountIn, tokenInDecimals)\r\n        quoteParams.exactAmount = exactAmountIn\r\n        result = await this.quoterContract.quoteExactInputSingle.staticCall(quoteParams)\r\n        amountOut = formatUnits(result.amountOut, tokenOutDecimals)\r\n        amountIn = params.amountIn\r\n        inputAmount = params.amountIn\r\n        outputAmount = amountOut\r\n      } else {\r\n        if (!params.amountOut) throw new Error('amountOut is required for exactOutput')\r\n        const exactAmountOut = parseUnits(params.amountOut, tokenOutDecimals)\r\n        quoteParams.exactAmount = exactAmountOut\r\n        result = await this.quoterContract.quoteExactOutputSingle.staticCall(quoteParams)\r\n        amountIn = formatUnits(result.amountIn, tokenInDecimals)\r\n        amountOut = params.amountOut\r\n        inputAmount = amountIn\r\n        outputAmount = params.amountOut\r\n      }\r\n\r\n      const priceImpact = await this.calculatePriceImpact(\r\n        params.tokenIn,\r\n        params.tokenOut,\r\n        inputAmount,\r\n        outputAmount,\r\n        poolId\r\n      )\r\n\r\n      const fee = '0.05'\r\n\r\n      return {\r\n        amountOut,\r\n        amountIn,\r\n        priceImpact: priceImpact.toString(),\r\n        fee,\r\n        route: [params.tokenIn, params.tokenOut]\r\n      }\r\n    } catch (error) {\r\n      return null\r\n    }\r\n  }\r\n\r\n  async checkAllowance(tokenAddress: string, spenderAddress: string, userAddress: string): Promise<string> {\r\n    const tokenContract = this.getTokenContract(tokenAddress)\r\n    try {\r\n      const allowance = await tokenContract.allowance(userAddress, spenderAddress)\r\n      return allowance.toString()\r\n    } catch (error) {\r\n      return '0'\r\n    }\r\n  }\r\n\r\n  async approveToken(tokenAddress: string, spenderAddress: string, amount: string): Promise<boolean> {\r\n    const tokenContract = this.getTokenContract(tokenAddress, true)\r\n\r\n    try {\r\n      const amountToApprove = ethers.MaxUint256\r\n      const tx = await tokenContract.approve(spenderAddress, amountToApprove)\r\n\r\n      ElMessage.info('授权交易已提交，等待确认...')\r\n      await tx.wait()\r\n\r\n      ElMessage.success('代币授权成功')\r\n      return true\r\n    } catch (error) {\r\n      ElMessage.error('代币授权失败')\r\n      return false\r\n    }\r\n  }\r\n\r\n  async getTokenBalance(tokenAddress: string, userAddress: string): Promise<string> {\r\n    const tokenContract = this.getTokenContract(tokenAddress)\r\n\r\n    try {\r\n      const [balance, decimals] = await Promise.all([\r\n        tokenContract.balanceOf(userAddress),\r\n        tokenContract.decimals()\r\n      ])\r\n\r\n      return formatUnits(balance, decimals)\r\n    } catch (error) {\r\n      return '0'\r\n    }\r\n  }\r\n\r\n  getSupportedNetworks(): number[] {\r\n    return Object.keys(UNISWAP_V4_ADDRESSES).map(Number)\r\n  }\r\n\r\n  isNetworkSupported(chainId: number): boolean {\r\n    return chainId in UNISWAP_V4_ADDRESSES\r\n  }\r\n\r\n  getContractAddresses(chainId: number) {\r\n    return UNISWAP_V4_ADDRESSES[chainId as keyof typeof UNISWAP_V4_ADDRESSES] || null\r\n  }\r\n}\r\n\r\n// 导出单例实例\r\nexport const uniswapV4Service = new UniswapV4Service()\r\nexport type { SwapParams, QuoteResult, PoolInfo }","<template>\r\n    <PullToRefresh :is-pulling=\"isPulling\" :is-refreshing=\"isRefreshing\" :pull-distance=\"pullDistance\"\r\n        :can-refresh=\"canRefresh\">\r\n        <div class=\"swap\">\r\n            <div class=\"swap-content\">\r\n                <!-- Swap Overview -->\r\n                <div class=\"swap-overview\">\r\n                    <h2 class=\"section-title\">\r\n                        {{ $t('swap.title') }}\r\n                    </h2>\r\n                </div>\r\n\r\n                <!-- Swap Interface -->\r\n                <div class=\"swap-interface\">\r\n                    <div class=\"interface-card\">\r\n                        <!-- Settings Icon -->\r\n                        <el-popover placement=\"bottom-end\" :width=\"300\" trigger=\"click\">\r\n                            <template #reference>\r\n                                <div class=\"settings-icon\">\r\n                                    <el-icon class=\"settings-btn\">\r\n                                        <Setting />\r\n                                    </el-icon>\r\n                                </div>\r\n                            </template>\r\n                            <div class=\"settings-content\">\r\n                                <h4 class=\"settings-title\">{{ $t('swap.settings') }}</h4>\r\n                                <div class=\"detail-item\">\r\n                                    <span>{{ $t('swap.slippage') }}</span>\r\n                                    <div class=\"slippage-selector\">\r\n                                        <button v-for=\"value in slippageOptions\" :key=\"value\"\r\n                                            :class=\"{ active: slippage === value }\" @click=\"slippage = value\">\r\n                                            {{ value }}%\r\n                                        </button>\r\n                                        <div class=\"custom-slippage\">\r\n                                            <input type=\"number\" v-model=\"customSlippage\" @input=\"handleCustomSlippage\"\r\n                                                placeholder=\"Custom\" />\r\n                                            <span>%</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </el-popover>\r\n                        <!-- Token Selection -->\r\n                        <div class=\"token-selection\">\r\n                            <div class=\"token-input-container\">\r\n                                <div class=\"token-input-header\">\r\n                                    <span class=\"input-label\">{{ $t('swap.sell') }}</span>\r\n                                </div>\r\n                                <div class=\"input-section\">\r\n                                    <div class=\"input-group\">\r\n                                        <div class=\"amount-input\">\r\n                                            <div class=\"input-with-select\">\r\n                                                <FormattedInput v-model=\"fromAmount\"\r\n                                                    :placeholder=\"formatNumberK(fromTokenBalance) + '  ' + $t('available')\"\r\n                                                    size=\"large\" :decimals=\"6\" :use-abbreviation=\"true\"\r\n                                                    :max-decimals=\"fromToken?.decimals\"\r\n                                                    :disabled=\"isSwapping || isLoadingQuote\"\r\n                                                    @input-change=\"handleFromAmountChange\" />\r\n                                                <TokenSelect v-model=\"fromToken\" :tokens=\"availableTokens\"\r\n                                                    placeholder=\"Select token\" :disabled=\"isSwapping\"\r\n                                                    @token-change=\"fromTokenChange\" />\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <!-- Quick Amount Buttons -->\r\n                                    <div class=\"quick-amounts\">\r\n                                        <el-button v-for=\"percentage in [25, 50, 75]\" :key=\"percentage\" size=\"small\"\r\n                                            @click=\"setDepositPercentage(percentage)\" :disabled=\"isSwapping\">\r\n                                            {{ percentage }}%\r\n                                        </el-button>\r\n                                        <el-button @click=\"setMaxFromAmount\" class=\"max-button\" size=\"small\"\r\n                                            :disabled=\"isSwapping\">\r\n                                            {{ $t('common.max') }}\r\n                                        </el-button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <!-- Swap Direction Button -->\r\n                            <div class=\"swap-direction\">\r\n                                <el-button circle @click=\"swapTokens\" class=\"swap-direction-btn\"\r\n                                    :disabled=\"isSwapping || isLoadingQuote\">\r\n                                    <el-icon class=\"swap-icon\" :style=\"{ transform: `rotate(${swapIconRotation}deg)` }\">\r\n                                        <Sort />\r\n                                    </el-icon>\r\n                                </el-button>\r\n                            </div>\r\n\r\n                            <div class=\"token-input-container\">\r\n                                <div class=\"token-input-header\">\r\n                                    <span class=\"input-label\">{{ $t('swap.buy') }}</span>\r\n                                </div>\r\n                                <div class=\"input-section\">\r\n                                    <div class=\"input-group\">\r\n                                        <div class=\"amount-input\">\r\n                                            <div class=\"input-with-select\">\r\n                                                <FormattedInput v-model=\"toAmount\"\r\n                                                    :placeholder=\"formatNumberK(toTokenBalance) + '  ' + $t('available')\"\r\n                                                    size=\"large\" :decimals=\"6\" :use-abbreviation=\"true\"\r\n                                                    :max-decimals=\"toToken?.decimals\"\r\n                                                    :disabled=\"isSwapping || isLoadingQuote\"\r\n                                                    @input-change=\"handleToAmountChange\" />\r\n                                                <TokenSelect v-model=\"toToken\" :tokens=\"availableTokens\"\r\n                                                    placeholder=\"Select token\" :disabled=\"isSwapping\"\r\n                                                    @token-change=\"toTokenChange\" />\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <!-- Swap Preview -->\r\n                        <div class=\"swap-details\">\r\n                            <h4 class=\"details-title\">{{ $t('swap.details') }}</h4>\r\n                            <div class=\"details-content\">\r\n                                <!-- Uniswap V4 Status -->\r\n                                <div class=\"detail-row\" v-if=\"walletStore.isConnected\">\r\n                                    <span>{{ $t('swap.protocolStatus') }}</span>\r\n                                    <span class=\"status-indicator\">\r\n                                        <span v-if=\"isV4Supported\" class=\"status-supported\">{{\r\n                                            $t('swap.uniswapV4Available')\r\n                                        }}</span>\r\n                                        <span v-else class=\"status-unsupported\">\r\n                                            {{ $t('swap.v4NotSupported') }}\r\n                                            <el-tooltip :content=\"$t('swap.switchToSupportedNetwork')\" placement=\"top\">\r\n                                                <el-icon class=\"info-icon\">\r\n                                                    <InfoFilled />\r\n                                                </el-icon>\r\n                                            </el-tooltip>\r\n                                        </span>\r\n                                    </span>\r\n                                </div>\r\n\r\n                                <!-- Pool Status -->\r\n                                <div class=\"detail-row\"\r\n                                    v-if=\"isV4Supported && fromToken && toToken && fromToken.symbol !== toToken.symbol\">\r\n                                    <span>{{ $t('swap.poolStatus') }}</span>\r\n                                    <span class=\"status-indicator\">\r\n                                        <span v-if=\"poolExists\" class=\"status-supported\">{{ $t('swap.poolAvailable')\r\n                                        }}</span>\r\n                                        <span v-else class=\"status-warning\">\r\n                                            {{ $t('swap.poolNotExists') }}\r\n                                            <el-tooltip :content=\"$t('swap.poolNotExistsTooltip')\" placement=\"top\">\r\n                                                <el-icon class=\"info-icon\">\r\n                                                    <InfoFilled />\r\n                                                </el-icon>\r\n                                            </el-tooltip>\r\n                                        </span>\r\n                                    </span>\r\n                                </div>\r\n\r\n                                <!-- Price Impact -->\r\n                                <!-- <div class=\"detail-row\" v-if=\"currentQuote && poolExists\">\r\n                                <span>{{ $t('swap.priceImpact') }}</span>\r\n                                <span class=\"detail-value\" :class=\"{\r\n                                    'price-impact-low': parseFloat(priceImpact) < 1,\r\n                                    'price-impact-medium': parseFloat(priceImpact) >= 1 && parseFloat(priceImpact) < 3,\r\n                                    'price-impact-high': parseFloat(priceImpact) >= 3\r\n                                }\">{{ formatNumber(parseFloat(priceImpact)) }}%</span>\r\n                            </div> -->\r\n\r\n                                <!-- <div class=\"detail-row\">\r\n                                <span>{{ $t('swap.fee') }}</span>\r\n                                <span class=\"detail-value fee-value\">{{ formatNumber(swapFee) }}%</span>\r\n                            </div> -->\r\n\r\n                                <div class=\"detail-row exchange-rate\">\r\n                                    <span>{{ $t('swap.rate') }}</span>\r\n                                    <span v-if=\"exchangeRate > 0 && fromToken && toToken\"\r\n                                        class=\"detail-value rate-value\">1 {{\r\n                                            fromToken.symbol }} ≈ {{\r\n                                            formatNumber(exchangeRate, 6) }} {{ toToken.symbol }}</span>\r\n                                    <span v-else class=\"detail-value no-rate-text\">{{ $t('swap.enterAmountForRate')\r\n                                    }}</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <!-- Action Button -->\r\n                        <div class=\"action-container\">\r\n                            <el-button class=\"action-button\" type=\"primary\" size=\"large\" :disabled=\"!canSwap\"\r\n                                @click=\"executeSwap\">\r\n                                {{ getSwapButtonText() }}\r\n                            </el-button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Transaction Modal -->\r\n        <TransactionModal v-model:visible=\"showTransactionModal\" :title=\"$t('swap.swapTransaction')\"\r\n            :steps=\"transactionSteps\" :current-step=\"currentTransactionStep\" :status=\"transactionStatus\"\r\n            :transaction-details=\"transactionDetails\" :gas-info=\"gasInfo\" :transaction-hash=\"transactionHash\"\r\n            :error-message=\"transactionError\" @close=\"handleTransactionModalClose\" @retry=\"retryTransaction\" />\r\n    </PullToRefresh>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted, onUnmounted, watch } from 'vue'\r\nimport { useWalletStore } from '@/stores/wallet'\r\nimport { formatNumber, formatNumberK, calculatePercentageAmount } from '@/utils/format'\r\nimport { useI18n } from 'vue-i18n'\r\nimport { Sort, InfoFilled, Setting } from '@element-plus/icons-vue'\r\nimport { ElMessage } from 'element-plus'\r\nimport { TOKENS } from '@/constants'\r\nimport { uniswapV4Service, type SwapParams, type QuoteResult } from '@/services/uniswapV4'\r\nimport TransactionModal from '@/components/common/TransactionModal.vue'\r\nimport PullToRefresh from '@/components/common/PullToRefresh.vue'\r\nimport TokenSelect from '@/components/TokenSelect.vue'\r\nimport FormattedInput from '@/components/common/FormattedInput.vue'\r\nimport { ethers, parseUnits } from 'ethers'\r\nimport { usePullToRefresh } from '@/composables/usePullToRefresh'\r\n\r\n// Stores and composables\r\nconst walletStore = useWalletStore()\r\nconst { t } = useI18n()\r\n\r\n// Pull to refresh\r\nconst { isRefreshing, pullDistance, isPulling, canRefresh } = usePullToRefresh({\r\n    onRefresh: async (): Promise<void> => {\r\n        try {\r\n            if (walletStore.isConnected) {\r\n                await Promise.all([\r\n                    updateTokenBalances(),\r\n                    checkUniswapV4Support(),\r\n                    checkPoolInfo()\r\n                ])\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to refresh swap data:', error)\r\n        }\r\n    }\r\n})\r\n\r\n// Swap icon rotation state\r\nconst swapIconRotation = ref(0)\r\n\r\n// Define types\r\ninterface Token {\r\n    symbol: string;\r\n    name: string;\r\n    address: string;\r\n    decimals: number;\r\n    balance?: number;\r\n}\r\n\r\n// Available tokens for Uniswap V4\r\nconst availableTokens = computed<Token[]>(() => {\r\n    const chainId = walletStore.chainId || 11155111\r\n\r\n    return [\r\n        {\r\n            symbol: TOKENS.WRMB.symbol,\r\n            name: TOKENS.WRMB.name,\r\n            address: TOKENS.WRMB.addresses[chainId as keyof typeof TOKENS.WRMB.addresses] || TOKENS.WRMB.addresses[11155111] || '0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984',\r\n            decimals: TOKENS.WRMB.decimals\r\n        },\r\n        {\r\n            symbol: TOKENS.USDC.symbol,\r\n            name: TOKENS.USDC.name,\r\n            address: TOKENS.USDC.addresses[chainId as keyof typeof TOKENS.USDC.addresses] || TOKENS.USDC.addresses[11155111] || '0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238',\r\n            decimals: TOKENS.USDC.decimals\r\n        },\r\n        {\r\n            symbol: TOKENS.USDT.symbol,\r\n            name: TOKENS.USDT.name,\r\n            address: TOKENS.USDT.addresses[chainId as keyof typeof TOKENS.USDT.addresses] || TOKENS.USDT.addresses[11155111] || '0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238',\r\n            decimals: TOKENS.USDT.decimals\r\n        }\r\n    ]\r\n})\r\n\r\n// Token data\r\nconst fromToken = ref<Token>()\r\nconst toToken = ref<Token>()\r\n\r\n// Initialize tokens\r\nwatch(availableTokens, (tokens) => {\r\n    if (tokens.length >= 2) {\r\n        if (!fromToken.value || fromToken.value.symbol !== tokens[0].symbol) {\r\n            fromToken.value = tokens[0]\r\n        }\r\n        if (!toToken.value || toToken.value.symbol !== tokens[1].symbol) {\r\n            toToken.value = tokens[1]\r\n        }\r\n    }\r\n}, { immediate: true })\r\n\r\nconst fromTokenChange = (value: Token, oldValue: Token | undefined) => {\r\n    if (value.symbol === toToken.value?.symbol && oldValue != undefined) {\r\n        toToken.value = oldValue;\r\n        changeFromToAmount();\r\n    }\r\n\r\n    // 取消当前请求并重新获取报价\r\n    cancelCurrentQuoteRequest()\r\n    currentQuote.value = null\r\n\r\n    // fromToken切换时使用正向计算\r\n    if (fromAmount.value && parseFloat(fromAmount.value) > 0) {\r\n        isForwardSwap.value = true\r\n        debouncedGetQuote()\r\n    }\r\n}\r\n\r\nconst changeFromToAmount = () => {\r\n    const tempAmount = fromAmount.value\r\n    fromAmount.value = toAmount.value\r\n    toAmount.value = tempAmount\r\n}\r\n\r\nconst toTokenChange = (value: Token, oldValue: Token | undefined) => {\r\n    if (value.symbol == fromToken.value?.symbol && oldValue != undefined) {\r\n        fromToken.value = oldValue\r\n        changeFromToAmount();\r\n    }\r\n\r\n    // 取消当前请求并重新获取报价\r\n    cancelCurrentQuoteRequest()\r\n    currentQuote.value = null\r\n\r\n    // toToken切换时使用反向计算\r\n    if (toAmount.value && parseFloat(toAmount.value) > 0) {\r\n        isForwardSwap.value = false\r\n        debouncedGetReverseQuote()\r\n    }\r\n}\r\n\r\nwatch(() => walletStore.chainId, (newChainId) => {\r\n    if (newChainId) {\r\n        uniswapV4Service.reinitialize()\r\n\r\n        const tokens = availableTokens.value\r\n        if (tokens.length >= 2) {\r\n            fromToken.value = tokens[0]\r\n            toToken.value = tokens[1]\r\n        }\r\n\r\n        checkUniswapV4Support()\r\n        checkPoolInfo()\r\n\r\n        currentQuote.value = null\r\n        fromAmount.value = ''\r\n        toAmount.value = ''\r\n    }\r\n})\r\n\r\n// Amounts\r\nconst fromAmount = ref('')\r\nconst toAmount = ref('')\r\nconst fromTokenBalance = ref('0')\r\nconst toTokenBalance = ref('0')\r\n\r\n// Swap settings\r\nconst slippageOptions = [1.0, 5.0]\r\nconst slippage = ref(1.0)\r\nconst customSlippage = ref('')\r\nconst exchangeRate = ref(6.5)\r\nconst swapFee = ref(0.3)\r\n\r\n// Uniswap V4 state\r\nconst isLoadingQuote = ref(false)\r\nconst isSwapping = ref(false)\r\nconst currentQuote = ref<QuoteResult | null>(null)\r\nconst poolExists = ref(false)\r\nconst priceImpact = ref('0')\r\nconst isV4Supported = ref(false)\r\n// 跟踪交换方向：true表示正向(fromAmount->toAmount)，false表示反向(toAmount->fromAmount)\r\nconst isForwardSwap = ref(true)\r\n\r\n// 请求管理状态\r\nconst currentQuoteController = ref<AbortController | null>(null)\r\nconst quoteRequestId = ref(0)\r\nconst isUserInputting = ref(false)\r\nconst lastQuoteTime = ref(0)\r\n\r\n// 防止循环触发的标志位\r\nconst isTokenSwapping = ref(false)\r\n\r\n// Transaction Modal state\r\nconst showTransactionModal = ref(false)\r\nconst currentTransactionStep = ref(0)\r\nconst transactionStatus = ref<'pending' | 'loading' | 'success' | 'error'>('pending')\r\nconst transactionHash = ref('')\r\nconst transactionError = ref('')\r\nconst gasInfo = ref<{\r\n    gasLimit: string\r\n    gasPrice: string\r\n    estimatedFee: string\r\n    maxFee: string\r\n} | undefined>(undefined)\r\n\r\n// Transaction steps\r\nconst transactionSteps = computed(() => [\r\n    {\r\n        label: t('swap.steps.checkAllowance'),\r\n        description: t('swap.steps.checkAllowanceDesc')\r\n    },\r\n    {\r\n        label: t('swap.steps.approve'),\r\n        description: t('swap.steps.approveDesc')\r\n    },\r\n    {\r\n        label: t('swap.steps.swap'),\r\n        description: t('swap.steps.swapDesc')\r\n    },\r\n    {\r\n        label: t('swap.steps.confirm'),\r\n        description: t('swap.steps.confirmDesc')\r\n    }\r\n])\r\n\r\n// Transaction details\r\nconst transactionDetails = computed(() => {\r\n    const details: {\r\n        label: string\r\n        value: string\r\n        highlight?: boolean\r\n        type?: 'debit' | 'credit'\r\n    }[] =\r\n        [\r\n            {\r\n                label: t('swap.sell'),\r\n                value: `-${formatNumber(fromAmount.value, 6)} ${fromToken.value?.symbol || ''}`,\r\n                highlight: true,\r\n                type: 'debit'\r\n            },\r\n            {\r\n                label: t('swap.buy'),\r\n                value: `+${formatNumber(toAmount.value, 6)} ${toToken.value?.symbol || ''}`,\r\n                highlight: true,\r\n                type: 'credit'\r\n            },\r\n        ]\r\n    return details\r\n})\r\n\r\nfunction updateExchangeRate() {\r\n    if (currentQuote.value && fromAmount.value && parseFloat(fromAmount.value) > 0) {\r\n        const fromAmountNum = parseFloat(fromAmount.value)\r\n        const toAmountNum = parseFloat(currentQuote.value.amountOut)\r\n        exchangeRate.value = toAmountNum / fromAmountNum\r\n    } else if (fromToken.value?.symbol === toToken.value?.symbol) {\r\n        exchangeRate.value = 1\r\n    } else {\r\n        exchangeRate.value = 0\r\n    }\r\n}\r\n\r\nconst canSwap = computed(() => {\r\n    return walletStore.isConnected &&\r\n        isV4Supported.value &&\r\n        poolExists.value &&\r\n        fromAmount.value &&\r\n        parseFloat(fromAmount.value) > 0 &&\r\n        parseFloat(fromAmount.value) <= parseFloat(fromTokenBalance.value) &&\r\n        !isSwapping.value &&\r\n        !isLoadingQuote.value &&\r\n        !isUserInputting.value &&\r\n        fromToken.value?.symbol !== toToken.value?.symbol\r\n})\r\n\r\n// 验证和格式化输入金额，确保不超过token的小数位数\r\nfunction validateAndFormatAmount(amount: string, decimals: number): string {\r\n    if (!amount) return ''\r\n\r\n    // 移除非数字和小数点的字符\r\n    const cleanAmount = amount.replace(/[^0-9.]/g, '')\r\n\r\n    // 确保只有一个小数点\r\n    const parts = cleanAmount.split('.')\r\n    if (parts.length > 2) {\r\n        return parts[0] + '.' + parts.slice(1).join('')\r\n    }\r\n\r\n    // 限制小数位数\r\n    if (parts.length === 2 && parts[1].length > decimals) {\r\n        return parts[0] + '.' + parts[1].substring(0, decimals)\r\n    }\r\n\r\n    return cleanAmount\r\n}\r\n\r\n// 防抖函数\r\nfunction debounce<T extends (...args: any[]) => any>(func: T, delay: number): (...args: Parameters<T>) => void {\r\n    let timeoutId: NodeJS.Timeout\r\n    return (...args: Parameters<T>) => {\r\n        clearTimeout(timeoutId)\r\n        timeoutId = setTimeout(() => func(...args), delay)\r\n    }\r\n}\r\n\r\n// 取消当前报价请求\r\nfunction cancelCurrentQuoteRequest() {\r\n    if (currentQuoteController.value) {\r\n        currentQuoteController.value.abort()\r\n        currentQuoteController.value = null\r\n    }\r\n}\r\n\r\n// 检查请求是否应该被忽略\r\nfunction shouldIgnoreQuoteRequest(requestId: number): boolean {\r\n    return requestId !== quoteRequestId.value\r\n}\r\n\r\nfunction handleFromAmountChange() {\r\n    // 标记用户正在输入\r\n    isUserInputting.value = true\r\n    if (fromToken.value) {\r\n        const validatedAmount = validateAndFormatAmount(fromAmount.value, fromToken.value.decimals)\r\n        if (validatedAmount !== fromAmount.value) {\r\n            fromAmount.value = validatedAmount\r\n            return\r\n        }\r\n    }\r\n\r\n    // 设置为正向交换\r\n    isForwardSwap.value = true\r\n\r\n    if (fromAmount.value && parseFloat(fromAmount.value) > 0) {\r\n        debouncedGetQuote()\r\n    } else {\r\n        cancelCurrentQuoteRequest()\r\n        toAmount.value = ''\r\n        currentQuote.value = null\r\n        updateExchangeRate()\r\n        isUserInputting.value = false\r\n    }\r\n}\r\n\r\nfunction handleToAmountChange() {\r\n    // 标记用户正在输入\r\n    isUserInputting.value = true\r\n    if (toToken.value) {\r\n        const validatedAmount = validateAndFormatAmount(toAmount.value, toToken.value.decimals)\r\n        if (validatedAmount !== toAmount.value) {\r\n            toAmount.value = validatedAmount\r\n            return\r\n        }\r\n    }\r\n\r\n    // 设置为反向交换\r\n    isForwardSwap.value = false\r\n\r\n    if (toAmount.value && parseFloat(toAmount.value) > 0) {\r\n        debouncedGetReverseQuote()\r\n    } else {\r\n        cancelCurrentQuoteRequest()\r\n        fromAmount.value = ''\r\n        currentQuote.value = null\r\n        updateExchangeRate()\r\n        isUserInputting.value = false\r\n    }\r\n}\r\n\r\n// 防抖的报价获取函数\r\nconst debouncedGetQuote = debounce(() => {\r\n    if (!isSwapping.value) {\r\n        getUniswapV4Quote()\r\n    }\r\n}, 1000)\r\n\r\nconst debouncedGetReverseQuote = debounce(() => {\r\n    if (!isSwapping.value) {\r\n        getReverseUniswapV4Quote()\r\n    }\r\n}, 1000)\r\n\r\nconst setDepositPercentage = (percentage: number) => {\r\n    isForwardSwap.value = true\r\n    if (parseFloat(fromTokenBalance.value) > 0) {\r\n        fromAmount.value = calculatePercentageAmount(fromTokenBalance.value, percentage, fromToken.value?.decimals)\r\n        handleFromAmountChange()\r\n    }\r\n}\r\n\r\nfunction setMaxFromAmount() {\r\n    isForwardSwap.value = true\r\n    if (parseFloat(fromTokenBalance.value) > 0) {\r\n        fromAmount.value = fromTokenBalance.value\r\n        handleFromAmountChange()\r\n    }\r\n}\r\n\r\nfunction handleCustomSlippage() {\r\n    if (customSlippage.value) {\r\n        slippage.value = parseFloat(customSlippage.value)\r\n    }\r\n}\r\n\r\nfunction swapTokens() {\r\n    // 防止在交换过程中或加载报价时切换代币\r\n    if (isSwapping.value || isLoadingQuote.value) {\r\n        return\r\n    }\r\n\r\n    // 取消当前的报价请求\r\n    cancelCurrentQuoteRequest()\r\n\r\n    const temp = fromToken.value\r\n    fromToken.value = toToken.value\r\n    toToken.value = temp\r\n\r\n    const tempAmount = fromAmount.value\r\n    fromAmount.value = toAmount.value\r\n    toAmount.value = tempAmount\r\n\r\n    const tempBalance = fromTokenBalance.value\r\n    fromTokenBalance.value = toTokenBalance.value\r\n    toTokenBalance.value = tempBalance\r\n\r\n    exchangeRate.value = 1 / exchangeRate.value\r\n\r\n    // Rotate icon by 180 degrees each time\r\n    swapIconRotation.value += 180\r\n\r\n    // 重新获取报价\r\n    if (fromAmount.value && parseFloat(fromAmount.value) > 0) {\r\n        isForwardSwap.value = true\r\n        debouncedGetQuote()\r\n    }\r\n}\r\n\r\nfunction getSwapButtonText() {\r\n    if (!walletStore.isConnected) {\r\n        return t('common.connected')\r\n    }\r\n\r\n    if (isSwapping.value) {\r\n        return t('swap.swapping')\r\n    }\r\n\r\n    if (isLoadingQuote.value) {\r\n        return t('swap.fetchingQuote')\r\n    }\r\n\r\n    if (!isV4Supported.value) {\r\n        const supportedNetworks = uniswapV4Service.getSupportedNetworks()\r\n        const networkNames = supportedNetworks.map(id => {\r\n            if (id === 1) return t('swap.mainnet')\r\n            if (id === 11155111) return t('swap.sepoliaTestnet')\r\n            return t('swap.network', { id })\r\n        }).join('、')\r\n        return t('swap.unsupportedNetwork', { networks: networkNames })\r\n    }\r\n\r\n    // if (!fromAmount.value || parseFloat(fromAmount.value) <= 0) {\r\n    //     return t('swap.enterAmount')\r\n    // }\r\n\r\n    // if (parseFloat(fromAmount.value) > parseFloat(fromTokenBalance.value)) {\r\n    //     return t('swap.insufficientBalance')\r\n    // }\r\n\r\n    return t('swap.swap')\r\n}\r\n\r\nfunction executeSwap() {\r\n    if (!canSwap.value) return\r\n\r\n    resetTransactionState()\r\n\r\n    showTransactionModal.value = true\r\n    transactionStatus.value = 'loading'\r\n    currentTransactionStep.value = 0\r\n\r\n    if (isV4Supported.value && poolExists.value) {\r\n        executeUniswapV4Swap()\r\n    } else {\r\n        transactionStatus.value = 'error'\r\n        transactionError.value = t('swap.networkNotSupportedError')\r\n    }\r\n}\r\n\r\nasync function getUniswapV4Quote() {\r\n    if (!fromAmount.value || !fromToken.value || !toToken.value || fromToken.value.symbol === toToken.value.symbol) {\r\n        currentQuote.value = null\r\n        toAmount.value = ''\r\n        return\r\n    }\r\n\r\n    if (!isV4Supported.value) {\r\n        return\r\n    }\r\n\r\n    // 取消之前的请求\r\n    cancelCurrentQuoteRequest()\r\n\r\n    // 生成新的请求ID\r\n    const requestId = ++quoteRequestId.value\r\n\r\n    // 创建新的AbortController\r\n    currentQuoteController.value = new AbortController()\r\n    const controller = currentQuoteController.value\r\n\r\n    isLoadingQuote.value = true\r\n    lastQuoteTime.value = Date.now()\r\n\r\n    try {\r\n        const swapParams: SwapParams = {\r\n            tokenIn: fromToken.value!.address,\r\n            tokenOut: toToken.value!.address,\r\n            amountIn: fromAmount.value,\r\n            swapType: 'exactInput',\r\n            slippage: slippage.value\r\n        }\r\n\r\n        const quote = await uniswapV4Service.getQuote(swapParams)\r\n\r\n        // 检查请求是否已被取消或过期\r\n        if (controller.signal.aborted || shouldIgnoreQuoteRequest(requestId)) {\r\n            return\r\n        }\r\n\r\n        if (quote) {\r\n            currentQuote.value = quote\r\n            toAmount.value = quote.amountOut\r\n            priceImpact.value = quote.priceImpact\r\n            swapFee.value = parseFloat(quote.fee)\r\n            poolExists.value = true\r\n            updateExchangeRate()\r\n        } else {\r\n            currentQuote.value = null\r\n            toAmount.value = ''\r\n            poolExists.value = false\r\n            updateExchangeRate()\r\n        }\r\n    } catch (error) {\r\n        // 如果是取消错误，不显示错误消息\r\n        if (controller.signal.aborted || shouldIgnoreQuoteRequest(requestId)) {\r\n            return\r\n        }\r\n\r\n        currentQuote.value = null\r\n        toAmount.value = ''\r\n        poolExists.value = false\r\n        updateExchangeRate()\r\n\r\n        ElMessage.error(t('swap.getQuoteFailed', { error: (error as Error).message }))\r\n    } finally {\r\n        // 只有当前请求才更新加载状态\r\n        if (!shouldIgnoreQuoteRequest(requestId)) {\r\n            isLoadingQuote.value = false\r\n            isUserInputting.value = false\r\n        }\r\n\r\n        // 清理controller\r\n        if (currentQuoteController.value === controller) {\r\n            currentQuoteController.value = null\r\n        }\r\n    }\r\n}\r\n\r\nasync function getReverseUniswapV4Quote() {\r\n    if (!toAmount.value || !fromToken.value || !toToken.value || fromToken.value.symbol === toToken.value.symbol) {\r\n        currentQuote.value = null\r\n        fromAmount.value = ''\r\n        return\r\n    }\r\n\r\n    if (!isV4Supported.value) {\r\n        return\r\n    }\r\n\r\n    // 取消之前的请求\r\n    cancelCurrentQuoteRequest()\r\n\r\n    // 生成新的请求ID\r\n    const requestId = ++quoteRequestId.value\r\n\r\n    // 创建新的AbortController\r\n    currentQuoteController.value = new AbortController()\r\n    const controller = currentQuoteController.value\r\n\r\n    isLoadingQuote.value = true\r\n    lastQuoteTime.value = Date.now()\r\n\r\n    try {\r\n        // 反向报价：使用exactOutput模式，指定期望的输出数量\r\n        const swapParams: SwapParams = {\r\n            tokenIn: fromToken.value!.address,\r\n            tokenOut: toToken.value!.address,\r\n            amountOut: toAmount.value,\r\n            swapType: 'exactOutput',\r\n            slippage: slippage.value\r\n        }\r\n\r\n        const quote = await uniswapV4Service.getQuote(swapParams)\r\n\r\n        // 检查请求是否已被取消或过期\r\n        if (controller.signal.aborted || shouldIgnoreQuoteRequest(requestId)) {\r\n            return\r\n        }\r\n\r\n        if (quote) {\r\n            // 反向报价的结果：quote.amountIn是需要的输入数量，quote.amountOut是期望的输出数量\r\n            fromAmount.value = quote.amountIn!\r\n            currentQuote.value = quote\r\n            priceImpact.value = quote.priceImpact\r\n            swapFee.value = parseFloat(quote.fee)\r\n            poolExists.value = true\r\n            updateExchangeRate()\r\n        } else {\r\n            currentQuote.value = null\r\n            fromAmount.value = ''\r\n            poolExists.value = false\r\n            updateExchangeRate()\r\n        }\r\n    } catch (error) {\r\n        // 如果是取消错误，不显示错误消息\r\n        if (controller.signal.aborted || shouldIgnoreQuoteRequest(requestId)) {\r\n            return\r\n        }\r\n\r\n        currentQuote.value = null\r\n        fromAmount.value = ''\r\n        poolExists.value = false\r\n        updateExchangeRate()\r\n\r\n        ElMessage.error(t('swap.getReverseQuoteFailed', { error: (error as Error).message }))\r\n    } finally {\r\n        // 只有当前请求才更新加载状态\r\n        if (!shouldIgnoreQuoteRequest(requestId)) {\r\n            isLoadingQuote.value = false\r\n            isUserInputting.value = false\r\n        }\r\n\r\n        // 清理controller\r\n        if (currentQuoteController.value === controller) {\r\n            currentQuoteController.value = null\r\n        }\r\n    }\r\n}\r\n\r\nasync function executeUniswapV4Swap() {\r\n    if (!currentQuote.value || isSwapping.value) return\r\n\r\n    // 取消所有正在进行的报价请求\r\n    cancelCurrentQuoteRequest()\r\n\r\n    // 设置交易状态，防止其他操作干扰\r\n    isSwapping.value = true\r\n    isUserInputting.value = false\r\n\r\n    try {\r\n        // 交换方向始终是从fromToken到toToken\r\n        // 区别在于：正向交换指定输入数量，反向交换指定输出数量\r\n        const swapParams: SwapParams = {\r\n            tokenIn: fromToken.value!.address,\r\n            tokenOut: toToken.value!.address,\r\n            amountIn: isForwardSwap.value ? fromAmount.value : (currentQuote.value.amountIn || fromAmount.value),\r\n            amountOut: isForwardSwap.value ? undefined : toAmount.value,\r\n            swapType: isForwardSwap.value ? 'exactInput' : 'exactOutput',\r\n            slippage: slippage.value\r\n        }\r\n\r\n        if (!uniswapV4Service.isNetworkSupported(walletStore.chainId)) {\r\n            transactionStatus.value = 'error'\r\n            transactionError.value = t('swap.networkNotSupportedV4')\r\n            return\r\n        }\r\n\r\n        await uniswapV4Service.reinitialize()\r\n\r\n        const userAddress = walletStore.address\r\n        if (!userAddress) {\r\n            transactionStatus.value = 'error'\r\n            transactionError.value = t('swap.connectWalletFirst')\r\n            return\r\n        }\r\n\r\n        const quote = await uniswapV4Service.getQuote(swapParams)\r\n        if (!quote) {\r\n            transactionStatus.value = 'error'\r\n            transactionError.value = t('swap.cannotGetQuoteError')\r\n            return\r\n        }\r\n\r\n        currentTransactionStep.value = 0\r\n        transactionStatus.value = 'loading'\r\n\r\n        const addresses = uniswapV4Service.getContractAddresses(walletStore.chainId)\r\n        const PERMIT2_ADDRESS = addresses.PERMIT2\r\n\r\n        const permit2Allowance = await uniswapV4Service.checkAllowance(\r\n            swapParams.tokenIn,\r\n            PERMIT2_ADDRESS,\r\n            userAddress\r\n        )\r\n\r\n        const tokenInContract = uniswapV4Service.getTokenContract(swapParams.tokenIn, true)\r\n        const tokenInDecimals = await tokenInContract.decimals()\r\n        const amountInFrom = parseUnits(fromAmount.value, tokenInDecimals)\r\n\r\n        const slippageMultiplierOut = BigInt(Math.floor((100 + swapParams.slippage) * 100))\r\n        const maxAmountInBigInt = amountInFrom * slippageMultiplierOut / BigInt(10000)\r\n        const amountIn = isForwardSwap.value ? amountInFrom : maxAmountInBigInt\r\n\r\n        if (BigInt(permit2Allowance) < BigInt(amountIn)) {\r\n            currentTransactionStep.value = 1\r\n            transactionStatus.value = 'pending'\r\n\r\n            const approveSuccess = await uniswapV4Service.approveToken(\r\n                swapParams.tokenIn,\r\n                PERMIT2_ADDRESS,\r\n                ethers.MaxUint256.toString()\r\n            )\r\n\r\n            if (!approveSuccess) {\r\n                transactionStatus.value = 'error'\r\n                transactionError.value = t('swap.permit2AuthFailed')\r\n                return\r\n            }\r\n        }\r\n        const permit2Contract = new ethers.Contract(\r\n            PERMIT2_ADDRESS,\r\n            [\r\n                'function allowance(address owner, address token, address spender) external view returns (uint160 amount, uint48 expiration, uint48 nonce)'\r\n            ],\r\n            uniswapV4Service.provider\r\n        )\r\n\r\n        const permit2AllowanceData = await permit2Contract.allowance(\r\n            userAddress,\r\n            swapParams.tokenIn,\r\n            addresses.UNIVERSAL_ROUTER\r\n        )\r\n\r\n        if (BigInt(permit2AllowanceData.amount) < BigInt(amountIn)) {\r\n            currentTransactionStep.value = 1\r\n            transactionStatus.value = 'pending'\r\n\r\n            const deadline = Math.floor(Date.now() / 1000) + (30 * 24 * 3600)\r\n            const permit2ContractWithSigner = new ethers.Contract(\r\n                PERMIT2_ADDRESS,\r\n                [\r\n                    'function approve(address token, address spender, uint160 amount, uint48 expiration) external'\r\n                ],\r\n                uniswapV4Service.signer\r\n            )\r\n\r\n            const permit2ApproveTx = await permit2ContractWithSigner.approve(\r\n                swapParams.tokenIn,\r\n                addresses.UNIVERSAL_ROUTER,\r\n                \"1461501637330902918203684832716283019655932542975\",\r\n                deadline\r\n            )\r\n            await permit2ApproveTx.wait()\r\n        }\r\n\r\n        currentTransactionStep.value = 2\r\n        transactionStatus.value = 'loading'\r\n\r\n\r\n        const tokenOutContract = uniswapV4Service.getTokenContract(swapParams.tokenOut)\r\n        const tokenOutDecimals = await tokenOutContract.decimals()\r\n        const slippageMultiplier = BigInt(Math.floor((100 - swapParams.slippage) * 100))\r\n        const amountOutBigInt = parseUnits(quote.amountOut, tokenOutDecimals)\r\n        const minAmountOut = amountOutBigInt * slippageMultiplier / BigInt(10000)\r\n        const amountOutTo = parseUnits(toAmount.value, tokenOutDecimals)\r\n\r\n        const poolKey = {\r\n            currency0: swapParams.tokenIn < swapParams.tokenOut ? swapParams.tokenIn : swapParams.tokenOut,\r\n            currency1: swapParams.tokenIn < swapParams.tokenOut ? swapParams.tokenOut : swapParams.tokenIn,\r\n            fee: 500,\r\n            tickSpacing: 10,\r\n            hooks: ethers.ZeroAddress\r\n        }\r\n\r\n        if (poolKey.currency0 == '0x45Dd667b7C97F7c7B9135dA7f8674dF7d6662737' || poolKey.currency1 == '0x45Dd667b7C97F7c7B9135dA7f8674dF7d6662737') {\r\n            poolKey.hooks = '0x7d08875f51879bedD9a01d71a804f012e1304fC0'\r\n        }\r\n\r\n        const zeroForOne = poolKey.currency0 === swapParams.tokenIn\r\n        const deadline = Math.floor(Date.now() / 1000) + 3600\r\n\r\n        const Actions = {\r\n            SWAP_EXACT_IN_SINGLE: 0x06,\r\n            SWAP_EXACT_OUT_SINGLE: 0x08,\r\n            SETTLE_ALL: 0x0c,\r\n            TAKE_ALL: 0x0f\r\n        }\r\n\r\n        const CommandType = {\r\n            V4_SWAP: 0x10\r\n        }\r\n\r\n        const POOL_KEY_STRUCT = '(address currency0,address currency1,uint24 fee,int24 tickSpacing,address hooks)'\r\n        const SWAP_EXACT_IN_SINGLE_STRUCT = '(' + POOL_KEY_STRUCT + ' poolKey,bool zeroForOne,uint128 amountIn,uint128 amountOutMinimum,bytes hookData)'\r\n        const SWAP_EXACT_OUT_SINGLE_STRUCT = '(' + POOL_KEY_STRUCT + ' poolKey,bool zeroForOne,uint128 amountOut,uint128 amountInMaximum,bytes hookData)'\r\n\r\n        let v4Actions = '0x'\r\n        const v4Params: string[] = []\r\n\r\n\r\n        if (isForwardSwap.value) {\r\n            const swapParamsForTx = {\r\n                poolKey: poolKey,\r\n                zeroForOne: zeroForOne,\r\n                amountIn: amountIn,\r\n                amountOutMinimum: minAmountOut,\r\n                hookData: '0x'\r\n            }\r\n            const swapEncodedParam = ethers.AbiCoder.defaultAbiCoder().encode(\r\n                [SWAP_EXACT_IN_SINGLE_STRUCT],\r\n                [swapParamsForTx]\r\n            )\r\n            v4Params.push(swapEncodedParam)\r\n            v4Actions = v4Actions + Actions.SWAP_EXACT_IN_SINGLE.toString(16).padStart(2, '0')\r\n\r\n            const settleEncodedParam = ethers.AbiCoder.defaultAbiCoder().encode(\r\n                ['address', 'uint256'],\r\n                [swapParams.tokenIn, amountIn]\r\n            )\r\n            v4Params.push(settleEncodedParam)\r\n            v4Actions = v4Actions + Actions.SETTLE_ALL.toString(16).padStart(2, '0')\r\n\r\n            const takeEncodedParam = ethers.AbiCoder.defaultAbiCoder().encode(\r\n                ['address', 'uint256'],\r\n                [swapParams.tokenOut, minAmountOut]\r\n            )\r\n            v4Params.push(takeEncodedParam)\r\n            v4Actions = v4Actions + Actions.TAKE_ALL.toString(16).padStart(2, '0')\r\n        } else {\r\n            const swapParamsForTxOut = {\r\n                poolKey: poolKey,\r\n                zeroForOne: zeroForOne,\r\n                amountOut: amountOutTo,\r\n                amountInMaximum: maxAmountInBigInt,\r\n                hookData: '0x'\r\n            }\r\n            const swapEncodedParam = ethers.AbiCoder.defaultAbiCoder().encode(\r\n                [SWAP_EXACT_OUT_SINGLE_STRUCT],\r\n                [swapParamsForTxOut]\r\n            )\r\n            v4Params.push(swapEncodedParam)\r\n            v4Actions = v4Actions + Actions.SWAP_EXACT_OUT_SINGLE.toString(16).padStart(2, '0')\r\n\r\n            const settleEncodedParam = ethers.AbiCoder.defaultAbiCoder().encode(\r\n                ['address', 'uint256'],\r\n                [swapParams.tokenIn, maxAmountInBigInt]\r\n            )\r\n            v4Params.push(settleEncodedParam)\r\n            v4Actions = v4Actions + Actions.SETTLE_ALL.toString(16).padStart(2, '0')\r\n\r\n            const takeEncodedParam = ethers.AbiCoder.defaultAbiCoder().encode(\r\n                ['address', 'uint256'],\r\n                [swapParams.tokenOut, amountOutTo]\r\n            )\r\n            v4Params.push(takeEncodedParam)\r\n            v4Actions = v4Actions + Actions.TAKE_ALL.toString(16).padStart(2, '0')\r\n        }\r\n\r\n        const encodedV4Actions = ethers.AbiCoder.defaultAbiCoder().encode(\r\n            ['bytes', 'bytes[]'],\r\n            [v4Actions, v4Params]\r\n        )\r\n\r\n        let commands = '0x'\r\n        const inputs: string[] = []\r\n\r\n        inputs.push(encodedV4Actions)\r\n        commands = commands + CommandType.V4_SWAP.toString(16).padStart(2, '0')\r\n\r\n        const txOptions: any = {\r\n            value: swapParams.tokenIn === ethers.ZeroAddress ? amountIn : 0\r\n        }\r\n        const swapRouterContract = uniswapV4Service.swapRouterContract\r\n\r\n        const tx = await swapRouterContract!.execute(\r\n            commands,\r\n            inputs,\r\n            deadline,\r\n            txOptions\r\n        )\r\n\r\n        currentTransactionStep.value = 3\r\n        transactionStatus.value = 'loading'\r\n\r\n        const receipt = await tx.wait()\r\n        transactionHash.value = receipt.hash\r\n        currentTransactionStep.value = 4\r\n        transactionStatus.value = 'success'\r\n        setTimeout(() => {\r\n            fromAmount.value = ''\r\n            toAmount.value = ''\r\n            currentQuote.value = null\r\n            priceImpact.value = '0'\r\n            swapFee.value = 0.3\r\n        }, 2000)\r\n\r\n        await updateTokenBalances()\r\n\r\n        await checkPoolInfo()\r\n    } catch (error) {\r\n        const errorMessage = (error as Error).message\r\n\r\n        transactionStatus.value = 'error'\r\n\r\n        if (errorMessage.includes('insufficient funds')) {\r\n            transactionError.value = t('swap.insufficientFundsError')\r\n        } else if (errorMessage.includes('allowance')) {\r\n            transactionError.value = t('swap.allowanceError')\r\n        } else if (errorMessage.includes('slippage')) {\r\n            transactionError.value = t('swap.slippageError')\r\n        } else if (errorMessage.includes('pool')) {\r\n            transactionError.value = t('swap.poolError')\r\n        } else {\r\n            transactionError.value = t('swap.swapFailedError', { error: errorMessage })\r\n        }\r\n    } finally {\r\n        isSwapping.value = false\r\n    }\r\n}\r\n\r\nasync function checkUniswapV4Support() {\r\n    if (!walletStore.isConnected || !walletStore.chainId) {\r\n        isV4Supported.value = false\r\n        return\r\n    }\r\n\r\n    isV4Supported.value = uniswapV4Service.isNetworkSupported(walletStore.chainId)\r\n}\r\n\r\nasync function checkPoolInfo() {\r\n    if (!fromToken.value || !toToken.value || fromToken.value.symbol === toToken.value.symbol) {\r\n        poolExists.value = false\r\n        return\r\n    }\r\n\r\n    if (!walletStore.isConnected || !walletStore.chainId) {\r\n        poolExists.value = false\r\n        return\r\n    }\r\n\r\n    if (!isV4Supported.value) {\r\n        poolExists.value = false\r\n        return\r\n    }\r\n\r\n    try {\r\n        const poolInfo = await uniswapV4Service.getPoolInfo(\r\n            fromToken.value.address,\r\n            toToken.value.address,\r\n            500\r\n        )\r\n\r\n        poolExists.value = poolInfo !== null\r\n    } catch (error) {\r\n        poolExists.value = false\r\n    }\r\n}\r\n\r\nwatch([fromToken, toToken], async () => {\r\n    if (walletStore.isConnected) {\r\n        currentQuote.value = null\r\n        updateExchangeRate()\r\n        await updateTokenBalances()\r\n        await checkPoolInfo()\r\n    }\r\n})\r\n\r\nwatch(() => walletStore.isConnected, async (connected) => {\r\n    if (connected) {\r\n        await uniswapV4Service.reinitialize()\r\n        await checkUniswapV4Support()\r\n        await updateTokenBalances()\r\n        await checkPoolInfo()\r\n    } else {\r\n        isV4Supported.value = false\r\n        poolExists.value = false\r\n        currentQuote.value = null\r\n    }\r\n})\r\n\r\nwatch(() => walletStore.chainId, async (newChainId) => {\r\n    if (newChainId && walletStore.isConnected) {\r\n        await uniswapV4Service.reinitialize()\r\n        await checkUniswapV4Support()\r\n        availableTokens.value.forEach(token => {\r\n            if (token.symbol === 'WRMB') {\r\n                token.address = TOKENS.WRMB.addresses[newChainId as keyof typeof TOKENS.WRMB.addresses] || token.address\r\n            } else if (token.symbol === 'USDC') {\r\n                token.address = TOKENS.USDC.addresses[newChainId as keyof typeof TOKENS.USDC.addresses] || token.address\r\n            }\r\n        })\r\n        await checkPoolInfo()\r\n    }\r\n})\r\n\r\nasync function updateTokenBalances() {\r\n    if (!walletStore.isConnected || !walletStore.address) {\r\n        fromTokenBalance.value = '0'\r\n        toTokenBalance.value = '0'\r\n        return\r\n    }\r\n\r\n    try {\r\n        const [fromBalance, toBalance] = await Promise.all([\r\n            uniswapV4Service.getTokenBalance(fromToken.value!.address, walletStore.address),\r\n            uniswapV4Service.getTokenBalance(toToken.value!.address, walletStore.address)\r\n        ])\r\n\r\n        fromTokenBalance.value = fromBalance\r\n        toTokenBalance.value = toBalance\r\n    } catch (error) {\r\n        fromTokenBalance.value = '1000'\r\n        toTokenBalance.value = '500'\r\n    }\r\n}\r\n\r\nfunction resetTransactionState() {\r\n    currentTransactionStep.value = 0\r\n    transactionStatus.value = 'pending'\r\n    transactionHash.value = ''\r\n    transactionError.value = ''\r\n    gasInfo.value = undefined\r\n}\r\n\r\nfunction handleTransactionModalClose() {\r\n    showTransactionModal.value = false\r\n    resetTransactionState()\r\n}\r\n\r\nfunction retryTransaction() {\r\n    resetTransactionState()\r\n    executeSwap()\r\n}\r\n\r\nonMounted(async () => {\r\n    await checkUniswapV4Support()\r\n    await updateTokenBalances()\r\n    updateExchangeRate()\r\n    await checkPoolInfo()\r\n})\r\n\r\n// 组件卸载时清理资源\r\nonUnmounted(() => {\r\n    // 取消所有正在进行的请求\r\n    cancelCurrentQuoteRequest()\r\n\r\n    // 重置状态\r\n    isSwapping.value = false\r\n    isLoadingQuote.value = false\r\n    isUserInputting.value = false\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.swap {\r\n    @apply bg-gray-50 dark:bg-gray-900;\r\n}\r\n\r\n.swap-content {\r\n    @apply max-w-xl mx-auto px-6 py-8 space-y-8;\r\n}\r\n\r\n.section-title {\r\n    @apply text-2xl font-bold text-gray-900 dark:text-white mb-6;\r\n}\r\n\r\n.swap-interface {\r\n    @apply mb-8;\r\n}\r\n\r\n.interface-card {\r\n    @apply bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 transition-all duration-200 hover:shadow-md relative;\r\n}\r\n\r\n.settings-icon {\r\n    @apply absolute top-4 right-4 cursor-pointer;\r\n}\r\n\r\n.settings-btn {\r\n    @apply w-5 h-5 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors duration-200;\r\n}\r\n\r\n.settings-content {\r\n    @apply space-y-4;\r\n}\r\n\r\n.settings-title {\r\n    @apply text-sm font-semibold text-gray-900 dark:text-white mb-3 border-b border-gray-200 dark:border-gray-600 pb-2;\r\n}\r\n\r\n.token-selection {\r\n    @apply flex flex-col;\r\n}\r\n\r\n.token-input-container {\r\n    @apply w-full;\r\n}\r\n\r\n.token-input-header {\r\n    @apply flex justify-between mb-2 text-sm text-gray-600 dark:text-gray-400;\r\n}\r\n\r\n.input-label {\r\n    @apply text-sm font-medium text-gray-700 dark:text-gray-300;\r\n}\r\n\r\n.input-section {\r\n    @apply space-y-4 mb-6;\r\n}\r\n\r\n.input-group {\r\n    @apply flex flex-col space-y-3;\r\n}\r\n\r\n.amount-input {\r\n    @apply flex-1;\r\n}\r\n\r\n.token-selector {\r\n    @apply flex items-center gap-2 p-2 cursor-pointer;\r\n}\r\n\r\n.quick-amounts {\r\n    @apply flex space-x-2;\r\n}\r\n\r\n.max-button {\r\n    @apply text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300;\r\n}\r\n\r\n.input-with-select {\r\n    @apply flex w-full;\r\n}\r\n\r\n.input-with-select .el-input {\r\n    @apply flex-1;\r\n}\r\n\r\n.token-select {\r\n    @apply ml-2 w-32;\r\n}\r\n\r\n.swap-direction {\r\n    @apply flex justify-center;\r\n}\r\n\r\n.swap-direction-btn {\r\n    @apply bg-primary-50 dark:bg-primary-900 border-primary-200 dark:border-primary-700 hover:bg-primary-100 dark:hover:bg-primary-800;\r\n}\r\n\r\n.swap-icon {\r\n    @apply text-primary-600 dark:text-primary-400 transition-transform duration-200;\r\n}\r\n\r\n.swap-details {\r\n    @apply bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mt-6;\r\n}\r\n\r\n.details-title {\r\n    @apply text-sm font-medium text-gray-700 dark:text-gray-300 mb-3;\r\n}\r\n\r\n.details-content {\r\n    @apply space-y-2;\r\n}\r\n\r\n.detail-row {\r\n    @apply flex items-center justify-between text-sm;\r\n}\r\n\r\n.detail-row span:first-child:not(.status-supported):not(.status-unsupported):not(.status-warning):not(.network-mainnet) {\r\n    @apply text-gray-600 dark:text-gray-400;\r\n}\r\n\r\n.detail-row.exchange-rate {\r\n    @apply border-t border-gray-200 dark:border-gray-600 pt-2 mt-2;\r\n}\r\n\r\n.detail-value {\r\n    @apply font-medium text-gray-900 dark:text-white;\r\n}\r\n\r\n.fee-value {\r\n    @apply text-yellow-600 dark:text-yellow-400 font-medium;\r\n}\r\n\r\n.rate-value {\r\n    @apply text-primary-400 dark:text-primary-300 font-semibold;\r\n}\r\n\r\n.no-rate-text {\r\n    @apply text-gray-500 dark:text-gray-400;\r\n}\r\n\r\n/* Status indicators */\r\n.status-indicator {\r\n    @apply flex items-center gap-1;\r\n}\r\n\r\n.status-supported {\r\n    @apply text-green-600 dark:text-green-400 font-medium;\r\n}\r\n\r\n.status-unsupported {\r\n    @apply text-red-600 dark:text-red-400 font-medium flex items-center gap-1;\r\n}\r\n\r\n.status-warning {\r\n    @apply text-yellow-600 dark:text-yellow-400 font-medium flex items-center gap-1;\r\n}\r\n\r\n.network-mainnet {\r\n    @apply text-green-600 dark:text-green-400 font-medium;\r\n}\r\n\r\n.network-testnet {\r\n    @apply text-yellow-600 dark:text-yellow-400 font-medium;\r\n}\r\n\r\n.network-unknown {\r\n    @apply text-red-600 dark:text-red-400 font-medium;\r\n}\r\n\r\n.info-icon {\r\n    @apply w-4 h-4 cursor-help;\r\n}\r\n\r\n.loading-text {\r\n    @apply text-blue-500 dark:text-blue-400 animate-pulse;\r\n}\r\n\r\n.no-rate-text {\r\n    @apply text-gray-500 dark:text-gray-400;\r\n}\r\n\r\n/* Price impact colors */\r\n.price-impact-low {\r\n    @apply text-green-600 dark:text-green-400;\r\n}\r\n\r\n.price-impact-medium {\r\n    @apply text-yellow-600 dark:text-yellow-400;\r\n}\r\n\r\n.price-impact-high {\r\n    @apply text-red-600 dark:text-red-400 font-semibold;\r\n}\r\n\r\n.slippage-selector {\r\n    @apply flex gap-2;\r\n}\r\n\r\n.slippage-selector button {\r\n    @apply py-1 px-2 rounded bg-gray-50 dark:bg-gray-700 border border-transparent cursor-pointer text-xs;\r\n}\r\n\r\n.detail-item {\r\n    @apply flex items-center justify-between;\r\n}\r\n\r\n.slippage-selector button.active {\r\n    @apply bg-primary-50 dark:bg-primary-900 border-primary-500 text-primary-600 dark:text-primary-400;\r\n}\r\n\r\n.custom-slippage {\r\n    @apply flex items-center bg-gray-50 dark:bg-gray-700 rounded px-2;\r\n}\r\n\r\n.custom-slippage input {\r\n    @apply w-14 bg-transparent border-none py-1 text-xs outline-none;\r\n}\r\n\r\n.action-container {\r\n    @apply mt-6;\r\n}\r\n\r\n.action-button {\r\n    @apply w-full;\r\n}\r\n\r\n.swap-button:hover {\r\n    @apply bg-primary-600;\r\n}\r\n\r\n.swap-button:disabled {\r\n    @apply bg-gray-300 dark:bg-gray-600 cursor-not-allowed;\r\n}\r\n\r\n/* Liquidity Pools Section */\r\n.liquidity-section {\r\n    @apply bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6;\r\n}\r\n\r\n.pools-grid {\r\n    @apply grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6;\r\n}\r\n\r\n.pool-card {\r\n    @apply bg-gray-50 dark:bg-gray-700 rounded-xl p-6 shadow-sm;\r\n}\r\n\r\n.pool-header {\r\n    @apply flex justify-between items-center mb-4;\r\n}\r\n\r\n.pool-tokens {\r\n    @apply flex items-center;\r\n}\r\n\r\n.token-icon-overlap {\r\n    @apply -ml-2;\r\n}\r\n\r\n.pool-fee {\r\n    @apply bg-gray-100 dark:bg-gray-600 py-1 px-2 rounded text-xs;\r\n}\r\n\r\n.pool-stats {\r\n    @apply grid grid-cols-3 gap-2 mb-6;\r\n}\r\n\r\n.stat-item {\r\n    @apply flex flex-col;\r\n}\r\n\r\n.stat-label {\r\n    @apply text-xs text-gray-600 dark:text-gray-400;\r\n}\r\n\r\n.stat-value {\r\n    @apply font-semibold text-sm text-gray-900 dark:text-white;\r\n}\r\n\r\n.pool-actions {\r\n    @apply flex gap-3;\r\n}\r\n\r\n.action-btn {\r\n    @apply flex-1 py-3 rounded-lg font-semibold text-sm cursor-pointer text-center bg-primary-500 text-white border-none;\r\n}\r\n\r\n.action-btn.outline {\r\n    @apply bg-transparent border border-primary-500 text-primary-600 dark:text-primary-400;\r\n}\r\n\r\n/* Status indicators */\r\n.status-indicator {\r\n    @apply flex items-center;\r\n}\r\n\r\n.status-supported {\r\n    @apply text-green-600 dark:text-green-400 font-medium;\r\n}\r\n\r\n.status-unsupported {\r\n    @apply text-red-600 dark:text-red-400 font-medium;\r\n}\r\n\r\n.status-warning {\r\n    @apply text-yellow-600 dark:text-yellow-400 font-medium;\r\n}\r\n\r\n.loading-text {\r\n    @apply text-blue-600 dark:text-blue-400 animate-pulse;\r\n}\r\n\r\n/* Price impact colors */\r\n.price-impact-low {\r\n    @apply text-green-600 dark:text-green-400;\r\n}\r\n\r\n.price-impact-medium {\r\n    @apply text-yellow-600 dark:text-yellow-400;\r\n}\r\n\r\n.price-impact-high {\r\n    @apply text-red-600 dark:text-red-400 font-semibold;\r\n}\r\n\r\n/* Uniswap V4 specific styles */\r\n.v4-badge {\r\n    @apply inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200;\r\n}\r\n\r\n.pool-status {\r\n    @apply flex items-center gap-2;\r\n}\r\n\r\n.pool-status-dot {\r\n    @apply w-2 h-2 rounded-full;\r\n}\r\n\r\n.pool-status-dot.active {\r\n    @apply bg-green-500;\r\n}\r\n\r\n.pool-status-dot.inactive {\r\n    @apply bg-red-500;\r\n}\r\n\r\n.pool-status-dot.warning {\r\n    @apply bg-yellow-500;\r\n}\r\n\r\n/* Responsive adjustments */\r\n@media (max-width: 768px) {\r\n    .swap-content {\r\n        @apply px-4 py-6;\r\n    }\r\n\r\n    .status-indicator {\r\n        @apply text-sm;\r\n    }\r\n\r\n    .detail-item {\r\n        @apply text-sm;\r\n    }\r\n\r\n    .pools-grid {\r\n        @apply grid-cols-1;\r\n    }\r\n\r\n    .pool-stats {\r\n        @apply grid-cols-2;\r\n    }\r\n}\r\n\r\n:deep(.el-tabs__header) {\r\n    @apply mb-0;\r\n}\r\n\r\n:deep(.el-tabs__nav-wrap::after) {\r\n    @apply bg-gray-200 dark:bg-gray-700;\r\n}\r\n\r\n:deep(.el-tabs__active-bar) {\r\n    @apply bg-primary-500;\r\n}\r\n\r\n:deep(.el-tabs__item) {\r\n    @apply text-gray-600 dark:text-gray-400;\r\n}\r\n\r\n:deep(.el-tabs__item.is-active) {\r\n    @apply text-primary-600 dark:text-primary-400;\r\n}\r\n</style>"],"names":["MaxUint256","UNISWAP_V4_ADDRESSES","NETWORKS","POOL_MANAGER_ABI","STATE_VIEW_ABI","UNIVERSAL_ROUTER_ABI","QUOTER_ABI","ERC20_ABI","UniswapV4Service","walletStore","useWalletStore","addresses","currentNetworkName","ElMessage","Contract","address","withSigner","providerOrSigner","token0","token1","fee","tickSpacing","currency0","currency1","hooks","ethers.keccak256","ethers.AbiCoder","poolId","liquidity","slot0","error","tokenIn","tokenOut","amountIn","amountOut","currentSqrtPriceX96","amountInNum","amountOutNum","tradeSize","params","tokenInContract","tokenOutContract","tokenInDecimals","tokenOutDecimals","zeroForOne","quoteParams","result","inputAmount","outputAmount","exactAmountIn","parseUnits","formatUnits","exactAmountOut","priceImpact","tokenAddress","spenderAddress","userAddress","tokenContract","amount","amountToApprove","ethers.MaxUint256","tx","balance","decimals","chainId","uniswapV4Service","t","useI18n","isRefreshing","pullDistance","isPulling","canRefresh","usePullToRefresh","updateTokenBalances","checkUniswapV4Support","checkPoolInfo","swapIconRotation","ref","availableTokens","computed","TOKENS","fromToken","toToken","watch","tokens","fromTokenChange","value","oldValue","changeFromToAmount","cancelCurrentQuoteRequest","currentQuote","fromAmount","isForwardSwap","debouncedGetQuote","tempAmount","toAmount","toTokenChange","debouncedGetReverseQuote","newChainId","fromTokenBalance","toTokenBalance","slippageOptions","slippage","customSlippage","exchangeRate","swapFee","isLoadingQuote","isSwapping","poolExists","isV4Supported","currentQuoteController","quoteRequestId","isUserInputting","lastQuoteTime","showTransactionModal","currentTransactionStep","transactionStatus","transactionHash","transactionError","gasInfo","transactionSteps","transactionDetails","formatNumber","updateExchangeRate","fromAmountNum","toAmountNum","canSwap","validateAndFormatAmount","cleanAmount","parts","debounce","func","delay","timeoutId","args","shouldIgnoreQuoteRequest","requestId","handleFromAmountChange","validatedAmount","handleToAmountChange","getUniswapV4Quote","getReverseUniswapV4Quote","setDepositPercentage","percentage","calculatePercentageAmount","setMaxFromAmount","handleCustomSlippage","swapTokens","temp","tempBalance","getSwapButtonText","networkNames","id","executeSwap","resetTransactionState","executeUniswapV4Swap","controller","swapParams","quote","PERMIT2_ADDRESS","permit2Allowance","amountInFrom","slippageMultiplierOut","maxAmountInBigInt","permit2AllowanceData","ethers.Contract","deadline","slippageMultiplier","minAmountOut","amountOutTo","poolKey","ethers.ZeroAddress","Actions","CommandType","POOL_KEY_STRUCT","SWAP_EXACT_IN_SINGLE_STRUCT","SWAP_EXACT_OUT_SINGLE_STRUCT","v4Actions","v4Params","swapParamsForTx","swapEncodedParam","settleEncodedParam","takeEncodedParam","swapParamsForTxOut","encodedV4Actions","commands","inputs","txOptions","receipt","errorMessage","poolInfo","connected","token","fromBalance","toBalance","handleTransactionModalClose","retryTransaction","onMounted","onUnmounted","_createBlock","PullToRefresh","_unref","_createElementVNode","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_toDisplayString","$t","_hoisted_5","_hoisted_6","_createVNode","_component_el_popover","_hoisted_7","_component_el_icon","Setting","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_createElementBlock","_Fragment","_renderList","_normalizeClass","$event","_hoisted_12","_hoisted_13","_cache","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","FormattedInput","formatNumberK","TokenSelect","_hoisted_22","_component_el_button","_createTextVNode","_hoisted_23","Sort","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_openBlock","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_component_el_tooltip","InfoFilled","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","TransactionModal"],"mappings":"2rBAKiB,OAAO,oEAAoE,EAMjE,OAAO,qBAAqB,EAMhD,MAAMA,GAAa,OAAO,oEAAoE,EAM5E,OAAO,oEAAoE,EAAI,OAAO,EAAE,EAMxF,OAAO,oEAAoE,ECxBpG,MAAMC,GAAuB,CAC1B,EAAI,CACH,aAAc,6CACd,iBAAkB,6CAClB,OAAQ,6CACR,WAAY,6CACZ,QAAS,4CACX,EACC,SAAW,CACV,aAAc,6CACd,iBAAkB,6CAClB,OAAQ,6CACR,WAAY,6CACZ,iBAAkB,6CAClB,QAAS,4CACX,EACA,CAACC,GAAS,MAAM,OAAO,EAAG,CACxB,aAAc,6CACd,iBAAkB,6CAClB,OAAQ,6CACR,WAAY,6CACZ,QAAS,4CAAA,CAEb,EAEMC,GAAmB,CACvB,iLACA,iLACA,mHACA,yJACA,uEACA,2EACF,EAEMC,GAAiB,CACrB,+HACA,wEACA,qLACA,6FACA,gPACA,mFACA,mFACA,iGACF,EAEMC,GAAuB,CAC3B,CACE,OAAQ,CACN,CAAE,aAAc,QAAS,KAAM,WAAY,KAAM,OAAQ,EACzD,CAAE,aAAc,UAAW,KAAM,SAAU,KAAM,SAAU,EAC3D,CAAE,aAAc,UAAW,KAAM,WAAY,KAAM,SAAU,CAC/D,EACA,KAAM,UACN,QAAS,CAAC,EACV,gBAAiB,UACjB,KAAM,UAAA,CAEV,EAEMC,GAAa,CACjB,iPACA,gPACF,EAEMC,GAAY,CAChB,qDACA,8DACA,oDACA,qDACA,2CACA,0CACA,uCACF,EA8BA,MAAMC,EAAiB,CACb,oBAAuC,KACxC,mBAAsC,KACrC,eAAkC,KAClC,kBAAqC,KACtC,SAAmC,KACnC,OAA+B,KAEtC,aAAc,CACZ,KAAK,oBAAoB,CAAA,CAG3B,MAAc,qBAAsB,CAClC,MAAMC,EAAcC,GAAe,EAEnC,GAAI,CAACD,EAAY,UAAY,CAACA,EAAY,QACxC,OAGF,KAAK,SAAWA,EAAY,SAC5B,KAAK,OAASA,EAAY,OAEpB,MAAAE,EAAYV,GAAqBQ,EAAY,OAA4C,EAE/F,GAAI,CAACE,EAAW,CAOd,MAAMC,EAN0C,CAC9C,EAAG,QACH,EAAG,aACH,SAAU,cACV,MAAO,OACT,EACwCH,EAAY,OAAO,GAAK,MAAMA,EAAY,OAAO,GAEzFI,EAAU,QAAQ,CAChB,QAAS,mBAAmBD,CAAkB,sBAC9C,SAAU,GAAA,CACX,EACD,MAAA,CAGE,GAAA,CACF,KAAK,oBAAsB,IAAIE,EAASH,EAAU,aAAcR,GAAkB,KAAK,QAAQ,EAC/F,KAAK,mBAAqB,IAAIW,EAASH,EAAU,iBAAkBN,GAAsB,KAAK,MAAM,EACpG,KAAK,eAAiB,IAAIS,EAASH,EAAU,OAAQL,GAAY,KAAK,QAAQ,EAC9E,KAAK,kBAAoB,IAAIQ,EAASH,EAAU,WAAYP,GAAgB,KAAK,QAAQ,OAC3E,CACd,KAAK,oBAAsB,KAC3B,KAAK,mBAAqB,KAC1B,KAAK,eAAiB,KACtB,KAAK,kBAAoB,IAAA,CAC3B,CAGF,MAAM,cAAe,CACnB,MAAM,KAAK,oBAAoB,CAAA,CAG1B,iBAAiBW,EAAiBC,EAAa,GAAiB,CACrE,MAAMC,EAAmBD,EAAa,KAAK,OAAS,KAAK,SACzD,OAAO,IAAIF,EAASC,EAASR,GAAWU,CAAgB,CAAA,CAGlD,eAAeC,EAAgBC,EAAgBC,EAAaC,EAAsB,GAAY,CACpG,KAAM,CAACC,EAAWC,CAAS,EAAIL,EAAO,cAAgBC,EAAO,YAAY,EAAI,CAACD,EAAQC,CAAM,EAAI,CAACA,EAAQD,CAAM,EAC/G,IAAIM,EAAQ,6CACR,OAAAF,GAAa,8CAAgDC,GAAa,gDACpEC,EAAA,8CAGMC,GACdC,EAAgB,gBAAA,EAAkB,OAChC,CAAC,UAAW,UAAW,SAAU,QAAS,SAAS,EACnD,CAACJ,EAAWC,EAAWH,EAAKC,EAAaG,CAAK,CAAA,CAElD,CACO,CAGT,MAAM,YAAYN,EAAgBC,EAAgBC,EAAc,IAAKC,EAAsB,GAA8B,CAKnH,GAJC,KAAK,mBACR,MAAM,KAAK,oBAAoB,EAG7B,CAAC,KAAK,kBACF,MAAA,IAAI,MAAM,oCAAoC,EAGlD,GAAA,CACF,MAAMM,EAAS,KAAK,eAAeT,EAAQC,EAAQC,EAAKC,CAAW,EAC7DO,EAAY,MAAM,KAAK,kBAAkB,aAAaD,CAAM,EAE9D,GAAAC,EAAU,SAAS,IAAM,IACpB,OAAA,KAGT,MAAMC,EAAQ,MAAM,KAAK,kBAAkB,SAASF,CAAM,EAEnD,MAAA,CACL,OAAAA,EACA,OAAQT,EAAO,cAAgBC,EAAO,YAAA,EAAgBD,EAASC,EAC/D,OAAQD,EAAO,cAAgBC,EAAO,YAAA,EAAgBA,EAASD,EAC/D,IAAAE,EACA,aAAcS,EAAM,aAAa,SAAS,EAC1C,KAAMA,EAAM,KACZ,UAAWD,EAAU,SAAS,CAChC,QACOE,EAAO,CACT,OAAAA,EAAc,OAAS,iBACnB,IAEF,CACT,CAGF,MAAc,qBACZC,EACAC,EACAC,EACAC,EACAP,EACiB,CACb,GAAA,CACE,GAAA,CAAC,KAAK,kBACD,MAAA,IAIT,MAAMQ,GADQ,MAAM,KAAK,kBAAkB,SAASR,CAAM,GACxB,aAE5BS,EAAc,WAAWH,CAAQ,EACjCI,EAAe,WAAWH,CAAS,EAErC,GAAAE,IAAgB,GAAKC,IAAiB,EACjC,MAAA,GAGT,MAAMC,EAAYF,EAClB,OAAIE,EAAY,IACP,IACEA,EAAY,IACd,IACEA,EAAY,IACd,GAEA,QAEK,CACP,MAAA,GAAA,CACT,CAGF,MAAM,SAASC,EAAiD,CAC9D,MAAM9B,EAAcC,GAAe,EAEnC,GAAI,CAAC,KAAK,mBAAmBD,EAAY,OAAO,EAC9C,OAAAI,EAAU,MAAM,qCAAqC,EAC9C,KAOL,GAJC,KAAK,gBACR,MAAM,KAAK,oBAAoB,EAG7B,CAAC,KAAK,eACF,MAAA,IAAI,MAAM,iCAAiC,EAG/C,GAAA,CACF,MAAM2B,EAAkB,KAAK,iBAAiBD,EAAO,OAAO,EACtDE,EAAmB,KAAK,iBAAiBF,EAAO,QAAQ,EAExD,CAACG,EAAiBC,CAAgB,EAAI,MAAM,QAAQ,IAAI,CAC5DH,EAAgB,SAAS,EACzBC,EAAiB,SAAS,CAAA,CAC3B,EAEKd,EAAS,KAAK,eAAeY,EAAO,QAASA,EAAO,SAAU,GAAG,EACjErB,EAASqB,EAAO,QAAQ,YAAY,EAAIA,EAAO,SAAS,YAAY,EAAIA,EAAO,QAAUA,EAAO,SAChGpB,EAASoB,EAAO,QAAQ,YAAY,EAAIA,EAAO,SAAS,YAAY,EAAIA,EAAO,SAAWA,EAAO,QACjGK,EAAaL,EAAO,QAAQ,YAAY,IAAMrB,EAAO,YAAY,EAEjE2B,EAAc,CAClB,QAAS,CACP,UAAW3B,EACX,UAAWC,EACX,IAAK,IACL,YAAa,GACb,MAAO,4CACT,EACA,WAAAyB,EACA,YAAa,OAAO,CAAC,EACrB,SAAU,IACZ,GAEI1B,GAAU,8CAAgDC,GAAU,gDACtE0B,EAAY,QAAQ,MAAQ,8CAG1B,IAAAC,EACAZ,EACAD,EACAc,EACAC,EAEA,GAAAT,EAAO,WAAa,aAAc,CACpC,GAAI,CAACA,EAAO,SAAgB,MAAA,IAAI,MAAM,qCAAqC,EAC3E,MAAMU,EAAgBC,GAAWX,EAAO,SAAUG,CAAe,EACjEG,EAAY,YAAcI,EAC1BH,EAAS,MAAM,KAAK,eAAe,sBAAsB,WAAWD,CAAW,EACnEX,EAAAiB,GAAYL,EAAO,UAAWH,CAAgB,EAC1DV,EAAWM,EAAO,SAClBQ,EAAcR,EAAO,SACNS,EAAAd,CAAA,KACV,CACL,GAAI,CAACK,EAAO,UAAiB,MAAA,IAAI,MAAM,uCAAuC,EAC9E,MAAMa,EAAiBF,GAAWX,EAAO,UAAWI,CAAgB,EACpEE,EAAY,YAAcO,EAC1BN,EAAS,MAAM,KAAK,eAAe,uBAAuB,WAAWD,CAAW,EACrEZ,EAAAkB,GAAYL,EAAO,SAAUJ,CAAe,EACvDR,EAAYK,EAAO,UACLQ,EAAAd,EACde,EAAeT,EAAO,SAAA,CAGlB,MAAAc,EAAc,MAAM,KAAK,qBAC7Bd,EAAO,QACPA,EAAO,SACPQ,EACAC,EACArB,CACF,EAIO,MAAA,CACL,UAAAO,EACA,SAAAD,EACA,YAAaoB,EAAY,SAAS,EAClC,IANU,OAOV,MAAO,CAACd,EAAO,QAASA,EAAO,QAAQ,CACzC,OACc,CACP,OAAA,IAAA,CACT,CAGF,MAAM,eAAee,EAAsBC,EAAwBC,EAAsC,CACjG,MAAAC,EAAgB,KAAK,iBAAiBH,CAAY,EACpD,GAAA,CAEF,OADkB,MAAMG,EAAc,UAAUD,EAAaD,CAAc,GAC1D,SAAS,OACZ,CACP,MAAA,GAAA,CACT,CAGF,MAAM,aAAaD,EAAsBC,EAAwBG,EAAkC,CACjG,MAAMD,EAAgB,KAAK,iBAAiBH,EAAc,EAAI,EAE1D,GAAA,CACF,MAAMK,EAAkBC,GAClBC,EAAK,MAAMJ,EAAc,QAAQF,EAAgBI,CAAe,EAEtE,OAAA9C,EAAU,KAAK,iBAAiB,EAChC,MAAMgD,EAAG,KAAK,EAEdhD,EAAU,QAAQ,QAAQ,EACnB,QACO,CACd,OAAAA,EAAU,MAAM,QAAQ,EACjB,EAAA,CACT,CAGF,MAAM,gBAAgByC,EAAsBE,EAAsC,CAC1E,MAAAC,EAAgB,KAAK,iBAAiBH,CAAY,EAEpD,GAAA,CACF,KAAM,CAACQ,EAASC,CAAQ,EAAI,MAAM,QAAQ,IAAI,CAC5CN,EAAc,UAAUD,CAAW,EACnCC,EAAc,SAAS,CAAA,CACxB,EAEM,OAAAN,GAAYW,EAASC,CAAQ,OACtB,CACP,MAAA,GAAA,CACT,CAGF,sBAAiC,CAC/B,OAAO,OAAO,KAAK9D,EAAoB,EAAE,IAAI,MAAM,CAAA,CAGrD,mBAAmB+D,EAA0B,CAC3C,OAAOA,KAAW/D,EAAA,CAGpB,qBAAqB+D,EAAiB,CAC7B,OAAA/D,GAAqB+D,CAA4C,GAAK,IAAA,CAEjF,CAGa,MAAAC,EAAmB,IAAIzD,i1CClMpC,MAAMC,EAAcC,GAAe,EAC7B,CAAE,EAAAwD,CAAE,EAAIC,GAAQ,EAGhB,CAAE,aAAAC,EAAc,aAAAC,EAAc,UAAAC,EAAW,WAAAC,CAAA,EAAeC,GAAiB,CAC3E,UAAW,SAA2B,CAC9B,GAAA,CACI/D,EAAY,aACZ,MAAM,QAAQ,IAAI,CACdgE,GAAoB,EACpBC,GAAsB,EACtBC,EAAc,CAAA,CACjB,QAEA7C,EAAO,CACJ,QAAA,MAAM,+BAAgCA,CAAK,CAAA,CACvD,CACJ,CACH,EAGK8C,EAAmBC,EAAI,CAAC,EAYxBC,EAAkBC,GAAkB,IAAM,CACtC,MAAAf,EAAUvD,EAAY,SAAW,SAEhC,MAAA,CACH,CACI,OAAQuE,EAAO,KAAK,OACpB,KAAMA,EAAO,KAAK,KAClB,QAASA,EAAO,KAAK,UAAUhB,CAA6C,GAAKgB,EAAO,KAAK,UAAU,QAAQ,GAAK,6CACpH,SAAUA,EAAO,KAAK,QAC1B,EACA,CACI,OAAQA,EAAO,KAAK,OACpB,KAAMA,EAAO,KAAK,KAClB,QAASA,EAAO,KAAK,UAAUhB,CAA6C,GAAKgB,EAAO,KAAK,UAAU,QAAQ,GAAK,6CACpH,SAAUA,EAAO,KAAK,QAC1B,EACA,CACI,OAAQA,EAAO,KAAK,OACpB,KAAMA,EAAO,KAAK,KAClB,QAASA,EAAO,KAAK,UAAUhB,CAA6C,GAAKgB,EAAO,KAAK,UAAU,QAAQ,GAAK,6CACpH,SAAUA,EAAO,KAAK,QAAA,CAE9B,CAAA,CACH,EAGKC,EAAYJ,EAAW,EACvBK,EAAUL,EAAW,EAGrBM,GAAAL,EAAkBM,GAAW,CAC3BA,EAAO,QAAU,KACb,CAACH,EAAU,OAASA,EAAU,MAAM,SAAWG,EAAO,CAAC,EAAE,UAC/CH,EAAA,MAAQG,EAAO,CAAC,IAE1B,CAACF,EAAQ,OAASA,EAAQ,MAAM,SAAWE,EAAO,CAAC,EAAE,UAC7CF,EAAA,MAAQE,EAAO,CAAC,GAEhC,EACD,CAAE,UAAW,GAAM,EAEhB,MAAAC,EAAkB,CAACC,EAAcC,IAAgC,CAC/DD,EAAM,SAAWJ,EAAQ,OAAO,QAAUK,GAAY,OACtDL,EAAQ,MAAQK,EACGC,EAAA,GAIGC,EAAA,EAC1BC,EAAa,MAAQ,KAGjBC,EAAW,OAAS,WAAWA,EAAW,KAAK,EAAI,IACnDC,EAAc,MAAQ,GACJC,GAAA,EAE1B,EAEML,EAAqB,IAAM,CAC7B,MAAMM,EAAaH,EAAW,MAC9BA,EAAW,MAAQI,EAAS,MAC5BA,EAAS,MAAQD,CACrB,EAEME,EAAgB,CAACV,EAAcC,IAAgC,CAC7DD,EAAM,QAAUL,EAAU,OAAO,QAAUM,GAAY,OACvDN,EAAU,MAAQM,EACCC,EAAA,GAIGC,EAAA,EAC1BC,EAAa,MAAQ,KAGjBK,EAAS,OAAS,WAAWA,EAAS,KAAK,EAAI,IAC/CH,EAAc,MAAQ,GACGK,GAAA,EAEjC,EAEAd,GAAM,IAAM1E,EAAY,QAAUyF,GAAe,CAC7C,GAAIA,EAAY,CACZjC,EAAiB,aAAa,EAE9B,MAAMmB,EAASN,EAAgB,MAC3BM,EAAO,QAAU,IACPH,EAAA,MAAQG,EAAO,CAAC,EAClBF,EAAA,MAAQE,EAAO,CAAC,GAGNV,GAAA,EACRC,EAAA,EAEde,EAAa,MAAQ,KACrBC,EAAW,MAAQ,GACnBI,EAAS,MAAQ,EAAA,CACrB,CACH,EAGK,MAAAJ,EAAad,EAAI,EAAE,EACnBkB,EAAWlB,EAAI,EAAE,EACjBsB,EAAmBtB,EAAI,GAAG,EAC1BuB,EAAiBvB,EAAI,GAAG,EAGxBwB,GAAkB,CAAC,EAAK,CAAG,EAC3BC,EAAWzB,EAAI,CAAG,EAClB0B,GAAiB1B,EAAI,EAAE,EACvB2B,EAAe3B,EAAI,GAAG,EACtB4B,GAAU5B,EAAI,EAAG,EAGjB6B,EAAiB7B,EAAI,EAAK,EAC1B8B,EAAa9B,EAAI,EAAK,EACtBa,EAAeb,EAAwB,IAAI,EAC3C+B,EAAa/B,EAAI,EAAK,EACtBxB,GAAcwB,EAAI,GAAG,EACrBgC,EAAgBhC,EAAI,EAAK,EAEzBe,EAAgBf,EAAI,EAAI,EAGxBiC,EAAyBjC,EAA4B,IAAI,EACzDkC,GAAiBlC,EAAI,CAAC,EACtBmC,EAAkBnC,EAAI,EAAK,EAC3BoC,GAAgBpC,EAAI,CAAC,EAGHA,EAAI,EAAK,EAG3B,MAAAqC,GAAuBrC,EAAI,EAAK,EAChCsC,EAAyBtC,EAAI,CAAC,EAC9BuC,EAAoBvC,EAAiD,SAAS,EAC9EwC,GAAkBxC,EAAI,EAAE,EACxByC,EAAmBzC,EAAI,EAAE,EACzB0C,GAAU1C,EAKD,MAAS,EAGlB2C,GAAmBzC,GAAS,IAAM,CACpC,CACI,MAAOb,EAAE,2BAA2B,EACpC,YAAaA,EAAE,+BAA+B,CAClD,EACA,CACI,MAAOA,EAAE,oBAAoB,EAC7B,YAAaA,EAAE,wBAAwB,CAC3C,EACA,CACI,MAAOA,EAAE,iBAAiB,EAC1B,YAAaA,EAAE,qBAAqB,CACxC,EACA,CACI,MAAOA,EAAE,oBAAoB,EAC7B,YAAaA,EAAE,wBAAwB,CAAA,CAC3C,CACH,EAGKuD,GAAqB1C,GAAS,IAO5B,CACI,CACI,MAAOb,EAAE,WAAW,EACpB,MAAO,IAAIwD,GAAa/B,EAAW,MAAO,CAAC,CAAC,IAAIV,EAAU,OAAO,QAAU,EAAE,GAC7E,UAAW,GACX,KAAM,OACV,EACA,CACI,MAAOf,EAAE,UAAU,EACnB,MAAO,IAAIwD,GAAa3B,EAAS,MAAO,CAAC,CAAC,IAAIb,EAAQ,OAAO,QAAU,EAAE,GACzE,UAAW,GACX,KAAM,QAAA,CAEd,CAEP,EAED,SAASyC,GAAqB,CACtB,GAAAjC,EAAa,OAASC,EAAW,OAAS,WAAWA,EAAW,KAAK,EAAI,EAAG,CACtE,MAAAiC,EAAgB,WAAWjC,EAAW,KAAK,EAC3CkC,EAAc,WAAWnC,EAAa,MAAM,SAAS,EAC3Dc,EAAa,MAAQqB,EAAcD,CAAA,MAC5B3C,EAAU,OAAO,SAAWC,EAAQ,OAAO,OAClDsB,EAAa,MAAQ,EAErBA,EAAa,MAAQ,CACzB,CAGE,MAAAsB,GAAU/C,GAAS,IACdtE,EAAY,aACfoG,EAAc,OACdD,EAAW,OACXjB,EAAW,OACX,WAAWA,EAAW,KAAK,EAAI,GAC/B,WAAWA,EAAW,KAAK,GAAK,WAAWQ,EAAiB,KAAK,GACjE,CAACQ,EAAW,OACZ,CAACD,EAAe,OAChB,CAACM,EAAgB,OACjB/B,EAAU,OAAO,SAAWC,EAAQ,OAAO,MAClD,EAGQ,SAAA6C,GAAwBrE,EAAgBK,EAA0B,CACnE,GAAA,CAACL,EAAe,MAAA,GAGpB,MAAMsE,EAActE,EAAO,QAAQ,WAAY,EAAE,EAG3CuE,EAAQD,EAAY,MAAM,GAAG,EAC/B,OAAAC,EAAM,OAAS,EACRA,EAAM,CAAC,EAAI,IAAMA,EAAM,MAAM,CAAC,EAAE,KAAK,EAAE,EAI9CA,EAAM,SAAW,GAAKA,EAAM,CAAC,EAAE,OAASlE,EACjCkE,EAAM,CAAC,EAAI,IAAMA,EAAM,CAAC,EAAE,UAAU,EAAGlE,CAAQ,EAGnDiE,CAAA,CAIF,SAAAE,GAA4CC,EAASC,EAAiD,CACvG,IAAAC,EACJ,MAAO,IAAIC,IAAwB,CAC/B,aAAaD,CAAS,EACtBA,EAAY,WAAW,IAAMF,EAAK,GAAGG,CAAI,EAAGF,CAAK,CACrD,CAAA,CAIJ,SAAS3C,GAA4B,CAC7BqB,EAAuB,QACvBA,EAAuB,MAAM,MAAM,EACnCA,EAAuB,MAAQ,KACnC,CAIJ,SAASyB,GAAyBC,EAA4B,CAC1D,OAAOA,IAAczB,GAAe,KAAA,CAGxC,SAAS0B,IAAyB,CAG9B,GADAzB,EAAgB,MAAQ,GACpB/B,EAAU,MAAO,CACjB,MAAMyD,EAAkBX,GAAwBpC,EAAW,MAAOV,EAAU,MAAM,QAAQ,EACtF,GAAAyD,IAAoB/C,EAAW,MAAO,CACtCA,EAAW,MAAQ+C,EACnB,MAAA,CACJ,CAIJ9C,EAAc,MAAQ,GAElBD,EAAW,OAAS,WAAWA,EAAW,KAAK,EAAI,EACjCE,GAAA,GAEQJ,EAAA,EAC1BM,EAAS,MAAQ,GACjBL,EAAa,MAAQ,KACFiC,EAAA,EACnBX,EAAgB,MAAQ,GAC5B,CAGJ,SAAS2B,IAAuB,CAG5B,GADA3B,EAAgB,MAAQ,GACpB9B,EAAQ,MAAO,CACf,MAAMwD,EAAkBX,GAAwBhC,EAAS,MAAOb,EAAQ,MAAM,QAAQ,EAClF,GAAAwD,IAAoB3C,EAAS,MAAO,CACpCA,EAAS,MAAQ2C,EACjB,MAAA,CACJ,CAIJ9C,EAAc,MAAQ,GAElBG,EAAS,OAAS,WAAWA,EAAS,KAAK,EAAI,EACtBE,GAAA,GAECR,EAAA,EAC1BE,EAAW,MAAQ,GACnBD,EAAa,MAAQ,KACFiC,EAAA,EACnBX,EAAgB,MAAQ,GAC5B,CAIE,MAAAnB,GAAoBqC,GAAS,IAAM,CAChCvB,EAAW,OACMiC,GAAA,GAEvB,GAAI,EAED3C,GAA2BiC,GAAS,IAAM,CACvCvB,EAAW,OACakC,GAAA,GAE9B,GAAI,EAEDC,GAAwBC,GAAuB,CACjDnD,EAAc,MAAQ,GAClB,WAAWO,EAAiB,KAAK,EAAI,IACrCR,EAAW,MAAQqD,GAA0B7C,EAAiB,MAAO4C,EAAY9D,EAAU,OAAO,QAAQ,EACnFwD,GAAA,EAE/B,EAEA,SAASQ,IAAmB,CACxBrD,EAAc,MAAQ,GAClB,WAAWO,EAAiB,KAAK,EAAI,IACrCR,EAAW,MAAQQ,EAAiB,MACbsC,GAAA,EAC3B,CAGJ,SAASS,IAAuB,CACxB3C,GAAe,QACND,EAAA,MAAQ,WAAWC,GAAe,KAAK,EACpD,CAGJ,SAAS4C,IAAa,CAEd,GAAAxC,EAAW,OAASD,EAAe,MACnC,OAIsBjB,EAAA,EAE1B,MAAM2D,EAAOnE,EAAU,MACvBA,EAAU,MAAQC,EAAQ,MAC1BA,EAAQ,MAAQkE,EAEhB,MAAMtD,EAAaH,EAAW,MAC9BA,EAAW,MAAQI,EAAS,MAC5BA,EAAS,MAAQD,EAEjB,MAAMuD,EAAclD,EAAiB,MACrCA,EAAiB,MAAQC,EAAe,MACxCA,EAAe,MAAQiD,EAEV7C,EAAA,MAAQ,EAAIA,EAAa,MAGtC5B,EAAiB,OAAS,IAGtBe,EAAW,OAAS,WAAWA,EAAW,KAAK,EAAI,IACnDC,EAAc,MAAQ,GACJC,GAAA,EACtB,CAGJ,SAASyD,IAAoB,CACrB,GAAA,CAAC7I,EAAY,YACb,OAAOyD,EAAE,kBAAkB,EAG/B,GAAIyC,EAAW,MACX,OAAOzC,EAAE,eAAe,EAG5B,GAAIwC,EAAe,MACf,OAAOxC,EAAE,oBAAoB,EAG7B,GAAA,CAAC2C,EAAc,MAAO,CAEhB,MAAA0C,EADoBtF,EAAiB,qBAAqB,EACzB,IAAUuF,GACzCA,IAAO,EAAUtF,EAAE,cAAc,EACjCsF,IAAO,SAAiBtF,EAAE,qBAAqB,EAC5CA,EAAE,eAAgB,CAAE,GAAAsF,EAAI,CAClC,EAAE,KAAK,GAAG,EACX,OAAOtF,EAAE,0BAA2B,CAAE,SAAUqF,EAAc,CAAA,CAWlE,OAAOrF,EAAE,WAAW,CAAA,CAGxB,SAASuF,IAAc,CACd3B,GAAQ,QAES4B,GAAA,EAEtBxC,GAAqB,MAAQ,GAC7BE,EAAkB,MAAQ,UAC1BD,EAAuB,MAAQ,EAE3BN,EAAc,OAASD,EAAW,MACb+C,GAAA,GAErBvC,EAAkB,MAAQ,QACTE,EAAA,MAAQpD,EAAE,+BAA+B,GAC9D,CAGJ,eAAe0E,IAAoB,CAC/B,GAAI,CAACjD,EAAW,OAAS,CAACV,EAAU,OAAS,CAACC,EAAQ,OAASD,EAAU,MAAM,SAAWC,EAAQ,MAAM,OAAQ,CAC5GQ,EAAa,MAAQ,KACrBK,EAAS,MAAQ,GACjB,MAAA,CAGA,GAAA,CAACc,EAAc,MACf,OAIsBpB,EAAA,EAGpB,MAAA+C,EAAY,EAAEzB,GAAe,MAGZD,EAAA,MAAQ,IAAI,gBACnC,MAAM8C,EAAa9C,EAAuB,MAE1CJ,EAAe,MAAQ,GACTO,GAAA,MAAQ,KAAK,IAAI,EAE3B,GAAA,CACA,MAAM4C,EAAyB,CAC3B,QAAS5E,EAAU,MAAO,QAC1B,SAAUC,EAAQ,MAAO,QACzB,SAAUS,EAAW,MACrB,SAAU,aACV,SAAUW,EAAS,KACvB,EAEMwD,EAAQ,MAAM7F,EAAiB,SAAS4F,CAAU,EAGxD,GAAID,EAAW,OAAO,SAAWrB,GAAyBC,CAAS,EAC/D,OAGAsB,GACApE,EAAa,MAAQoE,EACrB/D,EAAS,MAAQ+D,EAAM,UACvBzG,GAAY,MAAQyG,EAAM,YAClBrD,GAAA,MAAQ,WAAWqD,EAAM,GAAG,EACpClD,EAAW,MAAQ,GACAe,EAAA,IAEnBjC,EAAa,MAAQ,KACrBK,EAAS,MAAQ,GACjBa,EAAW,MAAQ,GACAe,EAAA,SAElB7F,EAAO,CAEZ,GAAI8H,EAAW,OAAO,SAAWrB,GAAyBC,CAAS,EAC/D,OAGJ9C,EAAa,MAAQ,KACrBK,EAAS,MAAQ,GACjBa,EAAW,MAAQ,GACAe,EAAA,EAET9G,EAAA,MAAMqD,EAAE,sBAAuB,CAAE,MAAQpC,EAAgB,OAAA,CAAS,CAAC,CAAA,QAC/E,CAEOyG,GAAyBC,CAAS,IACnC9B,EAAe,MAAQ,GACvBM,EAAgB,MAAQ,IAIxBF,EAAuB,QAAU8C,IACjC9C,EAAuB,MAAQ,KACnC,CACJ,CAGJ,eAAe+B,IAA2B,CACtC,GAAI,CAAC9C,EAAS,OAAS,CAACd,EAAU,OAAS,CAACC,EAAQ,OAASD,EAAU,MAAM,SAAWC,EAAQ,MAAM,OAAQ,CAC1GQ,EAAa,MAAQ,KACrBC,EAAW,MAAQ,GACnB,MAAA,CAGA,GAAA,CAACkB,EAAc,MACf,OAIsBpB,EAAA,EAGpB,MAAA+C,EAAY,EAAEzB,GAAe,MAGZD,EAAA,MAAQ,IAAI,gBACnC,MAAM8C,EAAa9C,EAAuB,MAE1CJ,EAAe,MAAQ,GACTO,GAAA,MAAQ,KAAK,IAAI,EAE3B,GAAA,CAEA,MAAM4C,EAAyB,CAC3B,QAAS5E,EAAU,MAAO,QAC1B,SAAUC,EAAQ,MAAO,QACzB,UAAWa,EAAS,MACpB,SAAU,cACV,SAAUO,EAAS,KACvB,EAEMwD,EAAQ,MAAM7F,EAAiB,SAAS4F,CAAU,EAGxD,GAAID,EAAW,OAAO,SAAWrB,GAAyBC,CAAS,EAC/D,OAGAsB,GAEAnE,EAAW,MAAQmE,EAAM,SACzBpE,EAAa,MAAQoE,EACrBzG,GAAY,MAAQyG,EAAM,YAClBrD,GAAA,MAAQ,WAAWqD,EAAM,GAAG,EACpClD,EAAW,MAAQ,GACAe,EAAA,IAEnBjC,EAAa,MAAQ,KACrBC,EAAW,MAAQ,GACnBiB,EAAW,MAAQ,GACAe,EAAA,SAElB7F,EAAO,CAEZ,GAAI8H,EAAW,OAAO,SAAWrB,GAAyBC,CAAS,EAC/D,OAGJ9C,EAAa,MAAQ,KACrBC,EAAW,MAAQ,GACnBiB,EAAW,MAAQ,GACAe,EAAA,EAET9G,EAAA,MAAMqD,EAAE,6BAA8B,CAAE,MAAQpC,EAAgB,OAAA,CAAS,CAAC,CAAA,QACtF,CAEOyG,GAAyBC,CAAS,IACnC9B,EAAe,MAAQ,GACvBM,EAAgB,MAAQ,IAIxBF,EAAuB,QAAU8C,IACjC9C,EAAuB,MAAQ,KACnC,CACJ,CAGJ,eAAe6C,IAAuB,CAClC,GAAI,GAACjE,EAAa,OAASiB,EAAW,OAGZ,CAAAlB,EAAA,EAG1BkB,EAAW,MAAQ,GACnBK,EAAgB,MAAQ,GAEpB,GAAA,CAGA,MAAM6C,EAAyB,CAC3B,QAAS5E,EAAU,MAAO,QAC1B,SAAUC,EAAQ,MAAO,QACzB,SAAUU,EAAc,MAAQD,EAAW,MAASD,EAAa,MAAM,UAAYC,EAAW,MAC9F,UAAWC,EAAc,MAAQ,OAAYG,EAAS,MACtD,SAAUH,EAAc,MAAQ,aAAe,cAC/C,SAAUU,EAAS,KACvB,EAEA,GAAI,CAACrC,EAAiB,mBAAmBxD,EAAY,OAAO,EAAG,CAC3D2G,EAAkB,MAAQ,QACTE,EAAA,MAAQpD,EAAE,4BAA4B,EACvD,MAAA,CAGJ,MAAMD,EAAiB,aAAa,EAEpC,MAAMT,EAAc/C,EAAY,QAChC,GAAI,CAAC+C,EAAa,CACd4D,EAAkB,MAAQ,QACTE,EAAA,MAAQpD,EAAE,yBAAyB,EACpD,MAAA,CAGJ,MAAM4F,EAAQ,MAAM7F,EAAiB,SAAS4F,CAAU,EACxD,GAAI,CAACC,EAAO,CACR1C,EAAkB,MAAQ,QACTE,EAAA,MAAQpD,EAAE,0BAA0B,EACrD,MAAA,CAGJiD,EAAuB,MAAQ,EAC/BC,EAAkB,MAAQ,UAE1B,MAAMzG,EAAYsD,EAAiB,qBAAqBxD,EAAY,OAAO,EACrEsJ,EAAkBpJ,EAAU,QAE5BqJ,GAAmB,MAAM/F,EAAiB,eAC5C4F,EAAW,QACXE,EACAvG,CACJ,EAGMd,GAAkB,MADAuB,EAAiB,iBAAiB4F,EAAW,QAAS,EAAI,EACpC,SAAS,EACjDI,GAAe/G,GAAWyC,EAAW,MAAOjD,EAAe,EAE3DwH,GAAwB,OAAO,KAAK,OAAO,IAAML,EAAW,UAAY,GAAG,CAAC,EAC5EM,GAAoBF,GAAeC,GAAwB,OAAO,GAAK,EACvEjI,GAAW2D,EAAc,MAAQqE,GAAeE,GAEtD,GAAI,OAAOH,EAAgB,EAAI,OAAO/H,EAAQ,IAC1CkF,EAAuB,MAAQ,EAC/BC,EAAkB,MAAQ,UAQtB,CANmB,MAAMnD,EAAiB,aAC1C4F,EAAW,QACXE,EACAnG,GAAkB,SAAS,CAC/B,GAEqB,CACjBwD,EAAkB,MAAQ,QACTE,EAAA,MAAQpD,EAAE,wBAAwB,EACnD,MAAA,CAWF,MAAAkG,GAAuB,MARL,IAAIC,EACxBN,EACA,CACI,2IACJ,EACA9F,EAAiB,QACrB,EAEmD,UAC/CT,EACAqG,EAAW,QACXlJ,EAAU,gBACd,EAEA,GAAI,OAAOyJ,GAAqB,MAAM,EAAI,OAAOnI,EAAQ,EAAG,CACxDkF,EAAuB,MAAQ,EAC/BC,EAAkB,MAAQ,UAEpBkD,MAAAA,GAAW,KAAK,MAAM,KAAK,IAAQ,EAAA,GAAI,EAAK,GAAK,GAAK,KAe5D,MANyB,MARS,IAAID,EAClCN,EACA,CACI,8FACJ,EACA9F,EAAiB,MACrB,EAEyD,QACrD4F,EAAW,QACXlJ,EAAU,iBACV,oDACA2J,EACJ,GACuB,KAAK,CAAA,CAGhCnD,EAAuB,MAAQ,EAC/BC,EAAkB,MAAQ,UAIpB,MAAAzE,GAAmB,MADAsB,EAAiB,iBAAiB4F,EAAW,QAAQ,EAC9B,SAAS,EACnDU,GAAqB,OAAO,KAAK,OAAO,IAAMV,EAAW,UAAY,GAAG,CAAC,EAEzEW,GADkBtH,GAAW4G,EAAM,UAAWnH,EAAgB,EAC7B4H,GAAqB,OAAO,GAAK,EAClEE,GAAcvH,GAAW6C,EAAS,MAAOpD,EAAgB,EAEzD+H,GAAU,CACZ,UAAWb,EAAW,QAAUA,EAAW,SAAWA,EAAW,QAAUA,EAAW,SACtF,UAAWA,EAAW,QAAUA,EAAW,SAAWA,EAAW,SAAWA,EAAW,QACvF,IAAK,IACL,YAAa,GACb,MAAOc,EACX,GAEID,GAAQ,WAAa,8CAAgDA,GAAQ,WAAa,gDAC1FA,GAAQ,MAAQ,8CAGd,MAAA9H,GAAa8H,GAAQ,YAAcb,EAAW,QAC9CS,GAAW,KAAK,MAAM,KAAK,IAAI,EAAI,GAAI,EAAI,KAE3CM,GAAU,CACZ,qBAAsB,EACtB,sBAAuB,EACvB,WAAY,GACZ,SAAU,EACd,EAEMC,GAAc,CAChB,QAAS,EACb,EAEMC,GAAkB,mFAClBC,GAA8B,IAAMD,GAAkB,qFACtDE,GAA+B,IAAMF,GAAkB,qFAE7D,IAAIG,EAAY,KAChB,MAAMC,EAAqB,CAAC,EAG5B,GAAItF,EAAc,MAAO,CACrB,MAAMuF,GAAkB,CACpB,QAAAT,GACA,WAAA9H,GACA,SAAAX,GACA,iBAAkBuI,GAClB,SAAU,IACd,EACMY,GAAmB1J,EAAgB,gBAAA,EAAkB,OACvD,CAACqJ,EAA2B,EAC5B,CAACI,EAAe,CACpB,EACAD,EAAS,KAAKE,EAAgB,EAClBH,EAAAA,EAAYL,GAAQ,qBAAqB,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,EAEjF,MAAMS,GAAqB3J,EAAgB,gBAAA,EAAkB,OACzD,CAAC,UAAW,SAAS,EACrB,CAACmI,EAAW,QAAS5H,EAAQ,CACjC,EACAiJ,EAAS,KAAKG,EAAkB,EACpBJ,EAAAA,EAAYL,GAAQ,WAAW,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,EAEvE,MAAMU,GAAmB5J,EAAgB,gBAAA,EAAkB,OACvD,CAAC,UAAW,SAAS,EACrB,CAACmI,EAAW,SAAUW,EAAY,CACtC,EACAU,EAAS,KAAKI,EAAgB,EAClBL,EAAAA,EAAYL,GAAQ,SAAS,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,CAAA,KAClE,CACH,MAAMW,GAAqB,CACvB,QAAAb,GACA,WAAA9H,GACA,UAAW6H,GACX,gBAAiBN,GACjB,SAAU,IACd,EACMiB,GAAmB1J,EAAgB,gBAAA,EAAkB,OACvD,CAACsJ,EAA4B,EAC7B,CAACO,EAAkB,CACvB,EACAL,EAAS,KAAKE,EAAgB,EAClBH,EAAAA,EAAYL,GAAQ,sBAAsB,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,EAElF,MAAMS,GAAqB3J,EAAgB,gBAAA,EAAkB,OACzD,CAAC,UAAW,SAAS,EACrB,CAACmI,EAAW,QAASM,EAAiB,CAC1C,EACAe,EAAS,KAAKG,EAAkB,EACpBJ,EAAAA,EAAYL,GAAQ,WAAW,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,EAEvE,MAAMU,GAAmB5J,EAAgB,gBAAA,EAAkB,OACvD,CAAC,UAAW,SAAS,EACrB,CAACmI,EAAW,SAAUY,EAAW,CACrC,EACAS,EAAS,KAAKI,EAAgB,EAClBL,EAAAA,EAAYL,GAAQ,SAAS,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,CAAA,CAGzE,MAAMY,GAAmB9J,EAAgB,gBAAA,EAAkB,OACvD,CAAC,QAAS,SAAS,EACnB,CAACuJ,EAAWC,CAAQ,CACxB,EAEA,IAAIO,GAAW,KACf,MAAMC,GAAmB,CAAC,EAE1BA,GAAO,KAAKF,EAAgB,EACjBC,GAAAA,GAAWZ,GAAY,QAAQ,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,EAEtE,MAAMc,GAAiB,CACnB,MAAO9B,EAAW,UAAYc,GAAqB1I,GAAW,CAClE,EAGM4B,GAAK,MAFgBI,EAAiB,mBAEP,QACjCwH,GACAC,GACApB,GACAqB,EACJ,EAEAxE,EAAuB,MAAQ,EAC/BC,EAAkB,MAAQ,UAEpB,MAAAwE,GAAU,MAAM/H,GAAG,KAAK,EAC9BwD,GAAgB,MAAQuE,GAAQ,KAChCzE,EAAuB,MAAQ,EAC/BC,EAAkB,MAAQ,UAC1B,WAAW,IAAM,CACbzB,EAAW,MAAQ,GACnBI,EAAS,MAAQ,GACjBL,EAAa,MAAQ,KACrBrC,GAAY,MAAQ,IACpBoD,GAAQ,MAAQ,IACjB,GAAI,EAEP,MAAMhC,GAAoB,EAE1B,MAAME,EAAc,QACf7C,EAAO,CACZ,MAAM+J,EAAgB/J,EAAgB,QAEtCsF,EAAkB,MAAQ,QAEtByE,EAAa,SAAS,oBAAoB,EACzBvE,EAAA,MAAQpD,EAAE,6BAA6B,EACjD2H,EAAa,SAAS,WAAW,EACvBvE,EAAA,MAAQpD,EAAE,qBAAqB,EACzC2H,EAAa,SAAS,UAAU,EACtBvE,EAAA,MAAQpD,EAAE,oBAAoB,EACxC2H,EAAa,SAAS,MAAM,EAClBvE,EAAA,MAAQpD,EAAE,gBAAgB,EAE3CoD,EAAiB,MAAQpD,EAAE,uBAAwB,CAAE,MAAO2H,EAAc,CAC9E,QACF,CACElF,EAAW,MAAQ,EAAA,EACvB,CAGJ,eAAejC,IAAwB,CACnC,GAAI,CAACjE,EAAY,aAAe,CAACA,EAAY,QAAS,CAClDoG,EAAc,MAAQ,GACtB,MAAA,CAGJA,EAAc,MAAQ5C,EAAiB,mBAAmBxD,EAAY,OAAO,CAAA,CAGjF,eAAekE,GAAgB,CACvB,GAAA,CAACM,EAAU,OAAS,CAACC,EAAQ,OAASD,EAAU,MAAM,SAAWC,EAAQ,MAAM,OAAQ,CACvF0B,EAAW,MAAQ,GACnB,MAAA,CAGJ,GAAI,CAACnG,EAAY,aAAe,CAACA,EAAY,QAAS,CAClDmG,EAAW,MAAQ,GACnB,MAAA,CAGA,GAAA,CAACC,EAAc,MAAO,CACtBD,EAAW,MAAQ,GACnB,MAAA,CAGA,GAAA,CACM,MAAAkF,EAAW,MAAM7H,EAAiB,YACpCgB,EAAU,MAAM,QAChBC,EAAQ,MAAM,QACd,GACJ,EAEA0B,EAAW,MAAQkF,IAAa,UACpB,CACZlF,EAAW,MAAQ,EAAA,CACvB,CAGJzB,GAAM,CAACF,EAAWC,CAAO,EAAG,SAAY,CAChCzE,EAAY,cACZiF,EAAa,MAAQ,KACFiC,EAAA,EACnB,MAAMlD,GAAoB,EAC1B,MAAME,EAAc,EACxB,CACH,EAEDQ,GAAM,IAAM1E,EAAY,YAAa,MAAOsL,GAAc,CAClDA,GACA,MAAM9H,EAAiB,aAAa,EACpC,MAAMS,GAAsB,EAC5B,MAAMD,GAAoB,EAC1B,MAAME,EAAc,IAEpBkC,EAAc,MAAQ,GACtBD,EAAW,MAAQ,GACnBlB,EAAa,MAAQ,KACzB,CACH,EAEDP,GAAM,IAAM1E,EAAY,QAAS,MAAOyF,GAAe,CAC/CA,GAAczF,EAAY,cAC1B,MAAMwD,EAAiB,aAAa,EACpC,MAAMS,GAAsB,EACZI,EAAA,MAAM,QAAiBkH,GAAA,CAC/BA,EAAM,SAAW,OACjBA,EAAM,QAAUhH,EAAO,KAAK,UAAUkB,CAAgD,GAAK8F,EAAM,QAC1FA,EAAM,SAAW,SACxBA,EAAM,QAAUhH,EAAO,KAAK,UAAUkB,CAAgD,GAAK8F,EAAM,QACrG,CACH,EACD,MAAMrH,EAAc,EACxB,CACH,EAED,eAAeF,IAAsB,CACjC,GAAI,CAAChE,EAAY,aAAe,CAACA,EAAY,QAAS,CAClD0F,EAAiB,MAAQ,IACzBC,EAAe,MAAQ,IACvB,MAAA,CAGA,GAAA,CACA,KAAM,CAAC6F,EAAaC,CAAS,EAAI,MAAM,QAAQ,IAAI,CAC/CjI,EAAiB,gBAAgBgB,EAAU,MAAO,QAASxE,EAAY,OAAO,EAC9EwD,EAAiB,gBAAgBiB,EAAQ,MAAO,QAASzE,EAAY,OAAO,CAAA,CAC/E,EAED0F,EAAiB,MAAQ8F,EACzB7F,EAAe,MAAQ8F,OACX,CACZ/F,EAAiB,MAAQ,OACzBC,EAAe,MAAQ,KAAA,CAC3B,CAGJ,SAASsD,IAAwB,CAC7BvC,EAAuB,MAAQ,EAC/BC,EAAkB,MAAQ,UAC1BC,GAAgB,MAAQ,GACxBC,EAAiB,MAAQ,GACzBC,GAAQ,MAAQ,MAAA,CAGpB,SAAS4E,IAA8B,CACnCjF,GAAqB,MAAQ,GACPwC,GAAA,CAAA,CAG1B,SAAS0C,IAAmB,CACF1C,GAAA,EACVD,GAAA,CAAA,CAGhB,OAAA4C,GAAU,SAAY,CAClB,MAAM3H,GAAsB,EAC5B,MAAMD,GAAoB,EACPkD,EAAA,EACnB,MAAMhD,EAAc,CAAA,CACvB,EAGD2H,GAAY,IAAM,CAEY7G,EAAA,EAG1BkB,EAAW,MAAQ,GACnBD,EAAe,MAAQ,GACvBM,EAAgB,MAAQ,EAAA,CAC3B,gDA9tCGuF,GAmMgBC,GAAA,CAnMA,aAAYC,EAASnI,CAAA,EAAG,gBAAemI,EAAYrI,CAAA,EAAG,gBAAeqI,EAAYpI,CAAA,EAC5F,cAAaoI,EAAUlI,CAAA,CAAA,aACxB,IA0LM,CA1LNmI,EA0LM,MA1LNC,GA0LM,CAzLFD,EAwLM,MAxLNE,GAwLM,CAtLFF,EAIM,MAJNG,GAIM,CAHFH,EAEK,KAFLI,GAEKC,EADEC,EAAE,GAAA,YAAA,CAAA,EAAA,CAAA,CAAA,GAKbN,EA8KM,MA9KNO,GA8KM,CA7KFP,EA4KM,MA5KNQ,GA4KM,CA1KFC,EAyBaC,EAAA,CAzBD,UAAU,aAAc,MAAO,IAAK,QAAQ,OAAA,GACzC,YACP,IAIM,CAJNV,EAIM,MAJNW,GAIM,CAHFF,EAEUG,EAAA,CAFD,MAAM,gBAAc,WACzB,IAAW,CAAXH,EAAWV,EAAAc,EAAA,CAAA,CAAA,uBAIvB,IAgBM,CAhBNb,EAgBM,MAhBNc,GAgBM,CAfFd,EAAyD,KAAzDe,GAAyDV,EAA3BC,EAAE,GAAA,eAAA,CAAA,EAAA,CAAA,EAChCN,EAaM,MAbNgB,GAaM,CAZFhB,EAAsC,cAA7BM,EAAE,GAAA,eAAA,CAAA,EAAA,CAAA,EACXN,EAUM,MAVNiB,GAUM,MATFC,EAGSC,GAAA,KAAAC,GAHezH,GAATf,GAAfoH,EAGS,SAAA,CAHiC,IAAKpH,EAC1C,MAAKyI,GAAA,CAAA,OAAYzH,EAAQ,QAAKhB,EAAK,EAAK,QAAK0I,IAAE1H,EAAQ,MAAGhB,GACxDyH,EAAAzH,CAAK,EAAG,KACf,GAAA2I,EAAA,QACAvB,EAIM,MAJNwB,GAIM,IAHFxB,EAC2B,QAAA,CADpB,KAAK,8CAAkBnG,GAAc,MAAAyH,GAAG,QAAO9E,GAClD,YAAY,QAAA,iBADc3C,GAAc,KAAA,CAAA,GAE5C4H,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAzB,EAAc,YAAR,IAAC,EAAA,mBAO3BA,EAmEM,MAnEN0B,GAmEM,CAlEF1B,EAgCM,MAhCN2B,GAgCM,CA/BF3B,EAEM,MAFN4B,GAEM,CADF5B,EAAsD,OAAtD6B,GAAsDxB,EAAzBC,EAAE,GAAA,WAAA,CAAA,EAAA,CAAA,CAAA,GAEnCN,EA2BM,MA3BN8B,GA2BM,CA1BF9B,EAcM,MAdN+B,GAcM,CAbF/B,EAYM,MAZNgC,GAYM,CAXFhC,EAUM,MAVNiC,GAUM,CATFxB,EAK6CyB,GAAA,YALpBjJ,EAAU,2CAAVA,EAAU,MAAAqI,GAC9B,YAAavB,EAAAoC,EAAA,EAAc1I,EAAA,KAAgB,OAAW6G,EAAE,GAAA,WAAA,EACzD,KAAK,QAAS,SAAU,EAAI,mBAAkB,GAC7C,eAAc/H,EAAS,OAAE,SACzB,SAAU0B,EAAU,OAAID,EAAc,MACtC,cAAc+B,EAAA,iEACnB0E,EAEsC2B,GAAA,YAFhB7J,EAAS,2CAATA,EAAS,MAAA+I,GAAG,OAAQlJ,EAAe,MACrD,YAAY,eAAgB,SAAU6B,EAAU,MAC/C,cAActB,oDAK/BqH,EASM,MATNqC,GASM,MARFnB,EAGYC,GAAA,KAAAC,GAHoB,CAAY,GAAA,GAAA,EAAA,EAA1B/E,GAAlBoE,EAGY6B,EAAA,CAHmC,IAAKjG,EAAY,KAAK,QAChE,QAAKiF,IAAElF,GAAqBC,CAAU,EAAI,SAAUpC,EAAU,KAAA,aAC/D,IAAgB,CAAbsI,GAAAlC,EAAAhE,CAAU,EAAG,KACpB,CAAA,CAAA,2CACAoE,EAGY6B,EAAA,CAHA,QAAO/F,GAAkB,MAAM,aAAa,KAAK,QACxD,SAAUtC,EAAU,KAAA,aACrB,IAAsB,MAAnBqG,EAAE,GAAA,YAAA,CAAA,EAAA,CAAA,CAAA,8BAOrBN,EAOM,MAPNwC,GAOM,CANF/B,EAKY6B,EAAA,CALD,OAAA,GAAQ,QAAO7F,GAAY,MAAM,qBACvC,SAAUxC,EAAU,OAAID,EAAc,KAAA,aACvC,IAEU,CAFVyG,EAEUG,EAAA,CAFD,MAAM,YAAa,8BAA8B1I,EAAgB,KAAA,MAAA,CAAA,CAAA,aACtE,IAAQ,CAARuI,EAAQV,EAAA0C,EAAA,CAAA,CAAA,8CAKpBzC,EAqBM,MArBN0C,GAqBM,CApBF1C,EAEM,MAFN2C,GAEM,CADF3C,EAAqD,OAArD4C,GAAqDvC,EAAxBC,EAAE,GAAA,UAAA,CAAA,EAAA,CAAA,CAAA,GAEnCN,EAgBM,MAhBN6C,GAgBM,CAfF7C,EAcM,MAdN8C,GAcM,CAbF9C,EAYM,MAZN+C,GAYM,CAXF/C,EAUM,MAVNgD,GAUM,CATFvC,EAK2CyB,GAAA,YALlB7I,EAAQ,2CAARA,EAAQ,MAAAiI,GAC5B,YAAavB,EAAAoC,EAAA,EAAczI,EAAA,KAAc,OAAW4G,EAAE,GAAA,WAAA,EACvD,KAAK,QAAS,SAAU,EAAI,mBAAkB,GAC7C,eAAc9H,EAAO,OAAE,SACvB,SAAUyB,EAAU,OAAID,EAAc,MACtC,cAAciC,EAAA,iEACnBwE,EAEoC2B,GAAA,YAFd5J,EAAO,2CAAPA,EAAO,MAAA8I,GAAG,OAAQlJ,EAAe,MACnD,YAAY,eAAgB,SAAU6B,EAAU,MAC/C,cAAcX,0DAS3C0G,EAgEM,MAhENiD,GAgEM,CA/DFjD,EAAuD,KAAvDkD,GAAuD7C,EAA1BC,EAAE,GAAA,cAAA,CAAA,EAAA,CAAA,EAC/BN,EA6DM,MA7DNmD,GA6DM,CA3D4BpD,EAAAhM,CAAA,EAAY,aAA1CqP,IAAAlC,EAeM,MAfNmC,GAeM,CAdFrD,EAA4C,cAAnCM,EAAE,GAAA,qBAAA,CAAA,EAAA,CAAA,EACXN,EAYO,OAZPsD,GAYO,CAXSnJ,EAAa,WAAzB+G,EAES,OAFTqC,GAESlD,EADLC,EAAE,GAAA,yBAAA,CAAA,EAAA,CAAA,IAEN8C,IAAAlC,EAOO,OAPPsC,GAOO,CANAlD,GAAAA,EAAAA,EAAAA,2BAA4B,IAC/B,CAAA,EAAAG,EAIagD,GAAA,CAJA,QAASnD,EAAE,GAAA,+BAAA,EAAmC,UAAU,KAAA,aACjE,IAEU,CAFVG,EAEUG,EAAA,CAFD,MAAM,aAAW,WACtB,IAAc,CAAdH,EAAcV,EAAA2D,EAAA,CAAA,CAAA,iDASxBvJ,EAAa,OAAI5B,EAAS,OAAIC,EAAO,OAAID,EAAS,MAAC,SAAWC,EAAO,MAAC,QADhF4K,EAAA,EAAAlC,EAeM,MAfNyC,GAeM,CAbF3D,EAAwC,cAA/BM,EAAE,GAAA,iBAAA,CAAA,EAAA,CAAA,EACXN,EAWO,OAXP4D,GAWO,CAVS1J,EAAU,WAAtBgH,EACS,OADT2C,GACSxD,EAD2CC,EAAE,GAAA,oBAAA,CAAA,EAAA,CAAA,IAEtD8C,IAAAlC,EAOO,OAPP4C,GAOO,CANAxD,GAAAA,EAAAA,EAAAA,0BAA2B,IAC9B,CAAA,EAAAG,EAIagD,GAAA,CAJA,QAASnD,EAAE,GAAA,2BAAA,EAA+B,UAAU,KAAA,aAC7D,IAEU,CAFVG,EAEUG,EAAA,CAFD,MAAM,aAAW,WACtB,IAAc,CAAdH,EAAcV,EAAA2D,EAAA,CAAA,CAAA,iDAsBlC1D,EAQM,MARN+D,GAQM,CAPF/D,EAAkC,cAAzBM,EAAE,GAAA,WAAA,CAAA,EAAA,CAAA,EACCxG,EAAY,MAAA,GAAQvB,EAAS,OAAIC,EAAO,OAApD4K,EAAA,EAAAlC,EAGoE,OAHpE8C,GACoC,KAC5B3D,EAAA9H,EAAA,MAAU,MAAM,EAAG,MACnB8H,EAAAN,EAAA/E,EAAA,EAAalB,EAAY,MAAA,CAAA,CAAA,EAAO,IAAIuG,EAAA7H,EAAA,MAAQ,MAAM,EAAA,CAAA,QAC1D0I,EACS,OADT+C,GACS5D,EADyCC,EAAE,GAAA,yBAAA,CAAA,EAAA,CAAA,SAOhEN,EAKM,MALNkE,GAKM,CAJFzD,EAGY6B,EAAA,CAHD,MAAM,gBAAgB,KAAK,UAAU,KAAK,QAAS,UAAWlH,GAAO,MAC3E,QAAO2B,EAAA,aACR,IAAyB,MAAtBH,GAAiB,CAAA,EAAA,CAAA,CAAA,kCAS5C6D,EAGuG0D,GAAA,CAH7E,QAAS3J,GAAoB,wCAApBA,GAAoB,MAAA8G,GAAG,MAAOhB,EAAE,GAAA,sBAAA,EAC9D,MAAOxF,GAAgB,MAAG,eAAcL,EAAsB,MAAG,OAAQC,EAAiB,MAC1F,sBAAqBK,GAAkB,MAAG,WAAUF,GAAO,MAAG,mBAAkBF,GAAe,MAC/F,gBAAeC,EAAgB,MAAG,QAAO6E,GAA8B,QAAOC","x_google_ignoreList":[0]}