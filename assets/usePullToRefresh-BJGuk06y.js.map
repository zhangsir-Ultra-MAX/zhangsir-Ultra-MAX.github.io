{"version":3,"file":"usePullToRefresh-BJGuk06y.js","sources":["../../src/components/common/PullToRefresh.vue","../../src/composables/usePullToRefresh.ts"],"sourcesContent":["<template>\r\n  <div class=\"pull-to-refresh-container\">\r\n    <!-- 下拉刷新指示器 -->\r\n    <div \r\n      v-if=\"isPulling || isRefreshing\"\r\n      class=\"pull-indicator\"\r\n      :style=\"{ \r\n        opacity: Math.min(pullDistance / 60, 1),\r\n        transform: `translateX(-50%) scale(${Math.min(pullDistance / 60, 1)})`\r\n      }\"\r\n    >\r\n      <div class=\"indicator-content\">\r\n        <div \r\n          v-if=\"!isRefreshing\"\r\n          class=\"pull-icon\"\r\n          :class=\"{ 'can-refresh': canRefresh }\"\r\n        >\r\n          <svg \r\n            class=\"refresh-arrow\" \r\n            :class=\"{ 'rotate-180': canRefresh }\"\r\n            width=\"32\" \r\n            height=\"32\" \r\n            viewBox=\"0 0 24 24\" \r\n            fill=\"none\" \r\n            stroke=\"currentColor\" \r\n            stroke-width=\"2\" \r\n            stroke-linecap=\"round\" \r\n            stroke-linejoin=\"round\"\r\n          >\r\n            <path d=\"M12 5v14M5 12l7-7 7 7\" />\r\n          </svg>\r\n        </div>\r\n        <div v-else class=\"loading-spinner\">\r\n          <svg \r\n            class=\"animate-spin\" \r\n            width=\"32\" \r\n            height=\"32\" \r\n            viewBox=\"0 0 24 24\" \r\n            fill=\"none\" \r\n            stroke=\"currentColor\" \r\n            stroke-width=\"2\" \r\n            stroke-linecap=\"round\" \r\n            stroke-linejoin=\"round\"\r\n          >\r\n            <path d=\"M21 12a9 9 0 11-6.219-8.56\" />\r\n          </svg>\r\n        </div>\r\n        <!-- 隐藏文案显示 -->\r\n        <!-- <div class=\"indicator-text\">\r\n          <span v-if=\"!isRefreshing && !canRefresh\">{{ $t('common.pullToRefresh') }}</span>\r\n          <span v-else-if=\"!isRefreshing && canRefresh\">{{ $t('common.releaseToRefresh') }}</span>\r\n          <span v-else>{{ $t('common.refreshing') }}</span>\r\n        </div> -->\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- 页面内容 -->\r\n    <div class=\"content-wrapper\">\r\n      <slot />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\ninterface Props {\r\n  isPulling: boolean\r\n  isRefreshing: boolean\r\n  pullDistance: number\r\n  canRefresh: boolean\r\n}\r\n\r\ndefineProps<Props>()\r\n</script>\r\n\r\n<style scoped>\r\n.pull-to-refresh-container {\r\n  position: relative;\r\n  min-height: 100vh;\r\n}\r\n\r\n.pull-indicator {\r\n  position: fixed;\r\n  top: calc(20px + 2rem);\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  z-index: 50;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  width: 60px;\r\n  height: 60px;\r\n  background-color: rgba(255, 255, 255, 0.95);\r\n  border-radius: 50%;\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n  backdrop-filter: blur(10px);\r\n  transition: all 0.3s ease-out;\r\n}\r\n\r\n@media (prefers-color-scheme: dark) {\r\n  .pull-indicator {\r\n    background-color: rgba(31, 41, 55, 0.95);\r\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\r\n  }\r\n}\r\n\r\n.dark .pull-indicator {\r\n  background-color: rgba(31, 41, 55, 0.95);\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\r\n}\r\n\r\n.indicator-content {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 4px;\r\n  color: #6b7280;\r\n}\r\n\r\n@media (prefers-color-scheme: dark) {\r\n  .indicator-content {\r\n    color: #9ca3af;\r\n  }\r\n}\r\n\r\n.dark .indicator-content {\r\n  color: #9ca3af;\r\n}\r\n\r\n.pull-icon {\r\n  transition: all 0.3s ease-out;\r\n  color: #9ca3af;\r\n}\r\n\r\n.pull-icon.can-refresh {\r\n  color: #3b82f6;\r\n  transform: scale(1.1);\r\n}\r\n\r\n@media (prefers-color-scheme: dark) {\r\n  .pull-icon {\r\n    color: #6b7280;\r\n  }\r\n  .pull-icon.can-refresh {\r\n    color: #60a5fa;\r\n  }\r\n}\r\n\r\n.dark .pull-icon {\r\n  color: #6b7280;\r\n}\r\n\r\n.dark .pull-icon.can-refresh {\r\n  color: #60a5fa;\r\n}\r\n\r\n.refresh-arrow {\r\n  transition: transform 0.3s ease-out;\r\n}\r\n\r\n.refresh-arrow.rotate-180 {\r\n  transform: rotate(180deg);\r\n}\r\n\r\n.loading-spinner {\r\n  color: #3b82f6;\r\n}\r\n\r\n@media (prefers-color-scheme: dark) {\r\n  .loading-spinner {\r\n    color: #60a5fa;\r\n  }\r\n}\r\n\r\n.dark .loading-spinner {\r\n  color: #60a5fa;\r\n}\r\n\r\n.indicator-text {\r\n  font-size: 10px;\r\n  font-weight: 500;\r\n  text-align: center;\r\n  transition: color 0.3s;\r\n  white-space: nowrap;\r\n}\r\n\r\n.content-wrapper {\r\n  position: relative;\r\n  z-index: 10;\r\n}\r\n\r\n/* 动画 */\r\n@keyframes spin {\r\n  from {\r\n    transform: rotate(0deg);\r\n  }\r\n  to {\r\n    transform: rotate(360deg);\r\n  }\r\n}\r\n\r\n.animate-spin {\r\n  animation: spin 1s linear infinite;\r\n}\r\n\r\n/* 响应式调整 */\r\n@media (max-width: 640px) {\r\n  .pull-indicator {\r\n    width: 50px;\r\n    height: 50px;\r\n    top: calc(15px + 2rem);\r\n  }\r\n  \r\n  .indicator-content {\r\n    gap: 2px;\r\n  }\r\n  \r\n  .indicator-text {\r\n    font-size: 8px;\r\n  }\r\n  \r\n  .pull-icon svg,\r\n  .loading-spinner svg {\r\n    width: 28px;\r\n    height: 28px;\r\n  }\r\n}\r\n</style>","import { ref, onMounted, onUnmounted } from 'vue'\r\n\r\ninterface PullToRefreshOptions {\r\n  onRefresh: () => Promise<void>\r\n  threshold?: number\r\n  resistance?: number\r\n  enabled?: boolean\r\n}\r\n\r\nexport function usePullToRefresh(options: PullToRefreshOptions) {\r\n  const {\r\n    onRefresh,\r\n    threshold = 80,\r\n    resistance = 2.5,\r\n    enabled = true\r\n  } = options\r\n\r\n  const isRefreshing = ref(false)\r\n  const pullDistance = ref(0)\r\n  const isPulling = ref(false)\r\n  const canRefresh = ref(false)\r\n\r\n  let startY = 0\r\n  let currentY = 0\r\n  let isScrollAtTop = false\r\n\r\n  // 检查是否启用下拉刷新\r\n  const isPullToRefreshEnabled = () => {\r\n    return enabled\r\n  }\r\n\r\n  // 检查是否在页面顶部\r\n  const checkScrollPosition = () => {\r\n    isScrollAtTop = window.scrollY === 0 || document.documentElement.scrollTop === 0\r\n  }\r\n\r\n  // 触摸开始\r\n  const handleTouchStart = (e: TouchEvent) => {\r\n    if (!isPullToRefreshEnabled() || isRefreshing.value) return\r\n    \r\n    checkScrollPosition()\r\n    if (!isScrollAtTop) return\r\n\r\n    startY = e.touches[0].clientY\r\n    isPulling.value = false\r\n    pullDistance.value = 0\r\n    canRefresh.value = false\r\n  }\r\n\r\n  // 触摸移动\r\n  const handleTouchMove = (e: TouchEvent) => {\r\n    if (!isPullToRefreshEnabled() || isRefreshing.value || !isScrollAtTop) return\r\n\r\n    currentY = e.touches[0].clientY\r\n    const deltaY = currentY - startY\r\n\r\n    if (deltaY > 0) {\r\n      // 向下拉动\r\n      isPulling.value = true\r\n      pullDistance.value = Math.min(deltaY / resistance, threshold * 1.5)\r\n      canRefresh.value = pullDistance.value >= threshold\r\n\r\n      // 只在事件可取消且满足条件时阻止默认滚动行为\r\n      if (deltaY > 10 && e.cancelable) {\r\n        e.preventDefault()\r\n      }\r\n    }\r\n  }\r\n\r\n  // 触摸结束\r\n  const handleTouchEnd = async () => {\r\n    if (!isPullToRefreshEnabled() || isRefreshing.value) return\r\n\r\n    if (canRefresh.value && isPulling.value) {\r\n      isRefreshing.value = true\r\n      pullDistance.value = threshold\r\n      \r\n      try {\r\n        await onRefresh()\r\n      } catch (error) {\r\n        console.error('Refresh failed:', error)\r\n      } finally {\r\n        // 延迟重置状态，让用户看到刷新完成的反馈\r\n        setTimeout(() => {\r\n          isRefreshing.value = false\r\n          isPulling.value = false\r\n          pullDistance.value = 0\r\n          canRefresh.value = false\r\n        }, 500)\r\n      }\r\n    } else {\r\n      // 重置状态\r\n      isPulling.value = false\r\n      pullDistance.value = 0\r\n      canRefresh.value = false\r\n    }\r\n  }\r\n\r\n  // 鼠标事件（用于桌面端测试）\r\n  const handleMouseDown = (e: MouseEvent) => {\r\n    if (!isPullToRefreshEnabled() || isRefreshing.value) return\r\n    \r\n    checkScrollPosition()\r\n    if (!isScrollAtTop) return\r\n\r\n    startY = e.clientY\r\n    isPulling.value = false\r\n    pullDistance.value = 0\r\n    canRefresh.value = false\r\n  }\r\n\r\n  const handleMouseMove = (e: MouseEvent) => {\r\n    if (!isPullToRefreshEnabled() || isRefreshing.value || !isScrollAtTop) return\r\n    if (!(e.buttons & 1)) return // 只在按下鼠标左键时处理\r\n\r\n    currentY = e.clientY\r\n    const deltaY = currentY - startY\r\n\r\n    if (deltaY > 0) {\r\n      isPulling.value = true\r\n      pullDistance.value = Math.min(deltaY / resistance, threshold * 1.5)\r\n      canRefresh.value = pullDistance.value >= threshold\r\n    }\r\n  }\r\n\r\n  const handleMouseUp = async () => {\r\n    if (!isPullToRefreshEnabled() || isRefreshing.value) return\r\n\r\n    if (canRefresh.value && isPulling.value) {\r\n      isRefreshing.value = true\r\n      pullDistance.value = threshold\r\n      \r\n      try {\r\n        await onRefresh()\r\n      } catch (error) {\r\n        console.error('Refresh failed:', error)\r\n      } finally {\r\n        setTimeout(() => {\r\n          isRefreshing.value = false\r\n          isPulling.value = false\r\n          pullDistance.value = 0\r\n          canRefresh.value = false\r\n        }, 500)\r\n      }\r\n    } else {\r\n      isPulling.value = false\r\n      pullDistance.value = 0\r\n      canRefresh.value = false\r\n    }\r\n  }\r\n\r\n  // 绑定事件监听器\r\n  onMounted(() => {\r\n    if (!isPullToRefreshEnabled()) return\r\n\r\n    // 触摸事件\r\n    document.addEventListener('touchstart', handleTouchStart, { passive: false })\r\n    document.addEventListener('touchmove', handleTouchMove, { passive: false })\r\n    document.addEventListener('touchend', handleTouchEnd)\r\n\r\n    // 鼠标事件（用于桌面端测试）\r\n    document.addEventListener('mousedown', handleMouseDown)\r\n    document.addEventListener('mousemove', handleMouseMove)\r\n    document.addEventListener('mouseup', handleMouseUp)\r\n\r\n    // 滚动事件\r\n    window.addEventListener('scroll', checkScrollPosition)\r\n  })\r\n\r\n  // 清理事件监听器\r\n  onUnmounted(() => {\r\n    document.removeEventListener('touchstart', handleTouchStart)\r\n    document.removeEventListener('touchmove', handleTouchMove)\r\n    document.removeEventListener('touchend', handleTouchEnd)\r\n    document.removeEventListener('mousedown', handleMouseDown)\r\n    document.removeEventListener('mousemove', handleMouseMove)\r\n    document.removeEventListener('mouseup', handleMouseUp)\r\n    window.removeEventListener('scroll', checkScrollPosition)\r\n  })\r\n\r\n  return {\r\n    isRefreshing,\r\n    pullDistance,\r\n    isPulling,\r\n    canRefresh,\r\n    isPullToRefreshEnabled\r\n  }\r\n}"],"names":["_openBlock","_createElementBlock","_hoisted_1","isPulling","isRefreshing","_normalizeStyle","pullDistance","_createElementVNode","_hoisted_2","_hoisted_3","_cache","_normalizeClass","canRefresh","_hoisted_4","_renderSlot","_ctx","usePullToRefresh","options","onRefresh","threshold","resistance","enabled","ref","startY","currentY","isScrollAtTop","isPullToRefreshEnabled","checkScrollPosition","handleTouchStart","handleTouchMove","deltaY","handleTouchEnd","error","handleMouseDown","handleMouseMove","handleMouseUp","onMounted","onUnmounted"],"mappings":"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"}