import{R as J,r as a,c as w,S as o,I as r,a as I,U as K,O as V}from"./index-EBZBD7IP.js";import{c as u}from"./contracts-LobIsjLE.js";const tt=J("savings",()=>{const i=a("0"),f=a("0"),p=a("0"),S=a("1.0"),h=a("0.14"),l=a("0"),g=a("0"),v=a("0"),y=a("0"),B=a("0"),A=a("0"),F=a("0"),d=a(!1),x=a(0),U=a([]),D=a(""),N=a(""),W=a(!1),b=a(!1),T=w(()=>new o(r(i.value,18)).toFixed(6)),_=w(()=>new o(r(f.value,18)).toFixed(6)),O=w(()=>new o(p.value).toFixed(2)),Y=w(()=>l.value==="0"||i.value==="0"?"0":new o(i.value).dividedBy(l.value).multipliedBy(100).toFixed(4)),M=async()=>{const e=I();if(K(),!!e.isConnected)try{d.value=!0;const t=await u.getSavingsVaultContract();if(!t)throw new Error("Contract not available");const[n,s,m,j,k,q,z]=await Promise.all([t.totalAssets(),t.totalSupply(),t.totalMMFSupply(),t.getNAV_sWRMB(),t.maxWithdraw(e.address),t.getCurrentYearNAVSummary(),t.getUserIncrementAmount(e.address)]);p.value=r(n.toString(),18),l.value=r(s.toString(),18),g.value=r(m.toString(),18),A.value=r(k.toString(),18),F.value=r(z.toString(),18),S.value=r(j,18),v.value=new o(r(q.lastIncrease,16)).multipliedBy(365).toString();const G=new o(l.value).gt(0)?l.value:"1",C=new o(v.value).multipliedBy(g.value).dividedBy(G);y.value=C.gt(0)?C.toString():"0";const H=new o(v.value).multipliedBy(g.value);B.value=H.dividedBy(100).toString(),await R(),e.address&&await P()}catch(t){console.error("Failed to fetch vault data:",t)}finally{d.value=!1}},P=async()=>{const e=I();if(e.address)try{const[t,n]=await Promise.all([u.getSavingsVaultContract(),u.getWRMBContract()]);if(!t||!n)return;const[s,m]=await Promise.all([t.balanceOf(e.address),n.balanceOf(e.address)]);i.value=r(s,18),f.value=r(m,18)}catch(t){console.error("Failed to fetch user balances:",t)}},E=async e=>{if(!e||e==="0")return{shares:"0",fee:"0"};try{const t=await u.getSavingsVaultContract();if(!t)throw new Error("Contract not available");const n=V(e,18),s=await t.previewDeposit(n);return{shares:r(s,18),fee:"0"}}catch(t){return console.error("Failed to preview deposit:",t),{shares:"0",fee:"0"}}},L=async e=>{if(!e||e==="0")return{shares:"0",assets:"0",fee:"0"};try{const t=await u.getSavingsVaultContract();if(!t)throw new Error("Contract not available");const n=V(e,18),s=await t.previewWithdrawOfFee(n);return{shares:r(s[0],18),assets:r(s[1],18),fee:r(s[2],18)}}catch(t){return console.error("Failed to preview withdraw:",t),{shares:"0",assets:"0",fee:"0"}}},R=async()=>{try{const t=(Math.random()-.5)*.02;h.value=(.14+t).toFixed(4)}catch(e){console.error("Failed to fetch WRMB price:",e),h.value="0.14"}};let c=null;return{userBalance:i,wrmbBalance:f,totalAssets:p,currentNAV:S,currentPrice:h,totalSupply:l,apy:v,dynamicAPY:y,dynamicWRMB:B,userIncrementAmount:F,isLoading:d,depositAmount:D,withdrawAmount:N,isDepositing:W,isWithdrawing:b,historicalNAV:U,userBalanceFormatted:T,wrmbBalanceFormatted:_,totalAssetsFormatted:O,userSharePercentage:Y,userAssetValue:A,fetchVaultData:M,fetchUserBalances:P,fetchWRMBPrice:R,previewDeposit:E,previewWithdraw:L,startAutoRefresh:()=>{c&&clearInterval(c),c=setInterval(()=>{Date.now()-x.value>12e3&&M()},12e3)},stopAutoRefresh:()=>{c&&(clearInterval(c),c=null)},get depositInProgress(){return W.value},get withdrawInProgress(){return b.value},get loading(){return d.value}}});export{tt as u};
//# sourceMappingURL=savings-BnhwmOt9.js.map
