import{R as fe,r as o,c as y,S as ae,I as S,a as oe,d as he,u as we,a3 as z,w as te,o as ge,x as N,g as m,e as b,f as t,t as u,h as i,ag as _e,N as be,L as Fe,G as K,F as re,y as ce,M as Ce,j as R,ah as ye,T as Ae,O as ue,P as se,J as U,_ as Te}from"./index-EBZBD7IP.js";import{A as De}from"./AnimatedNumber-DMAocXSA.js";/* empty css                    */import{T as de}from"./TokenSelect-BWpZZm0S.js";import{u as Se,P as Ie}from"./usePullToRefresh-BJGuk06y.js";import{F as me}from"./FormattedInput-DGcZDhfq.js";import{c as x}from"./contracts-LobIsjLE.js";import{f as $,b as ve}from"./format-DgO97vlP.js";/* empty css               *//* empty css                  *//* empty css                 */const ke=fe("farm",()=>{const j=o("0"),r=o("0"),v=o("0"),a=o("0"),O=o("0"),E=o("0"),P=o("0"),G=o("1.0"),M=o("10.0"),A=o("0.001"),p=o("0.002"),d=o(0),f=o(0),F=o(!1),C=o(0),I=o(!1),W=o(!1),g=o(!1),h=y(()=>new ae(S(v.value,6)).toFixed(2)),k=y(()=>new ae(S(a.value,6)).toFixed(2)),V=async()=>{const _=oe();if(_.isConnected)try{F.value=!0;const c=x.getFarmVaultContract();if(!c)throw new Error("Farm Vault contract not available");const[D,q,J,le,Q,Y]=await Promise.all([c.totalSupply(),c.rewardRate(),c.getRewardForDuration(),c.getRemainingTime(),c.earned(_.address),c.balanceOf(_.address)]);if(j.value=S(D,6),P.value=S(q,18),O.value=S(Q,18),r.value=new ae(P.value).multipliedBy(Y).dividedBy(D).toFixed(18),D>0){const X=parseFloat(P.value)*365*24*60*60,Z=parseFloat(S(D,6));E.value=(X/Z*100).toFixed(2)}else E.value="0";_.address&&await L(),C.value=Date.now()}catch(c){console.error("Failed to fetch farm data:",c)}finally{F.value=!1}},L=async()=>{const _=oe();if(_.address)try{const c=x.getUSDTContract();if(!c)throw new Error("USDT contract not available");const[D,q]=await Promise.all([c.balanceOf(_.address),x.getFarmVaultContract()?.balanceOf(_.address)]);v.value=S(D,6),a.value=S(q,6)}catch(c){console.error("Failed to fetch user farm data:",c)}};let T=null;return{liquidityAmount:j,incrementAmount:r,usdtBalance:v,depositedAmount:a,pendingCINA:O,farmAPY:E,farmRate:P,exchangeRate:G,minDepositAmount:M,depositFee:A,withdrawalFee:p,lastClaimTime:d,depositTime:f,isLoading:F,depositInProgress:I,claimInProgress:W,withdrawInProgress:g,usdtBalanceFormatted:h,depositedAmountFormatted:k,fetchFarmData:V,fetchUserFarmData:L,startAutoRefresh:()=>{T&&clearInterval(T),T=setInterval(()=>{Date.now()-C.value>15e3&&V()},15e3)},stopAutoRefresh:()=>{T&&(clearInterval(T),T=null)},get loading(){return F.value}}}),Ve={class:"farm"},Ne={class:"farm-content"},Re={class:"farm-overview"},Ue={class:"section-title"},$e={class:"overview-grid"},Pe={class:"overview-card"},Be={class:"card-header"},xe={class:"card-title"},Ee={class:"card-subtitle"},Me={class:"card-value"},We={class:"action-section"},qe={class:"tab-content"},ze={class:"action-form"},Oe={class:"input-section"},Le={class:"input-group"},Ye={class:"input-with-select"},Ke={class:"quick-amounts"},je={key:0,class:"preview-section"},Ge={class:"preview-title"},He={class:"preview-details"},Je={class:"preview-row"},Qe={class:"preview-value"},Xe={class:"tab-content"},Ze={class:"action-form"},ea={class:"input-section"},aa={class:"input-group"},ta={class:"input-with-select"},sa={class:"quick-amounts"},oa={class:"input-group"},na={key:0,class:"preview-section"},la={class:"preview-title"},ia={class:"preview-details"},ra={key:0,class:"preview-row"},ca={class:"preview-value liquidity-value"},ua={key:1,class:"preview-row"},da={class:"preview-value"},ma=he({__name:"Farm",setup(j){const{t:r}=we(),v=oe(),a=ke(),{isRefreshing:O,pullDistance:E,isPulling:P,canRefresh:G}=Se({onRefresh:async()=>{v.isConnected&&(await a.fetchFarmData(),await a.fetchUserFarmData())}}),M=y(()=>{const e=v.chainId||11155111;return[{symbol:z.USDT.symbol,name:z.USDT.name,address:z.USDT.addresses[e]||z.USDT.addresses[11155111]||"0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238",decimals:z.USDT.decimals}]}),A=o("deposit"),p=o(""),d=o(""),f=o(!1),F=o(),C=o(),I=o(!1),W=o(""),g=o(0),h=o("pending"),k=o(""),V=o(""),L=o([{label:r("transaction.approve"),description:r("transaction.approveDescription")},{label:r("transaction.confirm"),description:r("transaction.confirmDescription")},{label:r("transaction.complete"),description:r("transaction.completeDescription")}]),T=y(()=>{const e=[];return A.value==="deposit"&&p.value?e.push({label:r("pay"),value:`-${$(p.value,2)} USDT`,highlight:!0,type:"debit"}):A.value==="withdraw"&&(d.value&&e.push({label:r("receive"),value:`+${$(d.value,2)} USDT`,highlight:!0,type:"credit"}),f.value&&parseFloat(a.pendingCINA)>0&&e.push({label:r("receive"),value:`+${$(a.pendingCINA,6)} CINA`,type:"credit"})),e});te(M,e=>{e.length>=1&&((!F.value||F.value.symbol!==e[0].symbol)&&(F.value=e[0]),(!C.value||C.value.symbol!==e[0].symbol)&&(C.value=e[0]))},{immediate:!0});const H=y(()=>{const e=parseFloat(p.value);return e>0&&e<=parseFloat(a.usdtBalance)});y(()=>parseFloat(a.pendingCINA)>0);const ne=y(()=>{const e=parseFloat(d.value);return f.value&&(!d.value||e===0)?parseFloat(a.pendingCINA)>0:e>0&&e<=parseFloat(a.depositedAmount)}),_=y(()=>{const e=parseFloat(p.value);if(!e||e<=0)return null;const s=parseFloat(a.exchangeRate),l=e*s,w=l*parseFloat(a.farmAPY)/365/100;return{estimatedCINA:l,dailyReward:w}}),c=y(()=>{const e=parseFloat(d.value);return!e||e<=0?null:{rewardAmount:a.pendingCINA,liquidityAmount:a.liquidityAmount}}),D=e=>{const l=(parseFloat(a.usdtBalance)*e/100).toFixed(6);p.value=l},q=()=>{p.value=a.usdtBalance},J=async()=>{if(!(!H.value||!v.isConnected)){W.value=r("savings.depositTransaction"),I.value=!0,g.value=0,h.value="pending";try{const e=parseFloat(p.value),s=ue(e.toString(),6);h.value="loading";const l=x.getUSDTContract(!0),w=x.getFarmVaultContract(!0);if(!l||!w)throw new Error("Contract not available");const B=await w.getAddress();await l.allowance(v.address,B)<s&&await(await l.approve(B,s)).wait(),g.value=1;const n=await w.deposit(s);g.value=2;const ee=await n.wait();k.value=ee.hash,g.value=3,h.value="success",p.value="",await a.fetchFarmData(),await a.fetchUserFarmData(),se.success(r("farm.depositSuccess"))}catch(e){h.value="error",V.value=e.message||r("farm.depositFailed"),console.error("Deposit failed:",e)}}},le=e=>{const l=(parseFloat(a.depositedAmount)*e/100).toFixed(6);d.value=l},Q=()=>{d.value=a.depositedAmount},Y=async()=>{if(v.isConnected){W.value=r("savings.withdrawTransaction"),I.value=!0,g.value=1,h.value="pending";try{const e=parseFloat(d.value);h.value="loading";const s=x.getFarmVaultContract(!0);if(!s)throw new Error("Farm contract not available");if(f.value&&(!d.value||e===0)){if(parseFloat(a.pendingCINA)>0){const l=await s.getReward();g.value=2;const w=await l.wait();k.value=w.hash,h.value="success",se.success(r("farm.claimSuccess"))}}else{const l=ue(e.toString(),6),w=await s.withdraw(l,f.value?1:0);g.value=2;const B=await w.wait();k.value=B.hash,h.value="success",se.success(r("farm.withdrawSuccess"))}g.value=3,d.value="",f.value=!1,await a.fetchFarmData(),await a.fetchUserFarmData()}catch(e){h.value="error",V.value=e.message||r("farm.withdrawFailed"),console.error("Withdraw failed:",e)}}},X=()=>{I.value=!1,k.value="",V.value=""},Z=()=>{A.value==="deposit"?J():Y()},pe=async()=>{v.isConnected&&await a.fetchFarmData()};return ge(async()=>{v.isConnected&&await a.fetchFarmData()}),te(()=>v.isConnected,async e=>{e&&await a.fetchFarmData()}),te(A,e=>{p.value="",d.value=""}),(e,s)=>{const l=Ce,w=Fe,B=ye,ie=be;return U(),N("div",Ve,[m(Ie,{"is-pulling":i(P),"is-refreshing":i(O),"pull-distance":i(E),"can-refresh":i(G)},{default:b(()=>[t("div",Ne,[t("div",Re,[t("h2",Ue,u(e.$t("farm.overview")),1),t("div",$e,[t("div",Pe,[t("div",Be,[t("h3",xe,u(e.$t("farm.yourMined")),1),t("div",Ee,u(e.$t("farm.apy"))+" "+u(i($)(i(a).farmAPY))+"% ",1)]),t("div",Me,[s[7]||(s[7]=t("img",{src:_e,alt:"",class:"token-icon"},null,-1)),m(De,{class:"animated-number",value:i(a).pendingCINA,decimals:8,"auto-increment":i(v).isConnected,"increment-amount":parseFloat(i(a).incrementAmount),"increment-interval":1e3,"cache-key":`totalCINAMined_${i(v).address}`,"use-cache":!1},null,8,["value","auto-increment","increment-amount","cache-key"])])])])]),t("div",We,[m(ie,{modelValue:A.value,"onUpdate:modelValue":s[5]||(s[5]=n=>A.value=n),class:"farm-tabs"},{default:b(()=>[m(w,{label:e.$t("farm.deposit"),name:"deposit"},{default:b(()=>[t("div",qe,[t("div",ze,[t("div",Oe,[t("div",Le,[t("div",Ye,[m(me,{modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=n=>p.value=n),placeholder:i(ve)(i(a).usdtBalance)+"  "+e.$t("available"),size:"large",class:"amount-input",decimals:6,"use-abbreviation":!0},null,8,["modelValue","placeholder"]),m(de,{modelValue:F.value,"onUpdate:modelValue":s[1]||(s[1]=n=>F.value=n),tokens:M.value,placeholder:"Select token"},null,8,["modelValue","tokens"])])]),t("div",Ke,[(U(),N(re,null,ce([25,50,75],n=>m(l,{key:n,size:"small",onClick:ee=>D(n)},{default:b(()=>[R(u(n)+"% ",1)]),_:2},1032,["onClick"])),64)),m(l,{onClick:q,class:"max-button",size:"small"},{default:b(()=>[R(u(e.$t("common.max")),1)]),_:1})])]),_.value?(U(),N("div",je,[t("h4",Ge,u(e.$t("farm.preview")),1),t("div",He,[t("div",Je,[t("span",null,u(e.$t("farm.dailyReward")),1),t("span",Qe,u(i($)(_.value.dailyReward,2))+" CINA",1)])])])):K("",!0),m(l,{type:"primary",size:"large",loading:i(a).depositInProgress,disabled:!H.value,onClick:J,class:"action-button"},{default:b(()=>[R(u(e.$t("farm.deposit")),1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["label"]),m(w,{label:e.$t("farm.withdraw"),name:"withdraw"},{default:b(()=>[t("div",Xe,[t("div",Ze,[t("div",ea,[t("div",aa,[t("div",ta,[m(me,{modelValue:d.value,"onUpdate:modelValue":s[2]||(s[2]=n=>d.value=n),placeholder:i(ve)(i(a).depositedAmount)+"  "+e.$t("available"),size:"large",class:"amount-input",decimals:6,"use-abbreviation":!0},null,8,["modelValue","placeholder"]),m(de,{modelValue:C.value,"onUpdate:modelValue":s[3]||(s[3]=n=>C.value=n),tokens:M.value,placeholder:"Select token"},null,8,["modelValue","tokens"])])]),t("div",sa,[(U(),N(re,null,ce([25,50,75],n=>m(l,{key:n,size:"small",onClick:ee=>le(n)},{default:b(()=>[R(u(n)+"% ",1)]),_:2},1032,["onClick"])),64)),m(l,{onClick:Q,class:"max-button",size:"small"},{default:b(()=>[R(u(e.$t("common.max")),1)]),_:1})]),t("div",oa,[m(B,{modelValue:f.value,"onUpdate:modelValue":s[4]||(s[4]=n=>f.value=n),class:"withdraw-cina-checkbox",onChange:pe},{default:b(()=>[R(u(e.$t("farm.withdrawCINA")),1)]),_:1},8,["modelValue"])])]),c.value||f.value?(U(),N("div",na,[t("h4",la,u(e.$t("farm.preview")),1),t("div",ia,[c.value?(U(),N("div",ra,[s[8]||(s[8]=t("span",null,"Liquidity",-1)),t("span",ca,u(i($)(c.value.liquidityAmount,2))+" "+u(C.value?.symbol),1)])):K("",!0),f.value?(U(),N("div",ua,[s[9]||(s[9]=t("span",null,"Farm Reward",-1)),t("span",da,u(i($)(i(a).pendingCINA,2))+" CINA",1)])):K("",!0)])])):K("",!0),m(l,{type:"primary",size:"large",loading:i(a).withdrawInProgress||i(a).claimInProgress,disabled:!ne.value,onClick:Y,class:"action-button"},{default:b(()=>[R(u(f.value&&(!d.value||parseFloat(d.value)===0)?e.$t("farm.claim"):e.$t("farm.withdraw")),1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["label"])]),_:1},8,["modelValue"])])])]),_:1},8,["is-pulling","is-refreshing","pull-distance","can-refresh"]),m(Ae,{visible:I.value,"onUpdate:visible":s[6]||(s[6]=n=>I.value=n),title:W.value,steps:L.value,"current-step":g.value,status:h.value,"transaction-details":T.value,"transaction-hash":k.value,"error-message":V.value,onClose:X,onRetry:Z},null,8,["visible","title","steps","current-step","status","transaction-details","transaction-hash","error-message"])])}}}),Ta=Te(ma,[["__scopeId","data-v-22109efb"]]);export{Ta as default};
//# sourceMappingURL=Farm-CBZcT6l5.js.map
