import{d as Ue,u as Me,a as Ne,r,c as J,w as oe,o as ke,b as K,e as m,f as s,g as c,t,h as i,p as Ie,E as Oe,H as ne,i as ze,q as Ee,x as M,G as ie,ac as Ve,j as R,M as We,y as le,F as re,ad as Le,ae as xe,T as qe,P as D,I as h,J as S,n as He,af as je,A as Ge,O as N,_ as Je}from"./index-EBZBD7IP.js";/* empty css               *//* empty css                  *//* empty css                 */import{u as Ke,P as Qe}from"./usePullToRefresh-BJGuk06y.js";import{f as v,d as Q}from"./format-DgO97vlP.js";import{d as Xe}from"./debounce-CLGozXK5.js";import{c as g}from"./contracts-LobIsjLE.js";const Ye={class:"bonds"},Ze={class:"bonds-content"},es={class:"pool-overview"},ss={class:"section-title"},ts={class:"overview-grid"},as={class:"overview-card"},os={class:"card-header"},ns={class:"card-title"},is={class:"card-value"},ls={class:"card-subtitle"},rs={class:"overview-card"},cs={class:"card-header"},ds={class:"card-title"},us={class:"card-value"},vs={class:"card-subtitle"},ps={class:"overview-card highlight"},ms={class:"card-header"},_s={class:"card-title"},hs={class:"card-value"},bs={class:"card-subtitle"},fs={class:"overview-card"},ws={class:"card-header"},gs={class:"card-title"},ys={class:"card-value"},Bs={class:"card-subtitle"},Ss={class:"subscription-section"},$s={class:"section-header"},Cs={class:"section-title"},Ts={class:"subscription-card"},Rs={class:"subscription-form"},Ds={class:"form-header"},As={class:"form-title"},Fs={class:"balance-info"},Ps={class:"balance-label"},Us={class:"balance-value"},Ms={class:"input-section"},Ns={class:"input-group"},ks={class:"quick-amounts"},Is={class:"bond-terms"},Os={class:"terms-title"},zs={class:"terms-grid"},Es={class:"term-item"},Vs={class:"term-label"},Ws={class:"term-value"},Ls={class:"term-item"},xs={class:"term-label"},qs={class:"term-value"},Hs={class:"term-item"},js={class:"term-label"},Gs={class:"term-value"},Js={class:"term-item"},Ks={class:"term-label"},Qs={class:"term-value"},Xs={key:0,class:"preview-section"},Ys={class:"preview-title"},Zs={class:"preview-details"},et={class:"preview-row"},st={class:"preview-value"},tt={class:"preview-row"},at={class:"preview-value"},ot={class:"preview-row"},nt={class:"preview-value"},it={class:"preview-row"},lt={class:"preview-value highlight"},rt={class:"user-bonds-section"},ct={class:"section-header"},dt={class:"section-title"},ut={class:"bonds-filter"},vt={class:"bonds-list"},pt={key:0,class:"empty-state"},mt={class:"text-gray-500 dark:text-gray-400"},_t={class:"bond-header"},ht={class:"bond-id"},bt={class:"id-label"},ft={class:"id-value"},wt={class:"bond-status"},gt={class:"bond-details"},yt={class:"detail-grid"},Bt={class:"detail-item"},St={class:"detail-label"},$t={class:"detail-value"},Ct={class:"detail-item"},Tt={class:"detail-label"},Rt={class:"detail-value"},Dt={class:"detail-item"},At={class:"detail-label"},Ft={class:"detail-value"},Pt={class:"detail-item"},Ut={class:"detail-label"},Mt={class:"detail-value"},Nt={class:"detail-item"},kt={class:"detail-label"},It={class:"detail-value"},Ot={class:"detail-item"},zt={class:"detail-label"},Et={class:"detail-value highlight"},Vt={class:"bond-actions"},Wt={class:"progress-info"},Lt={class:"progress-bar"},xt={class:"progress-text"},qt=Ue({__name:"Bonds",setup(Ht){const{t:l}=Me(),p=Ne(),X=r(!1),_=r(""),f=r(null),O=r(!1),z=r("all"),E=r({}),A=r(!1),Y=r(!1),F=r("0"),B=r({totalSize:0,activeBonds:0,interestRate:0,availableCapacity:0}),b=r({duration:0,interestRate:0,minimumAmount:0,maximumAmount:0}),P=r([]),V=r("0"),k=r(!1),Z=r(""),C=r(0),y=r("pending"),U=r(""),T=r(""),ce=r(void 0),de=r([{label:l("transaction.approve"),description:l("transaction.approveDescription")},{label:l("transaction.confirm"),description:l("transaction.confirmDescription")},{label:l("transaction.complete"),description:l("transaction.completeDescription")}]),ue=J(()=>{const e=[];return _.value&&f.value&&e.push({label:l("bonds.subscriptionAmount"),value:`$${_.value}`,highlight:!0},{label:l("bonds.wrmbReceived"),value:`${f.value?.wrmbAmount||"0"} WRMB`},{label:l("bonds.expectedReturn"),value:`$${f.value?.expectedReturn||"0"} WRMB`}),e}),ee=J(()=>{switch(z.value){case"active":return P.value.filter(e=>e.isActive);case"matured":return P.value.filter(e=>e.isMatured);default:return P.value}}),se=J(()=>{const e=parseFloat(_.value);return e>=b.value.minimumAmount&&e<=b.value.maximumAmount&&e<=parseFloat(F.value)&&p.isConnected}),W=async()=>{try{if(!p.isConnected||!p.address)return;const e=g.getUSDTContract();if(!e)return;const a=await e.balanceOf(p.address);F.value=h(a,6)}catch(e){console.error("Failed to fetch USDT balance:",e)}},te=async()=>{try{if(!p.isConnected||!p.address)return;const e=g.getUSDTContract(),a=g.getAddresses();if(!e||!a.BOND_POOL)return;const n=await e.allowance(p.address,a.BOND_POOL);V.value=h(n,6)}catch(e){console.error("Failed to fetch USDT allowance:",e)}},L=async()=>{try{const e=g.getBondPoolContract();if(!e)return;const[a,n,d]=await e.getPoolStats(),u=await e.poolConfig();B.value={totalSize:parseFloat(h(a,6)),activeBonds:parseFloat(n),interestRate:parseFloat(h(u.interestRate,2)),availableCapacity:parseFloat(h(d,6))}}catch(e){console.error("Failed to fetch pool stats:",e)}},ve=async()=>{try{const e=g.getBondPoolContract();if(!e)return;const a=await e.poolConfig();b.value={duration:parseFloat(a.bondDuration)/(24*60*60),interestRate:parseFloat(h(a.interestRate,2)),minimumAmount:parseFloat(h(a.minSubscription,6)),maximumAmount:parseFloat(h(a.maxSubscription,6))}}catch(e){console.error("Failed to fetch bond terms:",e)}},x=async()=>{try{if(!p.isConnected||!p.address)return;const e=g.getBondPoolContract();if(!e)return;const[a,n]=await e.getUserBonds(p.address),d=[];for(let u=0;u<a.length;u++){const $=Number(a[u]),w=n[u],o=Date.now()/1e3>=Number(w.maturityTime);d.push({bondId:$,principal:h(w.principal,6),wrmbAmount:h(w.wrmbAmount,18),subscribeTime:Number(w.subscribeTime)*1e3,maturityTime:Number(w.maturityTime)*1e3,interestRate:h(w.interestRate,2),isActive:w.isActive&&!o,isMatured:o})}P.value=d}catch(e){console.error("Failed to fetch user bonds:",e)}},pe=async e=>{try{const a=N(e,6),n=N(V.value,6);A.value=n<a}catch(a){console.error("Failed to check approval:",a),A.value=!0}},me=async e=>{const a=parseFloat(e);if(!a||a<=0)return null;try{const n=g.getBondPoolContract();if(!n){const o=a*7.2,G=Date.now()+b.value.duration*24*60*60*1e3,Pe=a*(1+b.value.interestRate/100*b.value.duration/365);return{principal:a.toFixed(2),wrmbAmount:o.toFixed(2),maturityDate:G,expectedReturn:Pe.toFixed(2)}}const d=N(e,6),[u,$,w]=await n.previewSubscription(d);return{principal:a.toFixed(2),wrmbAmount:h(u,18),maturityDate:Number($)*1e3,expectedReturn:h(w,18)}}catch(n){return console.error("Failed to generate subscription preview:",n),null}},_e=Xe(async e=>{f.value=await me(e),e&&parseFloat(e)>0&&await pe(e)},500),q=e=>{_e(e)},he=()=>{const e=Math.min(parseFloat(F.value),b.value.maximumAmount,B.value.availableCapacity);_.value=e.toString(),q(_.value)},be=e=>{_.value=e.toString(),q(_.value)},fe=e=>e.isMatured?"success":e.isActive?"primary":"info",we=e=>e.isMatured?l("bonds.matured"):e.isActive?l("bonds.active"):l("bonds.inactive"),H=e=>{const a=Date.now(),n=e.maturityTime-e.subscribeTime,d=a-e.subscribeTime;return Math.min(100,Math.max(0,d/n*100))},ge=e=>{const a=parseFloat(e.principal),n=parseFloat(e.interestRate)/100,d=H(e)/100,u=b.value.duration/365;return a*(1+n*u*d)},ye=e=>{const a=Date.now(),n=e-a;return n<=0?l("bonds.matured"):`${Math.ceil(n/(24*60*60*1e3))} ${l("bonds.daysRemaining")}`},Be=async()=>{try{Y.value=!0,C.value=0,y.value="loading";const e=g.getUSDTContract(!0),a=g.getAddresses();if(!e||!a.BOND_POOL)throw new Error("Contract not available");const n=N(_.value,6),d=await e.approve(a.BOND_POOL,n);U.value=d.hash,await d.wait(),await te(),A.value=!1,C.value=1,D.success(l("bonds.approvalSuccess"))}catch(e){throw y.value="error",T.value=e.message||l("bonds.approvalFailed"),e}finally{Y.value=!1}},Se=async()=>{try{C.value=1,y.value="loading";const e=g.getBondPoolContract(!0);if(!e)throw new Error("Bond pool contract not available");const a=N(_.value,6),n=await e.subscribeBond(a);U.value=n.hash,await n.wait(),C.value=2,y.value="success",await Promise.all([W(),x(),L()]),_.value="",f.value=null,A.value=!1,D.success(l("bonds.subscriptionSuccess"))}catch(e){throw y.value="error",T.value=e.message||l("bonds.subscriptionFailed"),e}},ae=async()=>{if(se.value){Z.value=l("bonds.subscriptionTransaction"),k.value=!0,C.value=0,y.value="pending",O.value=!0,U.value="",T.value="";try{A.value&&await Be(),await Se()}catch(e){console.error("Subscription failed:",e),y.value!=="error"&&(y.value="error",T.value=e.message||l("bonds.subscriptionFailed"))}finally{O.value=!1}}},$e=async e=>{if(!e.isMatured){D.warning(l("bonds.bondNotMatured"));return}E.value[e.bondId]=!0;try{const a=g.getBondPoolContract(!0);if(!a)throw new Error("Bond pool contract not available");await(await a.matureBond(e.bondId)).wait(),await Promise.all([W(),x(),L()]),D.success(l("bonds.redeemSuccess"))}catch(a){console.error("Redemption failed:",a),D.error(a.message||l("bonds.redeemFailed"))}finally{E.value[e.bondId]=!1}},Ce=()=>{k.value=!1,U.value="",T.value=""},Te=()=>{ae()},I=async()=>{X.value=!0;try{await Promise.all([L(),ve()]),p.isConnected&&p.address&&await Promise.all([W(),te(),x()])}catch(e){console.error("Failed to refresh data:",e),D.error(l("common.dataLoadFailed"))}finally{X.value=!1}};oe(()=>p.isConnected,async e=>{e?await I():(F.value="0",V.value="0",P.value=[],_.value="",f.value=null)}),oe(()=>p.address,async(e,a)=>{e&&e!==a&&await I()});const{isRefreshing:Re,pullDistance:De,isPulling:Ae,canRefresh:Fe}=Ke({onRefresh:I,enabled:!0});return ke(async()=>{await I()}),(e,a)=>{const n=Oe,d=Ve,u=We,$=Le,w=xe,j=je;return S(),K(Qe,{"is-pulling":i(Ae),"is-refreshing":i(Re),"pull-distance":i(De),"can-refresh":i(Fe)},{default:m(()=>[s("div",Ye,[s("div",Ze,[s("div",es,[s("h2",ss,t(e.$t("bonds.poolOverview")),1),s("div",ts,[s("div",as,[s("div",os,[s("h3",ns,t(e.$t("bonds.totalPoolSize")),1),c(n,{class:"card-icon"},{default:m(()=>[c(i(Ie))]),_:1})]),s("div",is,t(i(v)(B.value.totalSize))+" USDT ",1),s("div",ls,t(e.$t("bonds.totalCapacity")),1)]),s("div",rs,[s("div",cs,[s("h3",ds,t(e.$t("bonds.activeBonds")),1),c(n,{class:"card-icon"},{default:m(()=>[c(i(ne))]),_:1})]),s("div",us,t(B.value.activeBonds),1),s("div",vs,t(e.$t("bonds.totalBonds")),1)]),s("div",ps,[s("div",ms,[s("h3",_s,t(e.$t("bonds.currentRate")),1),c(n,{class:"card-icon"},{default:m(()=>[c(i(ze))]),_:1})]),s("div",hs,t(i(v)(B.value.interestRate))+"% ",1),s("div",bs,t(e.$t("bonds.annualRate")),1)]),s("div",fs,[s("div",ws,[s("h3",gs,t(e.$t("bonds.availableCapacity")),1),c(n,{class:"card-icon"},{default:m(()=>[c(i(Ee))]),_:1})]),s("div",ys,t(i(v)(B.value.availableCapacity))+" USDT ",1),s("div",Bs,t(i(v)(B.value.availableCapacity/B.value.totalSize*100))+"% "+t(e.$t("bonds.remaining")),1)])])]),s("div",Ss,[s("div",$s,[s("h2",Cs,t(e.$t("bonds.subscribe")),1)]),s("div",Ts,[s("div",Rs,[s("div",Ds,[s("h3",As,t(e.$t("bonds.subscribeWithUSDT")),1),s("div",Fs,[s("span",Ps,t(e.$t("bonds.usdtBalance"))+":",1),s("span",Us,t(i(v)(F.value))+" USDT",1)])]),s("div",Ms,[s("div",Ns,[c(d,{modelValue:_.value,"onUpdate:modelValue":a[0]||(a[0]=o=>_.value=o),placeholder:e.$t("bonds.enterAmount"),size:"large",class:"amount-input",onInput:q},{suffix:m(()=>a[3]||(a[3]=[s("span",{class:"input-suffix"},"USDT",-1)])),_:1},8,["modelValue","placeholder"]),c(u,{text:"",onClick:he,class:"max-button"},{default:m(()=>[R(t(e.$t("common.max")),1)]),_:1})]),s("div",ks,[(S(),M(re,null,le([100,500,1e3,5e3],o=>c(u,{key:o,size:"small",onClick:G=>be(o)},{default:m(()=>[R(t(o)+" USDT ",1)]),_:2},1032,["onClick"])),64))])]),s("div",Is,[s("h4",Os,t(e.$t("bonds.bondTerms")),1),s("div",zs,[s("div",Es,[s("span",Vs,t(e.$t("bonds.duration")),1),s("span",Ws,t(b.value.duration)+" "+t(e.$t("bonds.days")),1)]),s("div",Ls,[s("span",xs,t(e.$t("bonds.interestRate")),1),s("span",qs,t(i(v)(b.value.interestRate))+"%",1)]),s("div",Hs,[s("span",js,t(e.$t("bonds.minimumAmount")),1),s("span",Gs,t(i(v)(b.value.minimumAmount))+" USDT",1)]),s("div",Js,[s("span",Ks,t(e.$t("bonds.maximumAmount")),1),s("span",Qs,t(i(v)(b.value.maximumAmount))+" USDT",1)])])]),f.value?(S(),M("div",Xs,[s("h4",Ys,t(e.$t("bonds.preview")),1),s("div",Zs,[s("div",et,[s("span",null,t(e.$t("bonds.principalAmount")),1),s("span",st,"$"+t(i(v)(f.value?.principal||"0")),1)]),s("div",tt,[s("span",null,t(e.$t("bonds.wrmbReceived")),1),s("span",at,t(i(v)(f.value?.wrmbAmount||"0"))+" WRMB",1)]),s("div",ot,[s("span",null,t(e.$t("bonds.maturityDate")),1),s("span",nt,t(i(Q)(f.value?.maturityDate||0)),1)]),s("div",it,[s("span",null,t(e.$t("bonds.expectedReturn")),1),s("span",lt,t(i(v)(f.value?.expectedReturn||"0"))+" WRMB",1)])])])):ie("",!0),c(u,{type:"primary",size:"large",loading:O.value,disabled:!se.value,onClick:ae,class:"action-button"},{default:m(()=>[R(t(e.$t("bonds.subscribeBond")),1)]),_:1},8,["loading","disabled"])])])]),s("div",rt,[s("div",ct,[s("h2",dt,t(e.$t("bonds.yourBonds")),1),s("div",ut,[c(w,{modelValue:z.value,"onUpdate:modelValue":a[1]||(a[1]=o=>z.value=o),size:"small"},{default:m(()=>[c($,{label:e.$t("bonds.allBonds"),value:"all"},null,8,["label"]),c($,{label:e.$t("bonds.activeBonds"),value:"active"},null,8,["label"]),c($,{label:e.$t("bonds.maturedBonds"),value:"matured"},null,8,["label"])]),_:1},8,["modelValue"])])]),s("div",vt,[ee.value.length===0?(S(),M("div",pt,[c(n,{class:"text-4xl text-gray-400 mb-2"},{default:m(()=>[c(i(ne))]),_:1}),s("p",mt,t(e.$t("bonds.noBonds")),1)])):ie("",!0),(S(!0),M(re,null,le(ee.value,o=>(S(),M("div",{key:o.bondId,class:He(["bond-card",{matured:o.isMatured,active:o.isActive}])},[s("div",_t,[s("div",ht,[s("span",bt,t(e.$t("bonds.bondId")),1),s("span",ft,"#"+t(o.bondId),1)]),s("div",wt,[c(j,{type:fe(o),size:"small"},{default:m(()=>[R(t(we(o)),1)]),_:2},1032,["type"])])]),s("div",gt,[s("div",yt,[s("div",Bt,[s("span",St,t(e.$t("bonds.principal")),1),s("span",$t,t(i(v)(o.principal))+" USDT",1)]),s("div",Ct,[s("span",Tt,t(e.$t("bonds.wrmbAmount")),1),s("span",Rt,t(i(v)(o.wrmbAmount))+" WRMB",1)]),s("div",Dt,[s("span",At,t(e.$t("bonds.interestRate")),1),s("span",Ft,t(i(v)(o.interestRate))+"%",1)]),s("div",Pt,[s("span",Ut,t(e.$t("bonds.subscribeDate")),1),s("span",Mt,t(i(Q)(o.subscribeTime)),1)]),s("div",Nt,[s("span",kt,t(e.$t("bonds.maturityDate")),1),s("span",It,t(i(Q)(o.maturityTime)),1)]),s("div",Ot,[s("span",zt,t(e.$t("bonds.currentValue")),1),s("span",Et,t(i(v)(ge(o)))+" USDT",1)])])]),s("div",Vt,[s("div",Wt,[s("div",Lt,[s("div",{class:"progress-fill",style:Ge({width:`${H(o)}%`})},null,4)]),s("span",xt,t(H(o))+"% "+t(e.$t("bonds.completed")),1)]),o.isMatured?(S(),K(u,{key:0,type:"primary",size:"small",onClick:G=>$e(o),loading:E.value[o.bondId]},{default:m(()=>[R(t(e.$t("bonds.redeem")),1)]),_:2},1032,["onClick","loading"])):(S(),K(u,{key:1,size:"small",disabled:""},{default:m(()=>[R(t(ye(o.maturityTime)),1)]),_:2},1024))])],2))),128))])])]),c(qe,{visible:k.value,"onUpdate:visible":a[2]||(a[2]=o=>k.value=o),title:Z.value,steps:de.value,"current-step":C.value,status:y.value,"transaction-details":ue.value,"gas-info":ce.value,"transaction-hash":U.value,"error-message":T.value,onClose:Ce,onRetry:Te},null,8,["visible","title","steps","current-step","status","transaction-details","gas-info","transaction-hash","error-message"])])]),_:1},8,["is-pulling","is-refreshing","pull-distance","can-refresh"])}}}),ea=Je(qt,[["__scopeId","data-v-e643fa81"]]);export{ea as default};
//# sourceMappingURL=Bonds--7z0Xe_b.js.map
