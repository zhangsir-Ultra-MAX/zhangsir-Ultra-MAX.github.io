import{d as ve,u as pe,a as he,r as v,c as R,o as me,w as x,b as we,e as p,f as s,g as u,t as n,h as i,L as fe,x as M,G as L,y as q,F as O,M as _e,j as $,N as ge,T as be,O as E,P as j,Q as ye,J as A,_ as Ve}from"./index-EBZBD7IP.js";import{A as $e}from"./AnimatedNumber-DMAocXSA.js";import{u as Ce,P as We}from"./usePullToRefresh-BJGuk06y.js";import{F as G}from"./FormattedInput-DGcZDhfq.js";import{u as Be}from"./savings-BnhwmOt9.js";import{c as N}from"./contracts-LobIsjLE.js";import{f as h,b as C,c as J}from"./format-DgO97vlP.js";import{d as K}from"./debounce-CLGozXK5.js";/* empty css                 */const Re="/assets/wrmb-BNsCH5P_.png",Ae={class:"savings"},Fe={class:"savings-content"},Te={class:"vault-overview"},Me={class:"section-title"},Se={class:"overview-grid"},Pe={class:"overview-card"},De={class:"card-header"},ke={class:"card-title"},xe={class:"card-subtitle"},Ee={class:"card-value"},Ne={class:"action-section"},Ie={class:"tab-content"},ze={class:"action-form"},Ue={class:"input-section"},He={class:"input-group"},Le={class:"quick-amounts"},qe={key:0,class:"preview-section"},Oe={class:"preview-title"},je={class:"preview-details"},Ge={class:"preview-row"},Je={class:"preview-value"},Ke={class:"preview-row exchange-rate"},Qe={class:"preview-value"},Ye={class:"tab-content"},Xe={class:"action-form"},Ze={class:"input-section"},es={class:"input-group"},ss={class:"quick-amounts"},as={key:0,class:"preview-section"},ts={class:"preview-title"},is={class:"preview-details"},ns={class:"preview-row"},os={class:"preview-value"},ls={class:"preview-row"},rs={class:"fee-value"},cs={class:"preview-row exchange-rate"},us={class:"preview-value"},ds={class:"statistics-section"},vs={class:"section-title"},ps={class:"stats-grid"},hs={class:"stat-item"},ms={class:"stat-label"},ws={class:"stat-value"},fs={class:"stat-item"},_s={class:"stat-label"},gs={class:"stat-value"},bs={class:"stat-item"},ys={class:"stat-label"},Vs={class:"stat-value"},$s={class:"stat-item"},Cs={class:"stat-label"},Ws={class:"stat-value"},Bs=ve({__name:"Savings",setup(Rs){const{t:o}=pe(),t=Be(),c=he(),y=v("deposit"),m=v(""),d=v(""),g=v({shares:"",fee:"0"}),w=v({shares:"",assets:"",fee:"0"}),W=v(!1),S=v(""),_=v(0),f=v("pending"),B=v(""),F=v(""),Q=v([{label:o("transaction.approve"),description:o("transaction.approveDescription")},{label:o("transaction.confirm"),description:o("transaction.confirmDescription")},{label:o("transaction.complete"),description:o("transaction.completeDescription")}]),Y=R(()=>{const e=[];return y.value==="deposit"&&m.value?e.push({label:o("pay"),value:`-${h(m.value,6)} WRMB`,highlight:!0,type:"debit"},{label:o("receive"),value:`+${h(g.value?.shares||"0",6)} sWRMB`,type:"credit"}):y.value==="withdraw"&&d.value&&e.push({label:o("pay"),value:`-${h(w.value?.shares||"0",6)} sWRMB`,type:"debit"},{label:o("receive"),value:`+${h(w.value?.assets||"0",6)} WRMB`,highlight:!0,type:"credit"}),e}),I=R(()=>{const e=parseFloat(m.value);return e>0&&e<=parseFloat(t.wrmbBalance)}),z=R(()=>{const e=parseFloat(d.value),a=parseFloat(t.userAssetValue);return e>0&&e<=a}),X=R(()=>{const e=parseFloat(d.value),a=parseFloat(w.value.fee);return(e*a).toString()}),Z=R(()=>{const e=parseFloat(t.userAssetValue);return e>=1e4?8:e>=1e3?9:e>=100?10:e>=10?11:e<1?12:10}),ee=K(async e=>{if(e&&parseFloat(e)>0)try{g.value=await t.previewDeposit(e)}catch(a){console.error("Failed to preview deposit:",a)}else g.value={shares:"",fee:"0"}},500),se=K(async e=>{if(e&&parseFloat(e)>0)try{w.value=await t.previewWithdraw(e)}catch(a){console.error("Failed to preview withdraw:",a)}else w.value={shares:"",assets:"",fee:"0"}},500),P=e=>{ee(e)},D=e=>{se(e)},ae=()=>{m.value=t.wrmbBalance,P(m.value)},te=()=>{d.value=t.userAssetValue,D(d.value)},ie=e=>{const a=J(t.wrmbBalance,e);m.value=a,P(a)},ne=e=>{const a=J(t.userAssetValue,e);d.value=a,D(a)},U=async()=>{if(!(!I.value||!c.isConnected)){S.value=o("savings.depositTransaction"),W.value=!0,_.value=0,f.value="pending";try{const e=E(m.value,18),a=N.getWRMBContract(!0),r=N.getSavingsVaultContract(!0);if(!a||!r)throw new Error("Contract not available");const b=await r.getAddress();await a.allowance(c.address,b)<e&&(f.value="loading",await(await a.approve(b,e)).wait()),_.value=1,f.value="loading";const k=await(await r.deposit(e,c.address)).wait();B.value=k.hash,_.value=2,f.value="success",m.value="",g.value={shares:"",fee:"0"},await t.fetchVaultData(),_.value=3,j.success(o("savings.depositSuccess"))}catch(e){f.value="error",F.value=e.message||o("savings.depositFailed"),console.error("Deposit failed:",e)}}},H=async()=>{if(!z.value||!c.isConnected)return;const e=parseFloat(w.value.fee)*100;if(!(e>10&&!await ye.confirm(`${o("savings.highFeeWarning")} ${h(e.toString(),2)}%。${o("savings.confirmHighFeeWithdraw")}`,o("savings.highFeeTitle"),{confirmButtonText:o("common.confirm"),cancelButtonText:o("common.cancel"),type:"warning",dangerouslyUseHTMLString:!1}).catch(()=>!1))){S.value=o("savings.withdrawTransaction"),W.value=!0,_.value=1,f.value="loading";try{const a=E(d.value,18),r=N.getSavingsVaultContract(!0);if(!r)throw new Error("Contract not available");if(d.value===t.userAssetValue){const V=await(await r.redeem(E(t.userBalance,18),c.address,c.address)).wait();B.value=V.hash}else{const V=await(await r.withdraw(a,c.address,c.address)).wait();B.value=V.hash}_.value=2,f.value="success",d.value="",w.value={shares:"",assets:"",fee:"0"},await t.fetchVaultData(),_.value=3,j.success(o("savings.withdrawSuccess"))}catch(a){f.value="error",F.value=a.message||o("savings.withdrawFailed"),console.error("Withdraw failed:",a)}}},oe=()=>{W.value=!1,B.value="",F.value=""},le=()=>{y.value==="deposit"?U():H()},T=async()=>{await Promise.all([t.fetchVaultData(),t.fetchUserBalances(),t.fetchWRMBPrice()])},{isRefreshing:re,pullDistance:ce,isPulling:ue,canRefresh:de}=Ce({onRefresh:T,enabled:!0});return me(async()=>{c.isConnected?(await T(),t.startAutoRefresh()):await t.fetchVaultData()}),x(()=>c.isConnected,async e=>{e?(await T(),t.startAutoRefresh()):t.stopAutoRefresh()}),x(()=>c.chainId,async e=>{e&&await T()}),x(y,e=>{m.value="",d.value="",g.value={shares:"",fee:"0"},w.value={shares:"",assets:"",fee:"0"}}),(e,a)=>{const r=_e,b=fe,V=ge;return A(),we(We,{"is-pulling":i(ue),"is-refreshing":i(re),"pull-distance":i(ce),"can-refresh":i(de)},{default:p(()=>[s("div",Ae,[s("div",Fe,[s("div",Te,[s("h2",Me,n(e.$t("savings.vaultOverview")),1),s("div",Se,[s("div",Pe,[s("div",De,[s("h3",ke,n(e.$t("savings.assetValue")),1),s("div",xe,n(e.$t("savings.apy"))+" "+n(i(h)(i(t).dynamicAPY))+"% ",1)]),s("div",Ee,[a[4]||(a[4]=s("img",{src:Re,alt:"",class:"wrmb-icon"},null,-1)),u($e,{class:"animated-number",value:i(t).userAssetValue,decimals:Z.value,"auto-increment":i(c).isConnected&&parseFloat(i(t).userAssetValue)>0,"increment-amount":parseFloat(i(t).userIncrementAmount),"increment-interval":1e3,"cache-key":`userAssetValue_${i(c).address}`,"use-cache":!1},null,8,["value","decimals","auto-increment","increment-amount","cache-key"])])])])]),s("div",Ne,[u(V,{modelValue:y.value,"onUpdate:modelValue":a[2]||(a[2]=l=>y.value=l),class:"savings-tabs"},{default:p(()=>[u(b,{label:e.$t("savings.deposit"),name:"deposit"},{default:p(()=>[s("div",Ie,[s("div",ze,[s("div",Ue,[s("div",He,[u(G,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=l=>m.value=l),placeholder:i(C)(i(t).wrmbBalance)+"  "+e.$t("available"),size:"large",class:"amount-input",decimals:6,"use-abbreviation":!0,"max-decimals":18,onInputChange:P},{suffix:p(()=>a[5]||(a[5]=[s("span",{class:"input-suffix"},"WRMB",-1)])),_:1},8,["modelValue","placeholder"])]),s("div",Le,[(A(),M(O,null,q([25,50,75],l=>u(r,{key:l,size:"small",onClick:k=>ie(l)},{default:p(()=>[$(n(l)+"% ",1)]),_:2},1032,["onClick"])),64)),u(r,{onClick:ae,class:"max-button",size:"small"},{default:p(()=>[$(n(e.$t("common.max")),1)]),_:1})])]),g.value.shares?(A(),M("div",qe,[s("h4",Oe,n(e.$t("savings.preview")),1),s("div",je,[s("div",Ge,[s("span",null,n(e.$t("savings.youWillReceive")),1),s("span",Je,n(i(h)(g.value.shares,2))+" sWRMB",1)]),s("div",Ke,[s("span",null,n(e.$t("savings.currentExchangeRate")),1),s("span",Qe,"1 WRMB ≈ "+n(i(h)(1/parseFloat(i(t).currentNAV||"1"),6))+" sWRMB",1)])])])):L("",!0),u(r,{type:"primary",size:"large",loading:i(t).depositInProgress,disabled:!I.value,onClick:U,class:"action-button"},{default:p(()=>[$(n(e.$t("savings.deposit")),1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["label"]),u(b,{label:e.$t("savings.withdraw"),name:"withdraw"},{default:p(()=>[s("div",Ye,[s("div",Xe,[s("div",Ze,[s("div",es,[u(G,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=l=>d.value=l),placeholder:i(C)(i(t).userAssetValue)+"  "+e.$t("available"),size:"large",class:"amount-input",decimals:6,"use-abbreviation":!0,"max-decimals":18,onInputChange:D},{suffix:p(()=>a[6]||(a[6]=[s("span",{class:"input-suffix"},"WRMB",-1)])),_:1},8,["modelValue","placeholder"])]),s("div",ss,[(A(),M(O,null,q([25,50,75],l=>u(r,{key:l,size:"small",onClick:k=>ne(l)},{default:p(()=>[$(n(l)+"% ",1)]),_:2},1032,["onClick"])),64)),u(r,{onClick:te,class:"max-button",size:"small"},{default:p(()=>[$(n(e.$t("common.max")),1)]),_:1})])]),w.value.shares?(A(),M("div",as,[s("h4",ts,n(e.$t("savings.preview")),1),s("div",is,[s("div",ns,[s("span",null,n(e.$t("savings.youWillReceive")),1),s("span",os,n(i(h)(w.value.assets,2))+" WRMB",1)]),s("div",ls,[s("span",null,n(e.$t("savings.fee"))+" ("+n(i(h)((parseFloat(w.value.fee)*100).toString()))+"%)",1),s("span",rs,n(i(h)(X.value,2))+" WRMB",1)]),s("div",cs,[s("span",null,n(e.$t("savings.currentExchangeRate")),1),s("span",us,"1 sWRMB ≈ "+n(i(h)(i(t).currentNAV,6))+" WRMB",1)])])])):L("",!0),u(r,{type:"primary",size:"large",loading:i(t).withdrawInProgress,disabled:!z.value,onClick:H,class:"action-button"},{default:p(()=>[$(n(e.$t("savings.withdraw")),1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),s("div",ds,[s("h2",vs,n(e.$t("savings.statistics")),1),s("div",ps,[s("div",hs,[s("div",ms,n(e.$t("savings.totalSupply")),1),s("div",ws,n(i(C)(i(t).totalAssets)),1)]),s("div",fs,[s("div",_s,n(e.$t("savings.yourShare")),1),s("div",gs,n(i(C)(i(t).userSharePercentage))+"%",1)]),s("div",bs,[s("div",ys,n(e.$t("savings.totalValue")),1),s("div",Vs,"$"+n(i(C)(parseFloat(i(t).totalAssets)*.14,2)),1)]),s("div",$s,[s("div",Cs,n(e.$t("savings.yourValue")),1),s("div",Ws,"$"+n(i(C)(parseFloat(i(t).userAssetValue)*.14,2)),1)])])])]),u(be,{visible:W.value,"onUpdate:visible":a[3]||(a[3]=l=>W.value=l),title:S.value,steps:Q.value,"current-step":_.value,status:f.value,"transaction-details":Y.value,"transaction-hash":B.value,"error-message":F.value,onClose:oe,onRetry:le},null,8,["visible","title","steps","current-step","status","transaction-details","transaction-hash","error-message"])])]),_:1},8,["is-pulling","is-refreshing","pull-distance","can-refresh"])}}}),Ns=Ve(Bs,[["__scopeId","data-v-f88043e3"]]);export{Ns as default};
//# sourceMappingURL=Savings-CQyPJWUw.js.map
