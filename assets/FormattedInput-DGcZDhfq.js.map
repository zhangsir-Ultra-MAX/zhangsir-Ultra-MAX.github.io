{"version":3,"file":"FormattedInput-DGcZDhfq.js","sources":["../../src/components/common/FormattedInput.vue"],"sourcesContent":["<template>\r\n  <el-input\r\n    v-model=\"displayValue\"\r\n    :placeholder=\"placeholder\"\r\n    :size=\"size\"\r\n    :class=\"inputClass\"\r\n    @input=\"handleInput\"\r\n    @focus=\"handleFocus\"\r\n    @blur=\"handleBlur\"\r\n    v-bind=\"$attrs\"\r\n  />\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, watch } from 'vue'\r\nimport { formatNumber, formatLargeNumber } from '@/utils/format'\r\nimport BigNumber from 'bignumber.js'\r\n\r\ninterface Props {\r\n  modelValue: string | number\r\n  placeholder?: string\r\n  size?: 'large' | 'default' | 'small'\r\n  inputClass?: string\r\n  decimals?: number\r\n  useAbbreviation?: boolean // 是否使用K、M、B、T缩写\r\n  abbreviationThreshold?: number // 启用缩写的阈值\r\n  maxDecimals?: number // 最大小数位数\r\n}\r\n\r\nconst props = withDefaults(defineProps<Props>(), {\r\n  placeholder: '',\r\n  size: 'default',\r\n  inputClass: '',\r\n  decimals: 6,\r\n  useAbbreviation: true,\r\n  abbreviationThreshold: 1000000,\r\n  maxDecimals: 6\r\n})\r\n\r\nconst emit = defineEmits<{\r\n  'update:modelValue': [value: string]\r\n  'inputChange': [value: string]\r\n}>()\r\n\r\nconst displayValue = ref('')\r\nconst rawValue = ref('')\r\nconst isFocused = ref(false)\r\n\r\n// 解析缩写单位的数值\r\nconst parseAbbreviatedValue = (value: string): string => {\r\n  const cleanValue = value.trim().toLowerCase()\r\n  const numericMatch = cleanValue.match(/^([0-9]*\\.?[0-9]+)/)\r\n  \r\n  if (!numericMatch) return '0'\r\n  \r\n  const numericPart = new BigNumber(numericMatch[1])\r\n  \r\n  if (cleanValue.includes('t')) {\r\n    return numericPart.multipliedBy(new BigNumber('1e12')).toString()\r\n  } else if (cleanValue.includes('b')) {\r\n    return numericPart.multipliedBy(new BigNumber('1e9')).toString()\r\n  } else if (cleanValue.includes('m')) {\r\n    return numericPart.multipliedBy(new BigNumber('1e6')).toString()\r\n  } else if (cleanValue.includes('k')) {\r\n    return numericPart.multipliedBy(new BigNumber('1e3')).toString()\r\n  } \r\n\r\n  return value; \r\n}\r\n\r\n// 格式化显示值\r\nconst formatDisplayValue = (value: string): string => {\r\n  if (!value || value === '0') return ''\r\n  \r\n  try {\r\n    const numValue = new BigNumber(value)\r\n    if (numValue.isNaN() || numValue.isZero()) return ''\r\n    \r\n    if (props.useAbbreviation && numValue.isGreaterThanOrEqualTo(props.abbreviationThreshold)) {\r\n      return formatLargeNumber(numValue.toNumber(), 2)\r\n    }\r\n    \r\n    return formatNumber(numValue.toNumber(), props.decimals)\r\n  } catch (error) {\r\n    return ''\r\n  }\r\n}\r\n\r\n// 处理输入\r\nconst handleInput = (value: string) => {\r\n  // 允许输入数字、小数点和单位字母\r\n  const cleanValue = value.replace(/[^0-9.kmbtKMBT]/g, '')\r\n  \r\n  // 确保只有一个小数点\r\n  const parts = cleanValue.split('.')\r\n  let processedValue = parts[0]\r\n  if (parts.length > 1) {\r\n    processedValue += '.' + parts.slice(1).join('')\r\n  }\r\n  \r\n  // 限制小数位数\r\n  const decimalIndex = processedValue.indexOf('.')\r\n  if (decimalIndex !== -1 && processedValue.length - decimalIndex - 1 > props.maxDecimals) {\r\n    processedValue = processedValue.substring(0, decimalIndex + props.maxDecimals + 1)\r\n  }\r\n  \r\n  displayValue.value = processedValue\r\n\r\n  // 解析实际数值\r\n  const actualValue = parseAbbreviatedValue(processedValue)\r\n  rawValue.value = actualValue\r\n  emit('update:modelValue', rawValue.value)\r\n  emit('inputChange', rawValue.value)\r\n}\r\n\r\n// 处理聚焦\r\nconst handleFocus = () => {\r\n  isFocused.value = true\r\n  // 聚焦时显示原始数值，便于编辑\r\n  if (rawValue.value) {\r\n    try {\r\n      const numValue = new BigNumber(rawValue.value)\r\n\r\n      if (!numValue.isNaN() && numValue.isGreaterThan(0)) {\r\n        displayValue.value = numValue.toFixed()\r\n      }else if(numValue.isEqualTo(0)){\r\n        displayValue.value = ''\r\n      }\r\n    } catch (error) {\r\n      // 忽略错误，保持当前显示值\r\n    }\r\n  }\r\n}\r\n\r\n// 处理失焦\r\nconst handleBlur = () => {\r\n  isFocused.value = false\r\n  // 失焦时显示格式化数值\r\n  if (rawValue.value) {\r\n    try {\r\n      const numValue = new BigNumber(rawValue.value)\r\n      if (!numValue.isNaN() && numValue.isGreaterThanOrEqualTo(0)) {\r\n        displayValue.value = formatDisplayValue(rawValue.value)\r\n      }\r\n    } catch (error) {\r\n      // 忽略错误，保持当前显示值\r\n    }\r\n  }\r\n}\r\n\r\n// 监听外部值变化\r\nwatch(\r\n  () => props.modelValue,\r\n  (newValue) => {\r\n    const valueStr = typeof newValue === 'number' ? newValue.toString() : newValue\r\n    rawValue.value = valueStr\r\n    if (!isFocused.value) {\r\n      // 未聚焦时显示格式化值\r\n      displayValue.value = formatDisplayValue(valueStr)\r\n    }\r\n  },\r\n  { immediate: true }\r\n)\r\n\r\n// 暴露方法供父组件调用\r\ndefineExpose({\r\n  focus: () => {\r\n    // 这里可以添加聚焦逻辑\r\n  },\r\n  blur: () => {\r\n    handleBlur()\r\n  },\r\n  clear: () => {\r\n    displayValue.value = ''\r\n    rawValue.value = ''\r\n    emit('update:modelValue', '')\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n/* 可以添加自定义样式 */\r\n</style>"],"names":["props","__props","emit","__emit","displayValue","ref","rawValue","isFocused","parseAbbreviatedValue","value","cleanValue","numericMatch","numericPart","BigNumber","formatDisplayValue","numValue","formatLargeNumber","formatNumber","handleInput","parts","processedValue","decimalIndex","actualValue","handleFocus","handleBlur","watch","newValue","valueStr","__expose","_openBlock","_createBlock","_component_el_input","_mergeProps","$event","placeholder","size","inputClass","$attrs"],"mappings":"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"}