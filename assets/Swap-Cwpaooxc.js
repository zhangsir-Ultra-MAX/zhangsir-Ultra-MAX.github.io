import{a as xe,P as H,$ as J,a0 as St,a1 as W,O as re,I as Ee,a2 as Tt,d as Et,u as Ot,r,c as me,a3 as k,w as ue,o as xt,a4 as Ft,b as Bt,e as E,f as o,g,t as m,x as V,y as Qe,F as Xe,a5 as Dt,a6 as Rt,E as Pt,h as F,a7 as Lt,a8 as Nt,j as ie,M as Ut,A as Vt,a9 as Mt,G as Ke,Y as je,aa as qt,T as $t,J as L,n as zt,ab as Ye,_ as Gt}from"./index-EBZBD7IP.js";import"./el-tooltip-l0sNRNKZ.js";import{f as Oe,b as He,c as Wt}from"./format-DgO97vlP.js";import{u as Qt,P as Xt}from"./usePullToRefresh-BJGuk06y.js";import{T as Je}from"./TokenSelect-BWpZZm0S.js";import{F as Ze}from"./FormattedInput-DGcZDhfq.js";/* empty css               *//* empty css                  *//* empty css                 */BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141");BigInt("1000000000000000000");const et=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");BigInt("0x8000000000000000000000000000000000000000000000000000000000000000")*BigInt(-1);BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");const we={1:{POOL_MANAGER:"0x0000000000000000000000000000000000000000",UNIVERSAL_ROUTER:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",QUOTER:"0x0000000000000000000000000000000000000000",STATE_VIEW:"0x0000000000000000000000000000000000000000",PERMIT2:"0x000000000022D473030F116dDEE9F6B43aC78BA3"},11155111:{POOL_MANAGER:"0x8C4BcBE6b9eF47855f97E675296FA3F6fafa5F1A",UNIVERSAL_ROUTER:"0x3A9D48AB9751398BbFa63ad67599Bb04e4BdF98b",QUOTER:"0x61b3f2011a92d183c7dbadbda940a7555ccf9227",STATE_VIEW:"0xe1dd9c3fa50edb962e442f60dfbc432e24537e4c",POSITION_MANAGER:"0x429ba70129df741B2Ca2a85BC3A2a3328e5c09b4",PERMIT2:"0x000000000022D473030F116dDEE9F6B43aC78BA3"},[Tt.LOCAL.chainId]:{POOL_MANAGER:"0x8C4BcBE6b9eF47855f97E675296FA3F6fafa5F1A",UNIVERSAL_ROUTER:"0x94cC0AaC535CCDB3C01d6787D6413C739ae12bc4",QUOTER:"0xC195976fEF0985886E37036E2DF62bF371E12Df0",STATE_VIEW:"0x1234567890123456789012345678901234567890",PERMIT2:"0x000000000022D473030F116dDEE9F6B43aC78BA3"}},Kt=["function swap(bytes32 poolId, (bool zeroForOne, int256 amountSpecified, uint160 sqrtPriceLimitX96), bytes calldata hookData) external returns (int256 amount0, int256 amount1)","function modifyLiquidity(bytes32 poolId, (int24 tickLower, int24 tickUpper, int256 liquidityDelta), bytes calldata hookData) external returns (int256 amount0, int256 amount1)","function initialize(bytes32 poolId, uint160 sqrtPriceX96, bytes calldata hookData) external returns (int24 tick)","function donate(bytes32 poolId, uint256 amount0, uint256 amount1, bytes calldata hookData) external returns (int256 amount0Delta, int256 amount1Delta)","function take(address currency, address to, uint256 amount) external","function settle(address currency) external payable returns (uint256 paid)"],jt=["function getSlot0(bytes32 poolId) external view returns (uint160 sqrtPriceX96, int24 tick, uint16 protocolFee, uint16 lpFee)","function getLiquidity(bytes32 poolId) external view returns (uint128)","function getTickInfo(bytes32 poolId, int24 tick) external view returns (uint128 liquidityGross, int128 liquidityNet, uint256 feeGrowthOutside0X128, uint256 feeGrowthOutside1X128)","function getTickBitmap(bytes32 poolId, int16 wordPosition) external view returns (uint256)","function getPosition(bytes32 poolId, address owner, int24 tickLower, int24 tickUpper) external view returns (uint128 liquidity, uint256 feeGrowthInside0LastX128, uint256 feeGrowthInside1LastX128, uint128 tokensOwed0, uint128 tokensOwed1)","function getFeeGrowthGlobal0X128(bytes32 poolId) external view returns (uint256)","function getFeeGrowthGlobal1X128(bytes32 poolId) external view returns (uint256)","function getProtocolFees(bytes32 poolId) external view returns (uint256 token0, uint256 token1)"],Yt=[{inputs:[{internalType:"bytes",name:"commands",type:"bytes"},{internalType:"bytes[]",name:"inputs",type:"bytes[]"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"execute",outputs:[],stateMutability:"payable",type:"function"}],Ht=["function quoteExactInputSingle(((address currency0, address currency1, uint24 fee, int24 tickSpacing, address hooks) poolKey, bool zeroForOne, uint128 exactAmount, bytes hookData)) external returns (uint256 amountOut, uint256 gasEstimate)","function quoteExactOutputSingle(((address currency0, address currency1, uint24 fee, int24 tickSpacing, address hooks) poolKey, bool zeroForOne, uint128 exactAmount, bytes hookData)) external returns (uint256 amountIn, uint256 gasEstimate)"],Jt=["function balanceOf(address) view returns (uint256)","function allowance(address, address) view returns (uint256)","function approve(address, uint256) returns (bool)","function transfer(address, uint256) returns (bool)","function decimals() view returns (uint8)","function symbol() view returns (string)","function name() view returns (string)"];class Zt{poolManagerContract=null;swapRouterContract=null;quoterContract=null;stateViewContract=null;provider=null;signer=null;constructor(){this.initializeContracts()}async initializeContracts(){const t=xe();if(!t.provider||!t.chainId)return;this.provider=t.provider,this.signer=t.signer;const n=we[t.chainId];if(!n){const b={1:"以太坊主网",5:"Goerli 测试网",11155111:"Sepolia 测试网",31337:"本地测试网"}[t.chainId]||`网络 ${t.chainId}`;H.warning({message:`Uniswap V4 暂不支持 ${b}。目前仅支持以太坊主网和本地测试网络。`,duration:5e3});return}try{this.poolManagerContract=new J(n.POOL_MANAGER,Kt,this.provider),this.swapRouterContract=new J(n.UNIVERSAL_ROUTER,Yt,this.signer),this.quoterContract=new J(n.QUOTER,Ht,this.provider),this.stateViewContract=new J(n.STATE_VIEW,jt,this.provider)}catch{this.poolManagerContract=null,this.swapRouterContract=null,this.quoterContract=null,this.stateViewContract=null}}async reinitialize(){await this.initializeContracts()}getTokenContract(t,n=!1){const p=n?this.signer:this.provider;return new J(t,Jt,p)}generatePoolId(t,n,p,b=10){const[f,A]=t.toLowerCase()<n.toLowerCase()?[t,n]:[n,t];let B="0x0000000000000000000000000000000000000000";return(f=="0x45Dd667b7C97F7c7B9135dA7f8674dF7d6662737"||A=="0x45Dd667b7C97F7c7B9135dA7f8674dF7d6662737")&&(B="0x7d08875f51879bedD9a01d71a804f012e1304fC0"),St(W.defaultAbiCoder().encode(["address","address","uint24","int24","address"],[f,A,p,b,B]))}async getPoolInfo(t,n,p=500,b=10){if(this.stateViewContract||await this.initializeContracts(),!this.stateViewContract)throw new Error("StateView contract not initialized");try{const f=this.generatePoolId(t,n,p,b),A=await this.stateViewContract.getLiquidity(f);if(A.toString()==="0")return null;const B=await this.stateViewContract.getSlot0(f);return{poolId:f,token0:t.toLowerCase()<n.toLowerCase()?t:n,token1:t.toLowerCase()<n.toLowerCase()?n:t,fee:p,sqrtPriceX96:B.sqrtPriceX96.toString(),tick:B.tick,liquidity:A.toString()}}catch(f){return f.code==="CALL_EXCEPTION",null}}async calculatePriceImpact(t,n,p,b,f){try{if(!this.stateViewContract)return .1;const B=(await this.stateViewContract.getSlot0(f)).sqrtPriceX96,S=parseFloat(p),l=parseFloat(b);if(S===0||l===0)return 0;const u=S;return u<1e3?.01:u<1e4?.05:u<1e5?.1:.5}catch{return .1}}async getQuote(t){const n=xe();if(!this.isNetworkSupported(n.chainId))return H.error("当前网络不支持 Uniswap V4，请切换到以太坊主网或本地测试网络"),null;if(this.quoterContract||await this.initializeContracts(),!this.quoterContract)throw new Error("Quoter contract not initialized");try{const p=this.getTokenContract(t.tokenIn),b=this.getTokenContract(t.tokenOut),[f,A]=await Promise.all([p.decimals(),b.decimals()]),B=this.generatePoolId(t.tokenIn,t.tokenOut,500),S=t.tokenIn.toLowerCase()<t.tokenOut.toLowerCase()?t.tokenIn:t.tokenOut,l=t.tokenIn.toLowerCase()<t.tokenOut.toLowerCase()?t.tokenOut:t.tokenIn,u=t.tokenIn.toLowerCase()===S.toLowerCase(),Q={poolKey:{currency0:S,currency1:l,fee:500,tickSpacing:10,hooks:"0x0000000000000000000000000000000000000000"},zeroForOne:u,exactAmount:BigInt(0),hookData:"0x"};(S=="0x45Dd667b7C97F7c7B9135dA7f8674dF7d6662737"||l=="0x45Dd667b7C97F7c7B9135dA7f8674dF7d6662737")&&(Q.poolKey.hooks="0x7d08875f51879bedD9a01d71a804f012e1304fC0");let X,Z,s,i,I;if(t.swapType==="exactInput"){if(!t.amountIn)throw new Error("amountIn is required for exactInput");const N=re(t.amountIn,f);Q.exactAmount=N,X=await this.quoterContract.quoteExactInputSingle.staticCall(Q),Z=Ee(X.amountOut,A),s=t.amountIn,i=t.amountIn,I=Z}else{if(!t.amountOut)throw new Error("amountOut is required for exactOutput");const N=re(t.amountOut,A);Q.exactAmount=N,X=await this.quoterContract.quoteExactOutputSingle.staticCall(Q),s=Ee(X.amountIn,f),Z=t.amountOut,i=s,I=t.amountOut}const G=await this.calculatePriceImpact(t.tokenIn,t.tokenOut,i,I,B);return{amountOut:Z,amountIn:s,priceImpact:G.toString(),fee:"0.05",route:[t.tokenIn,t.tokenOut]}}catch{return null}}async checkAllowance(t,n,p){const b=this.getTokenContract(t);try{return(await b.allowance(p,n)).toString()}catch{return"0"}}async approveToken(t,n,p){const b=this.getTokenContract(t,!0);try{const f=et,A=await b.approve(n,f);return H.info("授权交易已提交，等待确认..."),await A.wait(),H.success("代币授权成功"),!0}catch{return H.error("代币授权失败"),!1}}async getTokenBalance(t,n){const p=this.getTokenContract(t);try{const[b,f]=await Promise.all([p.balanceOf(n),p.decimals()]);return Ee(b,f)}catch{return"0"}}getSupportedNetworks(){return Object.keys(we).map(Number)}isNetworkSupported(t){return t in we}getContractAddresses(t){return we[t]||null}}const w=new Zt,ea={class:"swap"},ta={class:"swap-content"},aa={class:"swap-overview"},na={class:"section-title"},oa={class:"swap-interface"},sa={class:"interface-card"},la={class:"settings-icon"},ua={class:"settings-content"},ia={class:"settings-title"},ra={class:"detail-item"},ca={class:"slippage-selector"},da=["onClick"],fa={class:"custom-slippage"},pa={class:"token-selection"},va={class:"token-input-container"},ma={class:"token-input-header"},wa={class:"input-label"},ha={class:"input-section"},ga={class:"input-group"},ba={class:"amount-input"},ka={class:"input-with-select"},ya={class:"quick-amounts"},Ia={class:"swap-direction"},Ca={class:"token-input-container"},_a={class:"token-input-header"},Aa={class:"input-label"},Sa={class:"input-section"},Ta={class:"input-group"},Ea={class:"amount-input"},Oa={class:"input-with-select"},xa={class:"swap-details"},Fa={class:"details-title"},Ba={class:"details-content"},Da={key:0,class:"detail-row"},Ra={class:"status-indicator"},Pa={key:0,class:"status-supported"},La={key:1,class:"status-unsupported"},Na={key:1,class:"detail-row"},Ua={class:"status-indicator"},Va={key:0,class:"status-supported"},Ma={key:1,class:"status-warning"},qa={class:"detail-row exchange-rate"},$a={key:0,class:"detail-value rate-value"},za={key:1,class:"detail-value no-rate-text"},Ga={class:"action-container"},Wa=Et({__name:"Swap",setup(tt){const t=xe(),{t:n}=Ot(),{isRefreshing:p,pullDistance:b,isPulling:f,canRefresh:A}=Qt({onRefresh:async()=>{try{t.isConnected&&await Promise.all([se(),oe(),j()])}catch(e){console.error("Failed to refresh swap data:",e)}}}),B=r(0),S=me(()=>{const e=t.chainId||11155111;return[{symbol:k.WRMB.symbol,name:k.WRMB.name,address:k.WRMB.addresses[e]||k.WRMB.addresses[11155111]||"0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984",decimals:k.WRMB.decimals},{symbol:k.USDC.symbol,name:k.USDC.name,address:k.USDC.addresses[e]||k.USDC.addresses[11155111]||"0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238",decimals:k.USDC.decimals},{symbol:k.USDT.symbol,name:k.USDT.name,address:k.USDT.addresses[e]||k.USDT.addresses[11155111]||"0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238",decimals:k.USDT.decimals}]}),l=r(),u=r();ue(S,e=>{e.length>=2&&((!l.value||l.value.symbol!==e[0].symbol)&&(l.value=e[0]),(!u.value||u.value.symbol!==e[1].symbol)&&(u.value=e[1]))},{immediate:!0});const Q=(e,a)=>{e.symbol===u.value?.symbol&&a!=null&&(u.value=a,X()),$(),h.value=null,s.value&&parseFloat(s.value)>0&&(O.value=!0,Ie())},X=()=>{const e=s.value;s.value=i.value,i.value=e},Z=(e,a)=>{e.symbol==l.value?.symbol&&a!=null&&(l.value=a,X()),$(),h.value=null,i.value&&parseFloat(i.value)>0&&(O.value=!1,Ne())};ue(()=>t.chainId,e=>{if(e){w.reinitialize();const a=S.value;a.length>=2&&(l.value=a[0],u.value=a[1]),oe(),j(),h.value=null,s.value="",i.value=""}});const s=r(""),i=r(""),I=r("0"),G=r("0"),Fe=[1,5],N=r(1),ce=r(""),K=r(6.5),he=r(.3),D=r(!1),y=r(!1),h=r(null),C=r(!1),ge=r("0"),R=r(!1),O=r(!0),P=r(null),be=r(0),M=r(!1),Be=r(0);r(!1);const de=r(!1),q=r(0),_=r("pending"),ke=r(""),x=r(""),De=r(void 0),at=me(()=>[{label:n("swap.steps.checkAllowance"),description:n("swap.steps.checkAllowanceDesc")},{label:n("swap.steps.approve"),description:n("swap.steps.approveDesc")},{label:n("swap.steps.swap"),description:n("swap.steps.swapDesc")},{label:n("swap.steps.confirm"),description:n("swap.steps.confirmDesc")}]),nt=me(()=>[{label:n("swap.sell"),value:`-${Oe(s.value,6)} ${l.value?.symbol||""}`,highlight:!0,type:"debit"},{label:n("swap.buy"),value:`+${Oe(i.value,6)} ${u.value?.symbol||""}`,highlight:!0,type:"credit"}]);function U(){if(h.value&&s.value&&parseFloat(s.value)>0){const e=parseFloat(s.value),a=parseFloat(h.value.amountOut);K.value=a/e}else l.value?.symbol===u.value?.symbol?K.value=1:K.value=0}const Re=me(()=>t.isConnected&&R.value&&C.value&&s.value&&parseFloat(s.value)>0&&parseFloat(s.value)<=parseFloat(I.value)&&!y.value&&!D.value&&!M.value&&l.value?.symbol!==u.value?.symbol);function Pe(e,a){if(!e)return"";const c=e.replace(/[^0-9.]/g,""),d=c.split(".");return d.length>2?d[0]+"."+d.slice(1).join(""):d.length===2&&d[1].length>a?d[0]+"."+d[1].substring(0,a):c}function Le(e,a){let c;return(...d)=>{clearTimeout(c),c=setTimeout(()=>e(...d),a)}}function $(){P.value&&(P.value.abort(),P.value=null)}function ee(e){return e!==be.value}function ye(){if(M.value=!0,l.value){const e=Pe(s.value,l.value.decimals);if(e!==s.value){s.value=e;return}}O.value=!0,s.value&&parseFloat(s.value)>0?Ie():($(),i.value="",h.value=null,U(),M.value=!1)}function ot(){if(M.value=!0,u.value){const e=Pe(i.value,u.value.decimals);if(e!==i.value){i.value=e;return}}O.value=!1,i.value&&parseFloat(i.value)>0?Ne():($(),s.value="",h.value=null,U(),M.value=!1)}const Ie=Le(()=>{y.value||ct()},1e3),Ne=Le(()=>{y.value||dt()},1e3),st=e=>{O.value=!0,parseFloat(I.value)>0&&(s.value=Wt(I.value,e,l.value?.decimals),ye())};function lt(){O.value=!0,parseFloat(I.value)>0&&(s.value=I.value,ye())}function ut(){ce.value&&(N.value=parseFloat(ce.value))}function it(){if(y.value||D.value)return;$();const e=l.value;l.value=u.value,u.value=e;const a=s.value;s.value=i.value,i.value=a;const c=I.value;I.value=G.value,G.value=c,K.value=1/K.value,B.value+=180,s.value&&parseFloat(s.value)>0&&(O.value=!0,Ie())}function rt(){if(!t.isConnected)return n("common.connected");if(y.value)return n("swap.swapping");if(D.value)return n("swap.fetchingQuote");if(!R.value){const a=w.getSupportedNetworks().map(c=>c===1?n("swap.mainnet"):c===11155111?n("swap.sepoliaTestnet"):n("swap.network",{id:c})).join("、");return n("swap.unsupportedNetwork",{networks:a})}return n("swap.swap")}function Ue(){Re.value&&(Ce(),de.value=!0,_.value="loading",q.value=0,R.value&&C.value?ft():(_.value="error",x.value=n("swap.networkNotSupportedError")))}async function ct(){if(!s.value||!l.value||!u.value||l.value.symbol===u.value.symbol){h.value=null,i.value="";return}if(!R.value)return;$();const e=++be.value;P.value=new AbortController;const a=P.value;D.value=!0,Be.value=Date.now();try{const c={tokenIn:l.value.address,tokenOut:u.value.address,amountIn:s.value,swapType:"exactInput",slippage:N.value},d=await w.getQuote(c);if(a.signal.aborted||ee(e))return;d?(h.value=d,i.value=d.amountOut,ge.value=d.priceImpact,he.value=parseFloat(d.fee),C.value=!0,U()):(h.value=null,i.value="",C.value=!1,U())}catch(c){if(a.signal.aborted||ee(e))return;h.value=null,i.value="",C.value=!1,U(),H.error(n("swap.getQuoteFailed",{error:c.message}))}finally{ee(e)||(D.value=!1,M.value=!1),P.value===a&&(P.value=null)}}async function dt(){if(!i.value||!l.value||!u.value||l.value.symbol===u.value.symbol){h.value=null,s.value="";return}if(!R.value)return;$();const e=++be.value;P.value=new AbortController;const a=P.value;D.value=!0,Be.value=Date.now();try{const c={tokenIn:l.value.address,tokenOut:u.value.address,amountOut:i.value,swapType:"exactOutput",slippage:N.value},d=await w.getQuote(c);if(a.signal.aborted||ee(e))return;d?(s.value=d.amountIn,h.value=d,ge.value=d.priceImpact,he.value=parseFloat(d.fee),C.value=!0,U()):(h.value=null,s.value="",C.value=!1,U())}catch(c){if(a.signal.aborted||ee(e))return;h.value=null,s.value="",C.value=!1,U(),H.error(n("swap.getReverseQuoteFailed",{error:c.message}))}finally{ee(e)||(D.value=!1,M.value=!1),P.value===a&&(P.value=null)}}async function ft(){if(!(!h.value||y.value)){$(),y.value=!0,M.value=!1;try{const e={tokenIn:l.value.address,tokenOut:u.value.address,amountIn:O.value?s.value:h.value.amountIn||s.value,amountOut:O.value?void 0:i.value,swapType:O.value?"exactInput":"exactOutput",slippage:N.value};if(!w.isNetworkSupported(t.chainId)){_.value="error",x.value=n("swap.networkNotSupportedV4");return}await w.reinitialize();const a=t.address;if(!a){_.value="error",x.value=n("swap.connectWalletFirst");return}const c=await w.getQuote(e);if(!c){_.value="error",x.value=n("swap.cannotGetQuoteError");return}q.value=0,_.value="loading";const d=w.getContractAddresses(t.chainId),z=d.PERMIT2,fe=await w.checkAllowance(e.tokenIn,z,a),_e=await w.getTokenContract(e.tokenIn,!0).decimals(),Ve=re(s.value,_e),mt=BigInt(Math.floor((100+e.slippage)*100)),Ae=Ve*mt/BigInt(1e4),le=O.value?Ve:Ae;if(BigInt(fe)<BigInt(le)&&(q.value=1,_.value="pending",!await w.approveToken(e.tokenIn,z,et.toString()))){_.value="error",x.value=n("swap.permit2AuthFailed");return}const wt=await new J(z,["function allowance(address owner, address token, address spender) external view returns (uint160 amount, uint48 expiration, uint48 nonce)"],w.provider).allowance(a,e.tokenIn,d.UNIVERSAL_ROUTER);if(BigInt(wt.amount)<BigInt(le)){q.value=1,_.value="pending";const ne=Math.floor(Date.now()/1e3)+30*24*3600;await(await new J(z,["function approve(address token, address spender, uint160 amount, uint48 expiration) external"],w.signer).approve(e.tokenIn,d.UNIVERSAL_ROUTER,"1461501637330902918203684832716283019655932542975",ne)).wait()}q.value=2,_.value="loading";const Me=await w.getTokenContract(e.tokenOut).decimals(),ht=BigInt(Math.floor((100-e.slippage)*100)),qe=re(c.amountOut,Me)*ht/BigInt(1e4),$e=re(i.value,Me),te={currency0:e.tokenIn<e.tokenOut?e.tokenIn:e.tokenOut,currency1:e.tokenIn<e.tokenOut?e.tokenOut:e.tokenIn,fee:500,tickSpacing:10,hooks:Ye};(te.currency0=="0x45Dd667b7C97F7c7B9135dA7f8674dF7d6662737"||te.currency1=="0x45Dd667b7C97F7c7B9135dA7f8674dF7d6662737")&&(te.hooks="0x7d08875f51879bedD9a01d71a804f012e1304fC0");const ze=te.currency0===e.tokenIn,gt=Math.floor(Date.now()/1e3)+3600,ae={SWAP_EXACT_IN_SINGLE:6,SWAP_EXACT_OUT_SINGLE:8,SETTLE_ALL:12,TAKE_ALL:15},bt={V4_SWAP:16},Ge="(address currency0,address currency1,uint24 fee,int24 tickSpacing,address hooks)",kt="("+Ge+" poolKey,bool zeroForOne,uint128 amountIn,uint128 amountOutMinimum,bytes hookData)",yt="("+Ge+" poolKey,bool zeroForOne,uint128 amountOut,uint128 amountInMaximum,bytes hookData)";let T="0x";const Y=[];if(O.value){const ne={poolKey:te,zeroForOne:ze,amountIn:le,amountOutMinimum:qe,hookData:"0x"},pe=W.defaultAbiCoder().encode([kt],[ne]);Y.push(pe),T=T+ae.SWAP_EXACT_IN_SINGLE.toString(16).padStart(2,"0");const ve=W.defaultAbiCoder().encode(["address","uint256"],[e.tokenIn,le]);Y.push(ve),T=T+ae.SETTLE_ALL.toString(16).padStart(2,"0");const Te=W.defaultAbiCoder().encode(["address","uint256"],[e.tokenOut,qe]);Y.push(Te),T=T+ae.TAKE_ALL.toString(16).padStart(2,"0")}else{const ne={poolKey:te,zeroForOne:ze,amountOut:$e,amountInMaximum:Ae,hookData:"0x"},pe=W.defaultAbiCoder().encode([yt],[ne]);Y.push(pe),T=T+ae.SWAP_EXACT_OUT_SINGLE.toString(16).padStart(2,"0");const ve=W.defaultAbiCoder().encode(["address","uint256"],[e.tokenIn,Ae]);Y.push(ve),T=T+ae.SETTLE_ALL.toString(16).padStart(2,"0");const Te=W.defaultAbiCoder().encode(["address","uint256"],[e.tokenOut,$e]);Y.push(Te),T=T+ae.TAKE_ALL.toString(16).padStart(2,"0")}const It=W.defaultAbiCoder().encode(["bytes","bytes[]"],[T,Y]);let Se="0x";const We=[];We.push(It),Se=Se+bt.V4_SWAP.toString(16).padStart(2,"0");const Ct={value:e.tokenIn===Ye?le:0},_t=await w.swapRouterContract.execute(Se,We,gt,Ct);q.value=3,_.value="loading";const At=await _t.wait();ke.value=At.hash,q.value=4,_.value="success",setTimeout(()=>{s.value="",i.value="",h.value=null,ge.value="0",he.value=.3},2e3),await se(),await j()}catch(e){const a=e.message;_.value="error",a.includes("insufficient funds")?x.value=n("swap.insufficientFundsError"):a.includes("allowance")?x.value=n("swap.allowanceError"):a.includes("slippage")?x.value=n("swap.slippageError"):a.includes("pool")?x.value=n("swap.poolError"):x.value=n("swap.swapFailedError",{error:a})}finally{y.value=!1}}}async function oe(){if(!t.isConnected||!t.chainId){R.value=!1;return}R.value=w.isNetworkSupported(t.chainId)}async function j(){if(!l.value||!u.value||l.value.symbol===u.value.symbol){C.value=!1;return}if(!t.isConnected||!t.chainId){C.value=!1;return}if(!R.value){C.value=!1;return}try{const e=await w.getPoolInfo(l.value.address,u.value.address,500);C.value=e!==null}catch{C.value=!1}}ue([l,u],async()=>{t.isConnected&&(h.value=null,U(),await se(),await j())}),ue(()=>t.isConnected,async e=>{e?(await w.reinitialize(),await oe(),await se(),await j()):(R.value=!1,C.value=!1,h.value=null)}),ue(()=>t.chainId,async e=>{e&&t.isConnected&&(await w.reinitialize(),await oe(),S.value.forEach(a=>{a.symbol==="WRMB"?a.address=k.WRMB.addresses[e]||a.address:a.symbol==="USDC"&&(a.address=k.USDC.addresses[e]||a.address)}),await j())});async function se(){if(!t.isConnected||!t.address){I.value="0",G.value="0";return}try{const[e,a]=await Promise.all([w.getTokenBalance(l.value.address,t.address),w.getTokenBalance(u.value.address,t.address)]);I.value=e,G.value=a}catch{I.value="1000",G.value="500"}}function Ce(){q.value=0,_.value="pending",ke.value="",x.value="",De.value=void 0}function pt(){de.value=!1,Ce()}function vt(){Ce(),Ue()}return xt(async()=>{await oe(),await se(),U(),await j()}),Ft(()=>{$(),y.value=!1,D.value=!1,M.value=!1}),(e,a)=>{const c=Pt,d=Nt,z=Ut,fe=qt;return L(),Bt(Xt,{"is-pulling":F(f),"is-refreshing":F(p),"pull-distance":F(b),"can-refresh":F(A)},{default:E(()=>[o("div",ea,[o("div",ta,[o("div",aa,[o("h2",na,m(e.$t("swap.title")),1)]),o("div",oa,[o("div",sa,[g(d,{placement:"bottom-end",width:300,trigger:"click"},{reference:E(()=>[o("div",la,[g(c,{class:"settings-btn"},{default:E(()=>[g(F(Lt))]),_:1})])]),default:E(()=>[o("div",ua,[o("h4",ia,m(e.$t("swap.settings")),1),o("div",ra,[o("span",null,m(e.$t("swap.slippage")),1),o("div",ca,[(L(),V(Xe,null,Qe(Fe,v=>o("button",{key:v,class:zt({active:N.value===v}),onClick:_e=>N.value=v},m(v)+"% ",11,da)),64)),o("div",fa,[Dt(o("input",{type:"number","onUpdate:modelValue":a[0]||(a[0]=v=>ce.value=v),onInput:ut,placeholder:"Custom"},null,544),[[Rt,ce.value]]),a[6]||(a[6]=o("span",null,"%",-1))])])])])]),_:1}),o("div",pa,[o("div",va,[o("div",ma,[o("span",wa,m(e.$t("swap.sell")),1)]),o("div",ha,[o("div",ga,[o("div",ba,[o("div",ka,[g(Ze,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=v=>s.value=v),placeholder:F(He)(I.value)+"  "+e.$t("available"),size:"large",decimals:6,"use-abbreviation":!0,"max-decimals":l.value?.decimals,disabled:y.value||D.value,onInputChange:ye},null,8,["modelValue","placeholder","max-decimals","disabled"]),g(Je,{modelValue:l.value,"onUpdate:modelValue":a[2]||(a[2]=v=>l.value=v),tokens:S.value,placeholder:"Select token",disabled:y.value,onTokenChange:Q},null,8,["modelValue","tokens","disabled"])])])]),o("div",ya,[(L(),V(Xe,null,Qe([25,50,75],v=>g(z,{key:v,size:"small",onClick:_e=>st(v),disabled:y.value},{default:E(()=>[ie(m(v)+"% ",1)]),_:2},1032,["onClick","disabled"])),64)),g(z,{onClick:lt,class:"max-button",size:"small",disabled:y.value},{default:E(()=>[ie(m(e.$t("common.max")),1)]),_:1},8,["disabled"])])])]),o("div",Ia,[g(z,{circle:"",onClick:it,class:"swap-direction-btn",disabled:y.value||D.value},{default:E(()=>[g(c,{class:"swap-icon",style:Vt({transform:`rotate(${B.value}deg)`})},{default:E(()=>[g(F(Mt))]),_:1},8,["style"])]),_:1},8,["disabled"])]),o("div",Ca,[o("div",_a,[o("span",Aa,m(e.$t("swap.buy")),1)]),o("div",Sa,[o("div",Ta,[o("div",Ea,[o("div",Oa,[g(Ze,{modelValue:i.value,"onUpdate:modelValue":a[3]||(a[3]=v=>i.value=v),placeholder:F(He)(G.value)+"  "+e.$t("available"),size:"large",decimals:6,"use-abbreviation":!0,"max-decimals":u.value?.decimals,disabled:y.value||D.value,onInputChange:ot},null,8,["modelValue","placeholder","max-decimals","disabled"]),g(Je,{modelValue:u.value,"onUpdate:modelValue":a[4]||(a[4]=v=>u.value=v),tokens:S.value,placeholder:"Select token",disabled:y.value,onTokenChange:Z},null,8,["modelValue","tokens","disabled"])])])])])])]),o("div",xa,[o("h4",Fa,m(e.$t("swap.details")),1),o("div",Ba,[F(t).isConnected?(L(),V("div",Da,[o("span",null,m(e.$t("swap.protocolStatus")),1),o("span",Ra,[R.value?(L(),V("span",Pa,m(e.$t("swap.uniswapV4Available")),1)):(L(),V("span",La,[ie(m(e.$t("swap.v4NotSupported"))+" ",1),g(fe,{content:e.$t("swap.switchToSupportedNetwork"),placement:"top"},{default:E(()=>[g(c,{class:"info-icon"},{default:E(()=>[g(F(je))]),_:1})]),_:1},8,["content"])]))])])):Ke("",!0),R.value&&l.value&&u.value&&l.value.symbol!==u.value.symbol?(L(),V("div",Na,[o("span",null,m(e.$t("swap.poolStatus")),1),o("span",Ua,[C.value?(L(),V("span",Va,m(e.$t("swap.poolAvailable")),1)):(L(),V("span",Ma,[ie(m(e.$t("swap.poolNotExists"))+" ",1),g(fe,{content:e.$t("swap.poolNotExistsTooltip"),placement:"top"},{default:E(()=>[g(c,{class:"info-icon"},{default:E(()=>[g(F(je))]),_:1})]),_:1},8,["content"])]))])])):Ke("",!0),o("div",qa,[o("span",null,m(e.$t("swap.rate")),1),K.value>0&&l.value&&u.value?(L(),V("span",$a,"1 "+m(l.value.symbol)+" ≈ "+m(F(Oe)(K.value,6))+" "+m(u.value.symbol),1)):(L(),V("span",za,m(e.$t("swap.enterAmountForRate")),1))])])]),o("div",Ga,[g(z,{class:"action-button",type:"primary",size:"large",disabled:!Re.value,onClick:Ue},{default:E(()=>[ie(m(rt()),1)]),_:1},8,["disabled"])])])])])]),g($t,{visible:de.value,"onUpdate:visible":a[5]||(a[5]=v=>de.value=v),title:e.$t("swap.swapTransaction"),steps:at.value,"current-step":q.value,status:_.value,"transaction-details":nt.value,"gas-info":De.value,"transaction-hash":ke.value,"error-message":x.value,onClose:pt,onRetry:vt},null,8,["visible","title","steps","current-step","status","transaction-details","gas-info","transaction-hash","error-message"])]),_:1},8,["is-pulling","is-refreshing","pull-distance","can-refresh"])}}}),sn=Gt(Wa,[["__scopeId","data-v-de491d58"]]);export{sn as default};
//# sourceMappingURL=Swap-Cwpaooxc.js.map
